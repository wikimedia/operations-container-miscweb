<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 3201 &ndash; Provision of article skeleton</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://old-bugzilla.wikimedia.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=3201&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=3201">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=3201">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=3201">



    
    <link href="skins/standard/global.css?1389015166"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/global.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/show_bug.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="extensions/Voting/web/style.css?1389015166" rel="stylesheet"
        type="text/css" ><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css?1389015166" rel="stylesheet"
        type="text/css" >
<![endif]-->

    <link href="skins/contrib/Wikimedia/global.css?1402013050" rel="stylesheet"
        type="text/css" title="Wikimedia"><link href="skins/contrib/Wikimedia/show_bug.css?1402441020" rel="stylesheet"
        type="text/css" title="Wikimedia">

      <link rel="stylesheet" href="skins/contrib/Wikimedia/vector.css?1403109885" media="screen"
            title="Wikimedia" />


    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1389015166"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1389015166"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1389015166"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1389015166"></script><script type="text/javascript" src="js/yui/json/json-min.js?1389015166"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1389015166"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1389015166"></script><script type="text/javascript" src="js/global.js?1389015166"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 15
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 3201 – Provision of article skeleton",  
                             "show_bug.cgi?id=3201" );
        document.title = "Bug 3201 – Provision of article skeleton";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 3201 – Provision of article skeleton", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1389015166"></script><script type="text/javascript" src="js/field.js?1389015166"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="old-bugzilla-wikimedia-org bz_bug bz_status_RESOLVED bz_product_MediaWiki bz_component_Page_editing bz_bug_3201 yui-skin-sam">



<!-- If custom Wikimedia skin -->
   <div id="page-base" class="noprint"></div>
                <div id="head-base" class="noprint"></div>
                <!-- content -->
                <div id="content-container" >
                        <a id="top"></a>
                        <!-- bodyContent -->
                        <div id="bodyContent">
      <p class="header_addl_info">Last modified: 2013-11-11 09:40:10 UTC</p>

 <!-- If custom Wikimedia skin -->
<h1>Wikimedia Bugzilla is closed!</h1><div id="message" style="text-align: center; color: black">Wikimedia has <a href="https://www.mediawiki.org/wiki/Phabricator/versus_Bugzilla">migrated from Bugzilla to Phabricator</a>. Bug reports should be created and updated in <a href="https://phabricator.wikimedia.org">Wikimedia Phabricator</a> instead. Please <a href="https://www.mediawiki.org/wiki/Phabricator/Help#Creating_your_account">create an account in Phabricator and add your Bugzilla email address</a> to it.<br>Wikimedia Bugzilla is read-only. If you try to edit or create any bug report in Bugzilla you will be shown an intentional error message.<br>In order to access the Phabricator task corresponding to a Bugzilla report, just remove "static-" from its URL.<br>You could still run searches in Bugzilla or access your <a href="https://old-bugzilla.wikimedia.org/page.cgi?id=voting%2Fuser.html">list of votes</a> but bug reports will obviously not be up-to-date in Bugzilla.</div>

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2013-11-11 09:40:10">
  <input type="hidden" name="longdesclength" value="17">
  <input type="hidden" name="id" value="3201">
  <input type="hidden" name="token" value="1419361641-5SPRlErCobpfmuH-gOplc2mSVvFOga7WZSGK3mIaXqo">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=3201"><b>Bug&nbsp;3201</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Provision of article skeleton</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td>Provision of article skeleton
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('Provision of article skeleton', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          WONTFIX
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >MediaWiki</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr>
    
    <td class="field_label">
      <label for="component">
        <a href="describecomponents.cgi?product=MediaWiki">
        Component:</a>
      </label>
    </td>
    
    <td>Page editing
    
    (<a href="buglist.cgi?component=Page%20editing&product=MediaWiki&resolution=---"
      target="new_window">Other open bugs</a>)
    
    </td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>
</label>
</th>
        <td>1.4.x
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">All
       All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Lowest
       enhancement<span id="votes_container">
      with
      <a href="page.cgi?id=voting/bug.html&amp;bug_id=3201">4 
            votes</a>
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=3201#vote_3201">vote</a>)
  </span>
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=fields.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Nobody - You can work on this!</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'wikibugs-l\x40lists.wikimedia.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
          <a href="https://www.mediawiki.org/wiki/Manual:Creating_pages_with_preloaded_text"><span title="https://www.mediawiki.org/wiki/Manual:Creating_pages_with_preloaded_text">https://www.mediawiki.org/wiki/Manual...
        </span></a>
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
    <th class="field_label">
      <label for="duplicates">Duplicates</label>:
    </th>
    <td class="field_value" colspan="2">
      <span id="duplicates"><a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Improve the new article creation dialog with stub/template."
   href="show_bug.cgi?id=4670">4670</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Multiple new page layouts"
   href="show_bug.cgi?id=25348">25348</a> 
      </span>
      (<a href="buglist.cgi?bug_id=4670,25348">view as bug list</a>)
    </td>
  </tr>
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=3201&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=3201">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2005-08-19 15:24 UTC by <span class="vcard"><span class="fn">Tim Graves</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2013-11-11 09:40 UTC 
      (<a href="show_activity.cgi?id=3201">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>5 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="conrad.irwin">conrad.irwin</option>
                <option value="jayvdb">jayvdb</option>
                <option value="justforspam">justforspam</option>
                <option value="villes01">villes01</option>
                <option value="wmbugs">wmbugs</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_browser">


  <a 
      title="Please set this if the described problem seems to happen only in a specific web browser."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_browser"
  >Web browser:</a>

</th>
  <td class="field_value "
      id="field_container_cf_browser"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_platform">


  <a 
      title="The Mobile Platform the described problem was experienced on."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_platform"
  >Mobile Platform:</a>

</th>
  <td class="field_value "
      id="field_container_cf_platform"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_hugglebeta">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_hugglebeta"
  >Assignee Huggle Beta Tester:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_hugglebeta"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain">
        <td valign="top">
            <a href="attachment.cgi?id=811"
               title="View the content of the attachment">
          <b>Modified version of EditPage.php</b></a>

          <span class="bz_attach_extra_info">
              (31.07 KB,
                text/plain)

            <br>
            <a href="#attach_811"
               title="Go to the comment associated with the attachment">2005-08-19 15:26 UTC</a>,

            <span class="vcard"><span class="fn">Tim Graves</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=811&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain">
        <td valign="top">
            <a href="attachment.cgi?id=1287"
               title="View the content of the attachment">
          <b>Unified diff of the skeleton code form the 1.4.5 EditPage.php</b></a>

          <span class="bz_attach_extra_info">
              (4.86 KB,
                text/plain)

            <br>
            <a href="#attach_1287"
               title="Go to the comment associated with the attachment">2006-01-11 15:40 UTC</a>,

            <span class="vcard"><span class="fn">Tim Graves</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1287&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=1322"
               title="View the content of the attachment">
          <b>EditPage.php - patch</b></a>

          <span class="bz_attach_extra_info">
              (1.43 KB,
                patch)

            <br>
            <a href="#attach_1322"
               title="Go to the comment associated with the attachment">2006-01-23 17:08 UTC</a>,

            <span class="vcard"><span class="fn">Mikos</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1322&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
        </span>
        <a href="attachment.cgi?bugid=3201&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1389015166" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Tim Graves</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-19 15:24:28 UTC
        </span>
      </div>



<pre class="bz_comment_text" >We are using MediaWIki to hold some semi structured data and needed a way to
provide a consistent article format (actually several formats) As we only needed
a structure outline the template mechanism was not applicable.
I have made some minor changes to the EditPage.php that enable a list of article
Skeletons to be provided when a page is first created, selecting one of the
skeletons pulls the text of the skeleton article into the edit page, replacing
what was there before. Because this is a potentially destructive action the
skeletons are only available when initially creating a page - thus preventing
existing content being accidentaly replaced.
There is a known flaw in this implementation in that it stores the sekeleton
articles in the main namespace wheras a full implementation would have used a
separate namespace.
The modified version of the 1.4.5 EditPage.php is listed below, (Sorry, I
couldn't spot a file upload mechanism) - for identification the three blocks of
changes are bracketed between START TIMG and END TIMG comments

&lt;?php
/**
 * Contain the EditPage class
 * &#64;package MediaWiki
 */

/**
 * Splitting edit page/HTML interface from Article...
 * The actual database and text munging is still in Article,
 * but it should get easier to call those from alternate
 * interfaces.
 *
 * &#64;package MediaWiki
 */

class EditPage {
	var $mArticle;
	var $mTitle;
	
	# Form values
	var $save = false, $preview = false;
	var $minoredit = false, $watchthis = false;
	var $textbox1 = '', $textbox2 = '', $summary = '';
	var $edittime = '', $section = '';
	var $oldid = 0;
	
	/**
	 * &#64;todo document
	 * &#64;param $article
	 */
	function EditPage( $article ) {
		$this-&gt;mArticle =&amp; $article;
		global $wgTitle;
		$this-&gt;mTitle =&amp; $wgTitle;
	}

	/**
	 * This is the function that gets called for &quot;action=edit&quot;.
	 */
	function edit() {
		global $wgOut, $wgUser, $wgWhitelistEdit, $wgRequest;
		// this is not an article
		$wgOut-&gt;setArticleFlag(false);

		$this-&gt;importFormData( $wgRequest );

		if ( ! $this-&gt;mTitle-&gt;userCanEdit() ) {
			$wgOut-&gt;readOnlyPage( $this-&gt;mArticle-&gt;getContent( true ), true );
			return;
		}
		if ( $wgUser-&gt;isBlocked() ) {
			$this-&gt;blockedIPpage();
			return;
		}
		if ( !$wgUser-&gt;getID() &amp;&amp; $wgWhitelistEdit ) {
			$this-&gt;userNotLoggedInPage();
			return;
		}
		if ( wfReadOnly() ) {
			if( $this-&gt;save || $this-&gt;preview ) {
				$this-&gt;editForm( 'preview' );
			} else {
				$wgOut-&gt;readOnlyPage( $this-&gt;mArticle-&gt;getContent( true ) );
			}
			return;
		}
		if ( $this-&gt;save ) {
			$this-&gt;editForm( 'save' );
		} else if ( $this-&gt;preview ) {
			$this-&gt;editForm( 'preview' );
		} else { # First time through
			if( $wgUser-&gt;getOption('previewonfirst') ) {
				$this-&gt;editForm( 'preview', true );
			} else {
				$this-&gt;editForm( 'initial', true );
			}
		}
	}

	/**
	 * &#64;todo document
	 */
	function importFormData( &amp;$request ) {
		if( $request-&gt;wasPosted() ) {
			# These fields need to be checked for encoding.
			# Also remove trailing whitespace, but don't remove _initial_
			# whitespace from the text boxes. This may be significant formatting.
			$this-&gt;textbox1 = rtrim( $request-&gt;getText( 'wpTextbox1' ) );
			$this-&gt;textbox2 = rtrim( $request-&gt;getText( 'wpTextbox2' ) );
			$this-&gt;summary  =  trim( $request-&gt;getText( 'wpSummary'  ) );
	
			$this-&gt;edittime = $request-&gt;getVal( 'wpEdittime' );
			if( is_null( $this-&gt;edittime ) ) {
				# If the form is incomplete, force to preview.
				$this-&gt;preview  = true;
			} else {
				if( $this-&gt;tokenOk( $request ) ) {
					# Some browsers will not report any submit button
					# if the user hits enter in the comment box.
					# The unmarked state will be assumed to be a save,
					# if the form seems otherwise complete.
					$this-&gt;preview = $request-&gt;getCheck( 'wpPreview' );
				} else {
					# Page might be a hack attempt posted from
					# an external site. Preview instead of saving.
					$this-&gt;preview = true;
				}
			}
			$this-&gt;save    = !$this-&gt;preview;
			if( !preg_match( '/^\d{14}$/', $this-&gt;edittime )) {
				$this-&gt;edittime = null;
			}
	
			$this-&gt;minoredit = $request-&gt;getCheck( 'wpMinoredit' );
			$this-&gt;watchthis = $request-&gt;getCheck( 'wpWatchthis' );
		} else {
			# Not a posted form? Start with nothing.
			$this-&gt;textbox1  = '';
			$this-&gt;textbox2  = '';
			$this-&gt;summary   = '';
			$this-&gt;edittime  = '';
			$this-&gt;preview   = false;
			$this-&gt;save      = false;
			$this-&gt;minoredit = false;
			$this-&gt;watchthis = false;
		}

		$this-&gt;oldid = $request-&gt;getInt( 'oldid' );

		# Section edit can come from either the form or a link
		$this-&gt;section = $request-&gt;getVal( 'wpSection', $request-&gt;getVal( 'section' ) );
	}

	/**
	 * Make sure the form isn't faking a user's credentials.
	 *
	 * &#64;param WebRequest $request
	 * &#64;return bool
	 * &#64;access private
	 */
	function tokenOk( &amp;$request ) {
		global $wgUser;
		if( $wgUser-&gt;getId() == 0 ) {
			# Anonymous users may not have a session
			# open. Don't tokenize.
			return true;
		} else {
			return $wgUser-&gt;matchEditToken( $request-&gt;getVal( 'wpEditToken' ) );
		}
	}
	
	function submit() {
		$this-&gt;edit();
	}

	/**
	 * The edit form is self-submitting, so that when things like
	 * preview and edit conflicts occur, we get the same form back
	 * with the extra stuff added.  Only when the final submission
	 * is made and all is well do we actually save and redirect to
	 * the newly-edited page.
	 *
	 * &#64;param string $formtype Type of form either : save, initial or preview
	 * &#64;param bool $firsttime True to load form data from db
	 */
	function editForm( $formtype, $firsttime = false ) {
		global $wgOut, $wgUser;
		global $wgLang, $wgContLang, $wgParser, $wgTitle;
		global $wgAllowAnonymousMinor;
		global $wgWhitelistEdit;
		global $wgSpamRegex, $wgFilterCallback;
		global $wgUseLatin1;

		$sk = $wgUser-&gt;getSkin();
		$isConflict = false;
		// css / js subpages of user pages get a special treatment
		$isCssJsSubpage = (Namespace::getUser() == $wgTitle-&gt;getNamespace() and
preg_match(&quot;/\\.(css|js)$/&quot;, $wgTitle-&gt;getText() ));

		# START TIMG
		# setup the variables for later use
		$timsSkeletonEnabled = false ;
		$timsSkeletonText = '' ;
		# END TIMG

		if(!$this-&gt;mTitle-&gt;getArticleID()) { # new article
			$wgOut-&gt;addWikiText(wfmsg('newarticletext'));
			# START TIMG
			# Get the details for the skeleton URLs
			$timsTitleEditURL=$this-&gt;mTitle-&gt;getEditURL() ;
			# List the possible skeletons
			# This code is based on the code below that pulls out the list of templates
used in the document
			# though I have added comments
			# Get the database
			$timsSkeletonDb =&amp; wfGetDB( DB_SLAVE );
			# get the current table detials
			$timsSkeletonCurrentTable = $timsSkeletonDb-&gt;tableName( 'cur' );
			# build the SQL for the query
			# Note that this used the main namespace, in the future a namespace fot
Skeletons might be a safer bet
			$timsSkeletonSql = &quot;SELECT cur_namespace, cur_title &quot;.
				&quot;FROM $timsSkeletonCurrentTable WHERE cur_title LIKE('Skeleton:%') AND
cur_namespace=&quot;.NS_MAIN;
			# execute the query
			$timsSkeletonRes = $timsSkeletonDb-&gt;query( $timsSkeletonSql,
&quot;EditPage::editform&quot; );
			# if there was a result
			if ( false !== $timsSkeletonRes ) {
				# there was a result, are there any rows ?
				if ( $timsSkeletonDb-&gt;numRows( $timsSkeletonRes ) ) {
					# yes there are rows
					# initialise the Skeleton seleciton option. Note that this shoudl be 
					# an international type message but I havent got that far
					$timsSkeletonList = &quot;&lt;H1&gt;Skeletons list&lt;/H1&gt;&lt;P&gt;You can use one of these
skeletons to provide the basic structure for you entry&quot; ;
					# For each of the rows we got back
					while ( $timsSkeletonRow = $timsSkeletonDb-&gt;fetchObject( $timsSkeletonRes ) ) {
						# make sure that there is an associated title
						if ( $timsSkeletonTitleObj = Title::makeTitle( $timsSkeletonRow
-&gt;cur_namespace, $timsSkeletonRow -&gt;cur_title ) ) {
							# yes there is, get the text of the title
							$timsSkeletonTitleName = $timsSkeletonTitleObj -&gt; getText() ;
							# and make it into a link using the title as the visible name and also
embedding the name of the skeleton in the link
							$timsSkeletonList .= &quot;, &lt;A
HREF=\&quot;$timsTitleEditURL&amp;skeleton=$timsSkeletonTitleName \&quot;&gt;
$timsSkeletonTitleName &lt;/A&gt;&quot;;
						}
					}
					# append the close paragraph to the skeletons list output
					$timsSkeletonList .= &quot;.&lt;/P&gt;&quot; ;
					# Append the skeleton none option
					$timsSkeletonList .= &quot;&lt;P&gt;If you want to remove the skeleton chose &lt;A
HREF=\&quot;$timsTitleEditURL&amp;skeleton=none\&quot;&gt;none&lt;/A&gt;&lt;/P&gt;&quot; ;
					# remind people that specifying a skeleton will wipe out any existing
edited text
					$timsSkeletonList .= &quot;&lt;P&gt;Reminder, Chosing a Skeleton (or none) will
overwrite any existing edit&lt;/P&gt;&quot; ;
					# and output it
					$wgOut-&gt;addHTML($timsSkeletonList) ;
				}
				# release the results row set
				$timsSkeletonDb-&gt;freeResult( $timsSkeletonRes );
			}			
			# see if there is a skeleton specified to use
			# get the request - need this to get the attributes in the URL
			global $wgRequest ;
			# get the value of the skeleton attribute from the URL or none is there is none
			$timsSkeletonName = $wgRequest-&gt;getVal( 'skeleton' , 'none') ;
			# Have we got the skeleton attribute ?
			# provided that the skeleton is not value none
			# try and get the text
			if ( 'none' == $timsSkeletonName) {
				# No
				# Just make sure that the variables are not set
				$timsSkeletonEnabled = false ;
				$timsSkeletonText = '' ;
			} else {
				# Yes, there is a skeleton attribute
				# set the variables to use
				$timsSkeletonEnabled = true ;
				# get tge title of the skeleton page
				$timsSkeletonTitle = Title::newFromText($timsSkeletonName) ;
				# get the associated article
				$timsSkeletonArticle = new Article ( $timsSkeletonTitle ) ;
				$timsSkeletonText = $timsSkeletonArticle-&gt;getContent( true  );
				$wgOut-&gt;addHTML(&quot;Using $timsSkeletonName If this is incorrect select a
different skeleton above. If you don't want to use a skeleton at all select
Skeleton:none&quot;) ;
			}
			# END TIMG
		}

		if( Namespace::isTalk( $this-&gt;mTitle-&gt;getNamespace() ) ) {
			$wgOut-&gt;addWikiText(wfmsg('talkpagetext'));
		}

		# Attempt submission here.  This will check for edit conflicts,
		# and redundantly check for locked database, blocked IPs, etc.
		# that edit() already checked just in case someone tries to sneak
		# in the back door with a hand-edited submission URL.

		if ( 'save' == $formtype ) {
			# Check for spam
			if ( $wgSpamRegex &amp;&amp; preg_match( $wgSpamRegex, $this-&gt;textbox1, $matches ) ) {
				$this-&gt;spamPage ( $matches[0] );
				return;
			}
			if ( $wgFilterCallback &amp;&amp; $wgFilterCallback( $this-&gt;mTitle, $this-&gt;textbox1,
$this-&gt;section ) ) {
				# Error messages or other handling should be performed by the filter function
				return;
			}
			if ( $wgUser-&gt;isBlocked() ) {
				$this-&gt;blockedIPpage();
				return;
			}
			if ( !$wgUser-&gt;getID() &amp;&amp; $wgWhitelistEdit ) {
				$this-&gt;userNotLoggedInPage();
				return;
			}
			if ( wfReadOnly() ) {
				$wgOut-&gt;readOnlyPage();
				return;
			}
			if ( $wgUser-&gt;pingLimiter() ) {
				$wgOut-&gt;rateLimited() ;
				return ;
			}

			# If article is new, insert it.
			$aid = $this-&gt;mTitle-&gt;getArticleID( GAID_FOR_UPDATE );
			if ( 0 == $aid ) {
				# Don't save a new article if it's blank.
				if ( ( '' == $this-&gt;textbox1 ) ||
				  ( wfMsg( 'newarticletext' ) == $this-&gt;textbox1 ) ) {
					$wgOut-&gt;redirect( $this-&gt;mTitle-&gt;getFullURL() );
					return;
				}
				if (wfRunHooks('ArticleSave', array(&amp;$this-&gt;mArticle, &amp;$wgUser,
&amp;$this-&gt;textbox1,
							   &amp;$this-&gt;summary, &amp;$this-&gt;minoredit, &amp;$this-&gt;watchthis, NULL)))
				{
					$this-&gt;mArticle-&gt;insertNewArticle( $this-&gt;textbox1, $this-&gt;summary,
													   $this-&gt;minoredit, $this-&gt;watchthis );
					wfRunHooks('ArticleSaveComplete', array(&amp;$this-&gt;mArticle, &amp;$wgUser,
$this-&gt;textbox1,
															$this-&gt;summary, $this-&gt;minoredit,
															$this-&gt;watchthis, NULL));
				}
				return;
			}

			# Article exists. Check for edit conflict.

			$this-&gt;mArticle-&gt;clear(); # Force reload of dates, etc.
			$this-&gt;mArticle-&gt;forUpdate( true ); # Lock the article

			if( ( $this-&gt;section != 'new' ) &amp;&amp;
				($this-&gt;mArticle-&gt;getTimestamp() != $this-&gt;edittime ) ) {
				$isConflict = true;
			}
			$userid = $wgUser-&gt;getID();

			if ( $isConflict) {
				$text = $this-&gt;mArticle-&gt;getTextOfLastEditWithSectionReplacedOrAdded(
					$this-&gt;section, $this-&gt;textbox1, $this-&gt;summary, $this-&gt;edittime);
			}
			else {
				$text = $this-&gt;mArticle-&gt;getTextOfLastEditWithSectionReplacedOrAdded(
					$this-&gt;section, $this-&gt;textbox1, $this-&gt;summary);
			}
			# Suppress edit conflict with self

			if ( ( 0 != $userid ) &amp;&amp; ( $this-&gt;mArticle-&gt;getUser() == $userid ) ) {
				$isConflict = false;
			} else {
				# switch from section editing to normal editing in edit conflict
				if($isConflict) {
					# Attempt merge
					if( $this-&gt;mergeChangesInto( $text ) ){
						// Successful merge! Maybe we should tell the user the good news?
						$isConflict = false;
					} else {
						$this-&gt;section = '';
						$this-&gt;textbox1 = $text;
					}
				}
			}
			if ( ! $isConflict ) {
				# All's well
				$sectionanchor = '';
				if( $this-&gt;section == 'new' ) {
					if( $this-&gt;summary != '' ) {
						$sectionanchor = $this-&gt;sectionAnchor( $this-&gt;summary );
					}
				} elseif( $this-&gt;section != '' ) {
					# Try to get a section anchor from the section source, redirect to edited
section if header found
					# XXX: might be better to integrate this into
Article::getTextOfLastEditWithSectionReplacedOrAdded
					# for duplicate heading checking and maybe parsing
					$hasmatch = preg_match( &quot;/^ *([=]{1,6})(.*?)(\\1) *\\n/i&quot;, $this-&gt;textbox1,
$matches );
					# we can't deal with anchors, includes, html etc in the header for now, 
					# headline would need to be parsed to improve this
					#if($hasmatch and strlen($matches[2]) &gt; 0 and !preg_match( &quot;/[\\['{&lt;&gt;]/&quot;,
$matches[2])) {
					if($hasmatch and strlen($matches[2]) &gt; 0) {
						$sectionanchor = $this-&gt;sectionAnchor( $matches[2] );
					}
				}
				
				if (wfRunHooks('ArticleSave', array(&amp;$this-&gt;mArticle, &amp;$wgUser, &amp;$text,
													&amp;$this-&gt;summary, &amp;$this-&gt;minoredit,
													&amp;$this-&gt;watchthis, &amp;$sectionanchor)))
				{
					# update the article here
					if($this-&gt;mArticle-&gt;updateArticle( $text, $this-&gt;summary, $this-&gt;minoredit,
													   $this-&gt;watchthis, '', $sectionanchor ))
					{
						wfRunHooks('ArticleSaveComplete', array(&amp;$this-&gt;mArticle, &amp;$wgUser, $text,
																$this-&gt;summary, $this-&gt;minoredit,
																$this-&gt;watchthis, $sectionanchor));
						return;
					}
					else
					  $isConflict = true;
				}
			}
		}
		# First time through: get contents, set time for conflict
		# checking, etc.

		if ( 'initial' == $formtype || $firsttime ) {
			$this-&gt;edittime = $this-&gt;mArticle-&gt;getTimestamp();
			$this-&gt;textbox1 = $this-&gt;mArticle-&gt;getContent( true );
			$this-&gt;summary = '';
			$this-&gt;proxyCheck();
		}
		$wgOut-&gt;setRobotpolicy( 'noindex,nofollow' );

		# Enabled article-related sidebar, toplinks, etc.
		$wgOut-&gt;setArticleRelated( true );

		if ( $isConflict ) {
			$s = wfMsg( 'editconflict', $this-&gt;mTitle-&gt;getPrefixedText() );
			$wgOut-&gt;setPageTitle( $s );
			$wgOut-&gt;addHTML( wfMsg( 'explainconflict' ) );

			$this-&gt;textbox2 = $this-&gt;textbox1;
			$this-&gt;textbox1 = $this-&gt;mArticle-&gt;getContent( true );
			$this-&gt;edittime = $this-&gt;mArticle-&gt;getTimestamp();
		} else {

			if( $this-&gt;section != '' ) {
				if( $this-&gt;section == 'new' ) {
					$s = wfMsg('editingcomment', $this-&gt;mTitle-&gt;getPrefixedText() );
				} else {
					$s = wfMsg('editingsection', $this-&gt;mTitle-&gt;getPrefixedText() );
				}
				if(!$this-&gt;preview) {
					preg_match( &quot;/^(=+)(.+)\\1/mi&quot;,
						$this-&gt;textbox1,
						$matches );
					if( !empty( $matches[2] ) ) {
						$this-&gt;summary = &quot;/* &quot;. trim($matches[2]).&quot; */ &quot;;
					}
				}
			} else {
				$s = wfMsg( 'editing', $this-&gt;mTitle-&gt;getPrefixedText() );
			}
			$wgOut-&gt;setPageTitle( $s );
			if ( !$wgUseLatin1 &amp;&amp; !$this-&gt;checkUnicodeCompliantBrowser() ) {
				$this-&gt;mArticle-&gt;setOldSubtitle();
				$wgOut-&gt;addWikiText( wfMsg( 'nonunicodebrowser') );
			}
			if ( $this-&gt;oldid ) {
				$this-&gt;mArticle-&gt;setOldSubtitle();
				$wgOut-&gt;addHTML( wfMsg( 'editingold' ) );
			}
		}

		if( wfReadOnly() ) {
			$wgOut-&gt;addHTML( '&lt;strong&gt;' .
			wfMsg( 'readonlywarning' ) .
			&quot;&lt;/strong&gt;&quot; );
		} else if ( $isCssJsSubpage and 'preview' != $formtype) {
			$wgOut-&gt;addHTML( wfMsg( 'usercssjsyoucanpreview' ));
		}
		if( $this-&gt;mTitle-&gt;isProtected('edit') ) {
			$wgOut-&gt;addHTML( '&lt;strong&gt;' . wfMsg( 'protectedpagewarning' ) .
			  &quot;&lt;/strong&gt;&lt;br /&gt;\n&quot; );
		}

		$kblength = (int)(strlen( $this-&gt;textbox1 ) / 1024);
		if( $kblength &gt; 29 ) {
			$wgOut-&gt;addHTML( '&lt;strong&gt;' .
				wfMsg( 'longpagewarning', $wgLang-&gt;formatNum( $kblength ) )
				. '&lt;/strong&gt;' );
		}

		$rows = $wgUser-&gt;getOption( 'rows' );
		$cols = $wgUser-&gt;getOption( 'cols' );

		$ew = $wgUser-&gt;getOption( 'editwidth' );
		if ( $ew ) $ew = &quot; style=\&quot;width:100%\&quot;&quot;;
		else $ew = '';

		$q = 'action=submit';
		#if ( &quot;no&quot; == $redirect ) { $q .= &quot;&amp;redirect=no&quot;; }
		$action = $this-&gt;mTitle-&gt;escapeLocalURL( $q );

		$summary = wfMsg('summary');
		$subject = wfMsg('subject');
		$minor   = wfMsg('minoredit');
		$watchthis = wfMsg ('watchthis');
		$save = wfMsg('savearticle');
		$prev = wfMsg('showpreview');

		$cancel = $sk-&gt;makeKnownLink( $this-&gt;mTitle-&gt;getPrefixedText(),
				wfMsg('cancel') );
		$edithelpurl = $sk-&gt;makeUrl( wfMsg( 'edithelppage' ));
		$edithelp = '&lt;a target=&quot;helpwindow&quot; href=&quot;'.$edithelpurl.'&quot;&gt;'.
			htmlspecialchars( wfMsg( 'edithelp' ) ).'&lt;/a&gt; '.
			htmlspecialchars( wfMsg( 'newwindow' ) );

		global $wgRightsText;
		$copywarn = &quot;&lt;div id=\&quot;editpage-copywarn\&quot;&gt;\n&quot; .
			wfMsg( $wgRightsText ? 'copyrightwarning' : 'copyrightwarning2',
				'[[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%27%20.%20wfMsg%28%20%27copyrightpage%27%20%29%20.%20%27">' . wfMsg( 'copyrightpage' ) . '</a>]]',
				$wgRightsText ) . &quot;\n&lt;/div&gt;&quot;;

		if( $wgUser-&gt;getOption('showtoolbar') and !$isCssJsSubpage ) {
			# prepare toolbar for edit buttons
			$toolbar = $this-&gt;getEditToolbar();
		} else {
			$toolbar = '';
		}

		// activate checkboxes if user wants them to be always active
		if( !$this-&gt;preview ) {
			if( $wgUser-&gt;getOption( 'watchdefault' ) ) $this-&gt;watchthis = true;
			if( $wgUser-&gt;getOption( 'minordefault' ) ) $this-&gt;minoredit = true;

			// activate checkbox also if user is already watching the page,
			// require wpWatchthis to be unset so that second condition is not
			// checked unnecessarily
			if( !$this-&gt;watchthis &amp;&amp; $this-&gt;mTitle-&gt;userIsWatching() ) $this-&gt;watchthis =
true;
		}

		$minoredithtml = '';

		if ( 0 != $wgUser-&gt;getID() || $wgAllowAnonymousMinor ) {
			$minoredithtml =
				&quot;&lt;input tabindex='3' type='checkbox' value='1'
name='wpMinoredit'&quot;.($this-&gt;minoredit?&quot; checked='checked'&quot;:&quot;&quot;).
				&quot; accesskey='&quot;.wfMsg('accesskey-minoredit').&quot;' id='wpMinoredit' /&gt;&quot;.
				&quot;&lt;label for='wpMinoredit'
title='&quot;.wfMsg('tooltip-minoredit').&quot;'&gt;{$minor}&lt;/label&gt;&quot;;
		}

		$watchhtml = '';

		if ( 0 != $wgUser-&gt;getID() ) {
			$watchhtml = &quot;&lt;input tabindex='4' type='checkbox'
name='wpWatchthis'&quot;.($this-&gt;watchthis?&quot; checked='checked'&quot;:&quot;&quot;).
				&quot; accesskey='&quot;.wfMsg('accesskey-watch').&quot;' id='wpWatchthis'  /&gt;&quot;.
				&quot;&lt;label for='wpWatchthis'
title='&quot;.wfMsg('tooltip-watch').&quot;'&gt;{$watchthis}&lt;/label&gt;&quot;;
		}

		$checkboxhtml = $minoredithtml . $watchhtml . '&lt;br /&gt;';

		if ( 'preview' == $formtype) {
			$previewhead='&lt;h2&gt;' . wfMsg( 'preview' ) . &quot;&lt;/h2&gt;\n&lt;p&gt;&lt;center&gt;&lt;font
color=\&quot;#cc0000\&quot;&gt;&quot; .
				wfMsg( 'note' ) . wfMsg( 'previewnote' ) . &quot;&lt;/font&gt;&lt;/center&gt;&lt;/p&gt;\n&quot;;
			if ( $isConflict ) {
				$previewhead.='&lt;h2&gt;' . wfMsg( 'previewconflict' ) .
					&quot;&lt;/h2&gt;\n&quot;;
			}

			$parserOptions = ParserOptions::newFromUser( $wgUser );
			$parserOptions-&gt;setEditSection( false );
			$parserOptions-&gt;setEditSectionOnRightClick( false );

			# don't parse user css/js, show message about preview
			# XXX: stupid php bug won't let us use $wgTitle-&gt;isCssJsSubpage() here

			if ( $isCssJsSubpage ) {
				if(preg_match(&quot;/\\.css$/&quot;, $wgTitle-&gt;getText() ) ) {
					$previewtext = wfMsg('usercsspreview');
				} else if(preg_match(&quot;/\\.js$/&quot;, $wgTitle-&gt;getText() ) ) {
					$previewtext = wfMsg('userjspreview');
				}
				$parserOutput = $wgParser-&gt;parse( $previewtext , $wgTitle, $parserOptions );
				$wgOut-&gt;addHTML( $parserOutput-&gt;mText );
			} else {
				$parserOutput = $wgParser-&gt;parse( $this-&gt;mArticle-&gt;preSaveTransform(
$this-&gt;textbox1 ) .&quot;\n\n&quot;,
						$wgTitle, $parserOptions );		
				
				$previewHTML = $parserOutput-&gt;mText;

				if($wgUser-&gt;getOption('previewontop')) {
					$wgOut-&gt;addHTML($previewhead);
					$wgOut-&gt;addHTML($previewHTML);
				}
				$wgOut-&gt;addCategoryLinks($parserOutput-&gt;getCategoryLinks());
				$wgOut-&gt;addLanguageLinks($parserOutput-&gt;getLanguageLinks());
				$wgOut-&gt;addHTML( &quot;&lt;br style=\&quot;clear:both;\&quot; /&gt;\n&quot; );
			}
		}

		# if this is a comment, show a subject line at the top, which is also the edit
summary.
		# Otherwise, show a summary field at the bottom
		$summarytext = htmlspecialchars( $wgContLang-&gt;recodeForEdit( $this-&gt;summary )
); # FIXME
			if( $this-&gt;section == 'new' ) {
				$commentsubject=&quot;{$subject}: &lt;input tabindex='1' type='text'
value=\&quot;$summarytext\&quot; name=\&quot;wpSummary\&quot; maxlength='200' size='60' /&gt;&lt;br /&gt;&quot;;
				$editsummary = '';
			} else {
				$commentsubject = '';
				$editsummary=&quot;{$summary}: &lt;input tabindex='2' type='text'
value=\&quot;$summarytext\&quot; name=\&quot;wpSummary\&quot; maxlength='200' size='60' /&gt;&lt;br /&gt;&quot;;
			}

		if( !$this-&gt;preview ) {
		# Don't select the edit box on preview; this interferes with seeing what's
going on.
			$wgOut-&gt;setOnloadHandler( 'document.editform.wpTextbox1.focus()' );
		}
		# Prepare a list of templates used by this page
		$templates = '';
		$id = $this-&gt;mTitle-&gt;getArticleID();
		if ( 0 !== $id ) {
			$db =&amp; wfGetDB( DB_SLAVE );
			$cur = $db-&gt;tableName( 'cur' );
			$links = $db-&gt;tableName( 'links' );
			$sql = &quot;SELECT cur_namespace,cur_title,cur_id &quot;.
				&quot;FROM $cur,$links WHERE l_to=cur_id AND l_from={$id} and
cur_namespace=&quot;.NS_TEMPLATE;
			$res = $db-&gt;query( $sql, &quot;EditPage::editform&quot; );
			if ( false !== $res ) {
				if ( $db-&gt;numRows( $res ) ) {
					$templates = '&lt;br /&gt;'. wfMsg( 'templatesused' ) . '&lt;ul&gt;';
					while ( $row = $db-&gt;fetchObject( $res ) ) {
						if ( $titleObj = Title::makeTitle( $row-&gt;cur_namespace, $row-&gt;cur_title ) ) {
							$templates .= '&lt;li&gt;' . $sk-&gt;makeLinkObj( $titleObj ) . '&lt;/li&gt;';
						}
					}
					$templates .= '&lt;/ul&gt;';
				}
				$db-&gt;freeResult( $res );
			}
		}

		# START TIMG
		# if there is a skeleton
		# make use of it
		if ($timsSkeletonEnabled) {
			$this-&gt;textbox1 = $timsSkeletonText ;
		}
		# END TIMG
		$wgOut-&gt;addHTML( &quot;

{$toolbar}
&lt;form id=\&quot;editform\&quot; name=\&quot;editform\&quot; method=\&quot;post\&quot; action=\&quot;$action\&quot;
enctype=\&quot;multipart/form-data\&quot;&gt;
{$commentsubject}
&lt;textarea tabindex='1' accesskey=\&quot;,\&quot; name=\&quot;wpTextbox1\&quot; rows='{$rows}'
cols='{$cols}'{$ew}&gt;&quot; .
htmlspecialchars( $wgContLang-&gt;recodeForEdit( $this-&gt;textbox1 ) ) .
&quot;
&lt;/textarea&gt;
&lt;br /&gt;{$editsummary}
{$checkboxhtml}
&lt;input tabindex='5' id='wpSave' type='submit' value=\&quot;{$save}\&quot; name=\&quot;wpSave\&quot;
accesskey=\&quot;&quot;.wfMsg('accesskey-save').&quot;\&quot;&quot;.
&quot; title=\&quot;&quot;.wfMsg('tooltip-save').&quot;\&quot;/&gt;
&lt;input tabindex='6' id='wpPreview' type='submit' value=\&quot;{$prev}\&quot;
name=\&quot;wpPreview\&quot; accesskey=\&quot;&quot;.wfMsg('accesskey-preview').&quot;\&quot;&quot;.
&quot; title=\&quot;&quot;.wfMsg('tooltip-preview').&quot;\&quot;/&gt;
&lt;em&gt;{$cancel}&lt;/em&gt; | &lt;em&gt;{$edithelp}&lt;/em&gt;{$templates}&quot; );
		$wgOut-&gt;addWikiText( $copywarn );
		$wgOut-&gt;addHTML( &quot;
&lt;input type='hidden' value=\&quot;&quot; . htmlspecialchars( $this-&gt;section ) . &quot;\&quot;
name=\&quot;wpSection\&quot; /&gt;
&lt;input type='hidden' value=\&quot;{$this-&gt;edittime}\&quot; name=\&quot;wpEdittime\&quot; /&gt;\n&quot; );

		if ( 0 != $wgUser-&gt;getID() ) {
			/**
			 * To make it harder for someone to slip a user a page
			 * which submits an edit form to the wiki without their
			 * knowledge, a random token is associated with the login
			 * session. If it's not passed back with the submission,
			 * we won't save the page, or render user JavaScript and
			 * CSS previews.
			 */
			$token = htmlspecialchars( $wgUser-&gt;editToken() );
			$wgOut-&gt;addHTML( &quot;
&lt;input type='hidden' value=\&quot;$token\&quot; name=\&quot;wpEditToken\&quot; /&gt;\n&quot; );
		}
		
		if ( $isConflict ) {
			require_once( &quot;DifferenceEngine.php&quot; );
			$wgOut-&gt;addHTML( &quot;&lt;h2&gt;&quot; . wfMsg( &quot;yourdiff&quot; ) . &quot;&lt;/h2&gt;\n&quot; );
			DifferenceEngine::showDiff( $this-&gt;textbox2, $this-&gt;textbox1,
			  wfMsg( &quot;yourtext&quot; ), wfMsg( &quot;storedversion&quot; ) );

			$wgOut-&gt;addHTML( &quot;&lt;h2&gt;&quot; . wfMsg( &quot;yourtext&quot; ) . &quot;&lt;/h2&gt;
&lt;textarea tabindex=6 id='wpTextbox2' name=\&quot;wpTextbox2\&quot; rows='{$rows}'
cols='{$cols}' wrap='virtual'&gt;&quot;
. htmlspecialchars( $wgContLang-&gt;recodeForEdit( $this-&gt;textbox2 ) ) .
&quot;
&lt;/textarea&gt;&quot; );
		}
		$wgOut-&gt;addHTML( &quot;&lt;/form&gt;\n&quot; );
		if($formtype ==&quot;preview&quot; &amp;&amp; !$wgUser-&gt;getOption(&quot;previewontop&quot;)) {
			$wgOut-&gt;addHTML($previewhead);
			$wgOut-&gt;addHTML($previewHTML);
		}
	}

	/**
	 * &#64;todo document
	 */
	function blockedIPpage() {
		global $wgOut, $wgUser, $wgContLang, $wgIP;

		$wgOut-&gt;setPageTitle( wfMsg( 'blockedtitle' ) );
		$wgOut-&gt;setRobotpolicy( 'noindex,nofollow' );
		$wgOut-&gt;setArticleRelated( false );

		$id = $wgUser-&gt;blockedBy();
		$reason = $wgUser-&gt;blockedFor();
		$ip = $wgIP;
		
		if ( is_numeric( $id ) ) {
			$name = User::whoIs( $id );
		} else {
			$name = $id;
		}
		$link = '[[' . $wgContLang-&gt;getNsText( Namespace::getUser() ) .
		  &quot;:{$name}|{$name}]]&quot;;

		$wgOut-&gt;addWikiText( wfMsg( 'blockedtext', $link, $reason, $ip, $name ) );
		$wgOut-&gt;returnToMain( false );
	}

	/**
	 * &#64;todo document
	 */
	function userNotLoggedInPage() {
		global $wgOut, $wgUser;

		$wgOut-&gt;setPageTitle( wfMsg( 'whitelistedittitle' ) );
		$wgOut-&gt;setRobotpolicy( 'noindex,nofollow' );
		$wgOut-&gt;setArticleRelated( false );

		$wgOut-&gt;addWikiText( wfMsg( 'whitelistedittext' ) );
		$wgOut-&gt;returnToMain( false );
	}

	/**
	 * &#64;todo document
	 */
	function spamPage ( $match = false )
	{
		global $wgOut;
		$wgOut-&gt;setPageTitle( wfMsg( 'spamprotectiontitle' ) );
		$wgOut-&gt;setRobotpolicy( 'noindex,nofollow' );
		$wgOut-&gt;setArticleRelated( false );

		$wgOut-&gt;addWikiText( wfMsg( 'spamprotectiontext' ) );
		if ( $match ) {
			$wgOut-&gt;addWikiText( wfMsg( 'spamprotectionmatch',
&quot;&lt;nowiki&gt;{$match}&lt;/nowiki&gt;&quot; ) );
		}
		$wgOut-&gt;returnToMain( false );
	}

	/**
	 * Forks processes to scan the originating IP for an open proxy server
	 * MemCached can be used to skip IPs that have already been scanned
	 */
	function proxyCheck() {
		global $wgBlockOpenProxies, $wgProxyPorts, $wgProxyScriptPath;
		global $wgIP, $wgUseMemCached, $wgMemc, $wgDBname, $wgProxyMemcExpiry;
		
		if ( !$wgBlockOpenProxies ) {
			return;
		}
		
		# Get MemCached key
		$skip = false;
		if ( $wgUseMemCached ) {
			$mcKey = $wgDBname.':proxy:ip:'.$wgIP;
			$mcValue = $wgMemc-&gt;get( $mcKey );
			if ( $mcValue ) {
				$skip = true;
			}
		}

		# Fork the processes
		if ( !$skip ) {
			$title = Title::makeTitle( NS_SPECIAL, 'Blockme' );
			$iphash = md5( $wgIP . $wgProxyKey );
			$url = $title-&gt;getFullURL( 'ip='.$iphash );

			foreach ( $wgProxyPorts as $port ) {
				$params = implode( ' ', array(
							escapeshellarg( $wgProxyScriptPath ),
							escapeshellarg( $wgIP ),
							escapeshellarg( $port ),
							escapeshellarg( $url )
							));
				exec( &quot;php $params &amp;&gt;/dev/null &amp;&quot; );
			}
			# Set MemCached key
			if ( $wgUseMemCached ) {
				$wgMemc-&gt;set( $mcKey, 1, $wgProxyMemcExpiry );
			}
		}
	}

	/**
	 * &#64;access private
	 * &#64;todo document
	 */
	function mergeChangesInto( &amp;$text ){
		$fname = 'EditPage::mergeChangesInto';
		$oldDate = $this-&gt;edittime;
		$dbw =&amp; wfGetDB( DB_MASTER );
		$obj = $dbw-&gt;selectRow( 'cur', array( 'cur_text' ), array( 'cur_id' =&gt;
$this-&gt;mTitle-&gt;getArticleID() ), 
			$fname, 'FOR UPDATE' );

		$yourtext = $obj-&gt;cur_text;
		$ns = $this-&gt;mTitle-&gt;getNamespace();
		$title = $this-&gt;mTitle-&gt;getDBkey();
		$obj = $dbw-&gt;selectRow( 'old', 
			array( 'old_text','old_flags'), 
			array( 'old_namespace' =&gt; $ns, 'old_title' =&gt; $title, 
				'old_timestamp' =&gt; $dbw-&gt;timestamp($oldDate)),
			$fname );
		$oldText = Article::getRevisionText( $obj );
		
		if(wfMerge($oldText, $text, $yourtext, $result)){
			$text = $result;
			return true;
		} else {
			return false;
		}
	}


	function checkUnicodeCompliantBrowser() {
		global $wgBrowserBlackList;
		$currentbrowser = $_SERVER[&quot;HTTP_USER_AGENT&quot;];
		foreach ( $wgBrowserBlackList as $browser ) {
			if ( preg_match($browser, $currentbrowser) ) {
				return false;
			}
		}
		return true;
	}

	/**
	 * Format an anchor fragment as it would appear for a given section name
	 * &#64;param string $text
	 * &#64;return string
	 * &#64;access private
	 */
	function sectionAnchor( $text ) {
		global $wgInputEncoding;
		$headline = do_html_entity_decode( $text, ENT_COMPAT, $wgInputEncoding );
		# strip out HTML 
		$headline = preg_replace( '/&lt;.*?' . '&gt;/', '', $headline );
		$headline = trim( $headline );
		$sectionanchor = '#' . urlencode( str_replace( ' ', '_', $headline ) );
		$replacearray = array(
			'%3A' =&gt; ':',
			'%' =&gt; '.'
		);
		return str_replace(
			array_keys( $replacearray ),
			array_values( $replacearray ),
			$sectionanchor );
	}

	/**
	 * Shows a bulletin board style toolbar for common editing functions.
	 * It can be disabled in the user preferences.
	 * The necessary JavaScript code can be found in style/wikibits.js.
	 */
	function getEditToolbar() {
		global $wgStylePath, $wgLang, $wgMimeType;

		/**
		 * toolarray an array of arrays which each include the filename of
		 * the button image (without path), the opening tag, the closing tag,
		 * and optionally a sample text that is inserted between the two when no
		 * selection is highlighted.
		 * The tip text is shown when the user moves the mouse over the button.
		 *
		 * Already here are accesskeys (key), which are not used yet until someone
		 * can figure out a way to make them work in IE. However, we should make
		 * sure these keys are not defined on the edit page.
		 */
		$toolarray=array(
			array(	'image'=&gt;'button_bold.png',
					'open'	=&gt;	&quot;\'\'\'&quot;,
					'close'	=&gt;	&quot;\'\'\'&quot;,
					'sample'=&gt;	wfMsg('bold_sample'),
					'tip'	=&gt;	wfMsg('bold_tip'),
					'key'	=&gt;	'B'
				),
			array(	'image'=&gt;'button_italic.png',
					'open'	=&gt;	&quot;\'\'&quot;,
					'close'	=&gt;	&quot;\'\'&quot;,
					'sample'=&gt;	wfMsg('italic_sample'),
					'tip'	=&gt;	wfMsg('italic_tip'),
					'key'	=&gt;	'I'
				),
			array(	'image'=&gt;'button_link.png',
					'open'	=&gt;	'[[',
					'close'	=&gt;	']]',
					'sample'=&gt;	wfMsg('link_sample'),
					'tip'	=&gt;	wfMsg('link_tip'),
					'key'	=&gt;	'L'
				),
			array(	'image'=&gt;'button_extlink.png',
					'open'	=&gt;	'[',
					'close'	=&gt;	']',
					'sample'=&gt;	wfMsg('extlink_sample'),
					'tip'	=&gt;	wfMsg('extlink_tip'),
					'key'	=&gt;	'X'
				),
			array(	'image'=&gt;'button_headline.png',
					'open'	=&gt;	&quot;\\n== &quot;,
					'close'	=&gt;	&quot; ==\\n&quot;,
					'sample'=&gt;	wfMsg('headline_sample'),
					'tip'	=&gt;	wfMsg('headline_tip'),
					'key'	=&gt;	'H'
				),
			array(	'image'=&gt;'button_image.png',
					'open'	=&gt;	'[['.$wgLang-&gt;getNsText(NS_IMAGE).&quot;:&quot;,
					'close'	=&gt;	']]',
					'sample'=&gt;	wfMsg('image_sample'),
					'tip'	=&gt;	wfMsg('image_tip'),
					'key'	=&gt;	'D'
				),
			array(	'image'	=&gt;	'button_media.png',
					'open'	=&gt;	'[['.$wgLang-&gt;getNsText(NS_MEDIA).':',
					'close'	=&gt;	']]',
					'sample'=&gt;	wfMsg('media_sample'),
					'tip'	=&gt;	wfMsg('media_tip'),
					'key'	=&gt;	'M'
				),
			array(	'image'	=&gt;	'button_math.png',
					'open'	=&gt;	&quot;\\&lt;math\\&gt;&quot;,
					'close'	=&gt;	&quot;\\&lt;/math\\&gt;&quot;,
					'sample'=&gt;	wfMsg('math_sample'),
					'tip'	=&gt;	wfMsg('math_tip'),
					'key'	=&gt;	'C'
				),
			array(	'image'	=&gt;	'button_nowiki.png',
					'open'	=&gt;	&quot;\\&lt;nowiki\\&gt;&quot;,
					'close'	=&gt;	&quot;\\&lt;/nowiki\\&gt;&quot;,
					'sample'=&gt;	wfMsg('nowiki_sample'),
					'tip'	=&gt;	wfMsg('nowiki_tip'),
					'key'	=&gt;	'N'
				),
			array(	'image'	=&gt;	'button_sig.png',
					'open'	=&gt;	'--~~~~',
					'close'	=&gt;	'',
					'sample'=&gt;	'',
					'tip'	=&gt;	wfMsg('sig_tip'),
					'key'	=&gt;	'Y'
				),
			array(	'image'	=&gt;	'button_hr.png',
					'open'	=&gt;	&quot;\\n----\\n&quot;,
					'close'	=&gt;	'',
					'sample'=&gt;	'',
					'tip'	=&gt;	wfMsg('hr_tip'),
					'key'	=&gt;	'R'
				)
		);
		$toolbar =&quot;&lt;script type='text/javascript'&gt;\n/*&lt;![CDATA[*/\n&quot;;

		$toolbar.=&quot;document.writeln(\&quot;&lt;div id='toolbar'&gt;\&quot;);\n&quot;;
		foreach($toolarray as $tool) {

			$image=$wgStylePath.'/common/images/'.$tool['image'];
			$open=$tool['open'];
			$close=$tool['close'];
			$sample = addslashes( $tool['sample'] );

			// Note that we use the tip both for the ALT tag and the TITLE tag of the image.
			// Older browsers show a &quot;speedtip&quot; type message only for ALT.
			// Ideally these should be different, realistically they
			// probably don't need to be.
			$tip = addslashes( $tool['tip'] );

			#$key = $tool[&quot;key&quot;];

			$toolbar.=&quot;addButton('$image','$tip','$open','$close','$sample');\n&quot;;
		}

		$toolbar.=&quot;addInfobox('&quot; . addslashes( wfMsg( &quot;infobox&quot; ) ) . &quot;','&quot; .
addslashes(wfMsg(&quot;infobox_alert&quot;)) . &quot;');\n&quot;;
		$toolbar.=&quot;document.writeln(\&quot;&lt;/div&gt;\&quot;);\n&quot;;

		$toolbar.=&quot;/*]]&gt;*/\n&lt;/script&gt;&quot;;
		return $toolbar;
	}

}

?&gt;</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Tim Graves</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-19 15:26:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=811" name="attach_811" title="Modified version of EditPage.php">attachment 811</a> <a href="attachment.cgi?id=811&amp;action=edit" title="Modified version of EditPage.php">[details]</a></span>
Modified version of EditPage.php

Now I find how to add an attachment !
This is a modified version of the EditPage.php file with support for skeletons
as described in the RFE</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">jacki buros</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-04 18:39:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Any chance this could be updated for version 1.5.4?

this would be very useful for us, as well.
</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rob Church</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-04 20:08:07 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Let's have it as a unified diff, please, not the whole file.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Tim Graves</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-11 15:40:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=1287" name="attach_1287" title="Unified diff of the skeleton code form the 1.4.5 EditPage.php">attachment 1287</a> <a href="attachment.cgi?id=1287&amp;action=edit" title="Unified diff of the skeleton code form the 1.4.5 EditPage.php">[details]</a></span>
Unified diff of the skeleton code form the 1.4.5 EditPage.php

This is the unified diff of the origional 1.4.5 EditPage.php and the version I
modified to handle skeletons.
Note that this stores the skeletons in the main namespace with the prefix
&quot;Skeleton:&quot; (I didn't have the time to figure out how to create a new
namespace) I suspect that a separate namespace for the skeletons may be more
sensible for a formal release</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rob Church</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-11 19:50:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I don't like to shoot this down but

[a] A diff against 1.4.x isn't a huge amount of help to putting this in 1.5
branch, or in HEAD.
[b] Wouldn't it make more sense to use the template namespace?

I'll put my money where my mouth is at some point and have a go at implementing
this myself, however, since it's one of those little ideas I quite like the
sound of, on principle of it being geared towards helping people edit (and
that's what wikis are for).</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Tim Graves</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-11 23:28:03 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I'm sorry for the 1,4 based diff, I don't have any 1.5 based Wiki's up and
running at the moment. I'll prob be updating one of my wikis to 1.5 in a few
weeks so I'll update the code then and provide updated diffs

I think that the skeletons should prob have a separate namespace (though I don't
know how to create it), I'm not sure if the template one is appropriate as they
perform different functions. The skeletons are outline text that can be used as
the basis of a page, subsequent changes to the skeleton does not effect existing
pages built on the skeleton. The templates are different in thet they are reused
every time, a change to the skeleton will show up everywhere the template is used.

There is also a terminology issue, the skeletons are actually similar to
templates in a word processor whereas I think templates in media wiki are almost
like macros in C</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rob Church</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-12 13:41:21 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Actually, we need it against CVS HEAD. ;-)

As for the namespace use, I disagree. Templates are templates, whether we're
transcluding them or dumping their text into an edit box.

OTOH, having a separate namespace makes sense insofar as keeping proper
boilerplate text separate from transcludables (macros, as you call them) in any
drop-down list, which is the way I quite fancied going...

Any other thoughts on this?</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">jacki buros</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-19 02:18:36 UTC
        </span>
      </div>



<pre class="bz_comment_text" >A separate namespace seems cleaner, since more items in a list cause more confusion. 
And, in the case of a user's choosing the wrong template, could result in what a user 
may perceive as unexpected behavior.

for our use, we don't need to replace all article text, so the box could instead 
insert boilerplate text for any template as a cut-and-paste operation. This could 
include both skeletons and more traditional wiki-templates (e.g., references, 
footnotes, etc), similar to the way the toolbar buttons insert apostrophes for bold, 
etc.</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikos</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-23 17:08:24 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=1322" name="attach_1322" title="EditPage.php - patch">attachment 1322</a> <a href="attachment.cgi?id=1322&amp;action=edit" title="EditPage.php - patch">[details]</a></span>
EditPage.php - patch</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mikos</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-23 17:12:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hello, this discussion is very interesting, and I have the same need as well. 
I thought of approaching the same need from a different angle, thoguh. instead
of providing a list of skeleton to pick from in the edit page, I thought I would
just add a parameter to the edit action which specifies a page that would be
preloaded into the text box on page creation. This feature would be hidden from
regular edit actions, but would provide extension writers with the capability to
write an extension that generates simple forms for new page creation.

I created a patch (see above) with with the changes I was thinking about.

Using the patched version, you could use the following extension:

&lt;?php

$wgExtensionFunctions[] = &quot;wfEditPageExtension&quot;;

#-----------------------------------------------#
# Purpose   : Declare parser extensions.

function wfEditPageExtension() {
    global $wgParser;
    $wgParser-&gt;setHook( &quot;EditPage&quot;, &quot;editPageHook&quot; );
}


#-----------------------------------------------#
# Purpose   : Edit a new page with input from
#             a template or skeleton
#
# The aim of this extension is to create a new wiki page
# that is structured according to an existing template or
# skeletion. It outputs a form with a single text box and 
# a submit button. Click the button to edit the page specified 
# in the text box. If the page is a new page, the edit page
# will be loaded with the specified template. Any text 
# specified within the &lt;EditPage&gt; element will appear right
# before the text box.  
#
# &lt;EditPage&gt; element attributes:
# * template - the title of the page to be used as the new page template
# * buttonlabel (optional) - the label on the Submit button (default is &quot;Edit&quot;)
#  
# Example:
#
# &lt;EditPage template=&quot;Template:Form&quot; buttonlabel=&quot;Edit&quot;&gt;Edit this Form:&lt;/EditPage&gt;  

function editPageHook( $input, $args ) {
	global $wgScript;	
		
	$action = htmlspecialchars( $wgScript );
	$template = $args[&quot;template&quot;];
	$buttonlabel = $args[&quot;buttonlabel&quot;] ? $args[&quot;buttonlabel&quot;] : &quot;Edit&quot;; 
	$editform=&lt;&lt;&lt;ENDFORM
&lt;form name=&quot;editbox&quot; action=&quot;$action&quot; method=&quot;get&quot; class=&quot;editbox&quot;&gt;
	&lt;input type='hidden' name=&quot;action&quot; value=&quot;edit&quot;&gt;
	$input
	&lt;input class=&quot;editboxInput&quot; name=&quot;title&quot; type=&quot;text&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;loadFromPage&quot; value=&quot;$template&quot; /&gt;
	&lt;button type='submit' class=&quot;editboxButton&quot;&gt;$buttonlabel&lt;/button&gt;	
&lt;/form&gt;
ENDFORM;
	return $editform;
	
}

?&gt;


</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jesse (Pathoschild)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-06-27 03:36:28 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The relatively recent preload parameter is similar; it inserts the content of a template into a page. You can use the editintro parameter to provide a list of templates, using javascript links to a function changing 'editbox.value'. For more information, see [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=mw%3AManual%3AParameters%20to%20index.php%23Edit_and_submit">mw:Manual:Parameters to index.php#Edit_and_submit</a>]].

If you want a list that appears on any new page (not just with specific URLs), a JavaScript tool would be best. For example, [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=m%3AUser%3APathoschild%2FScript%3ATemplateScript">m:User:Pathoschild/Script:TemplateScript</a>]] could be slightly modified to only show up when the editbox is empty on load.</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Conrad Irwin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-02-17 23:33:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I shudder to think what the code in the first patch does, this is better implemented by extensions, of which there are already many:
 
<a href="http://www.mediawiki.org/wiki/Extension:Preloader">http://www.mediawiki.org/wiki/Extension:Preloader</a> and <a href="http://www.mediawiki.org/wiki/Extension:InputBox">http://www.mediawiki.org/wiki/Extension:InputBox</a> seem to link to most of them.

The second patch has been obsoleted by the ?preload= parameter many years ago.

If there are still specific pieces of functionality missing, please open new bugs (after checking through the similar ones)</pre>
    </div><div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chad H.</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-02-23 20:15:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Improve the new article creation dialog with stub/template."
   href="show_bug.cgi?id=4670">Bug 4670</a> has been marked as a duplicate of this bug. ***</pre>
    </div><div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chad H.</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-28 16:04:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Multiple new page layouts"
   href="show_bug.cgi?id=25348">Bug 25348</a> has been marked as a duplicate of this bug. ***</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ville Saalo</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-09-29 22:14:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I looked through those extensions after my <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Multiple new page layouts"
   href="show_bug.cgi?id=25348">bug 25348</a> was marked a duplicate with this one but still haven't found a solution. All those extensions seem to do is that they provide preloaded per-namespace texts. However, I'd like to have multiple choices in the main namespace. You know, more options into this box, dynamically, without having to edit any .php files: <a href="http://help.wikia.com/wiki/File:Createpagebox.jpg">http://help.wikia.com/wiki/File:Createpagebox.jpg</a></pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3201#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">John Mark Vandenberg</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-11-11 09:40:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=3201#c15">comment #15</a>)
<span class="quote">&gt; I'd like to have multiple choices in the main namespace.</span >

These extensions do that with different features/design limitations.

<a href="https://www.mediawiki.org/wiki/Extension:MultiBoilerplate">https://www.mediawiki.org/wiki/Extension:MultiBoilerplate</a>
<a href="https://www.mediawiki.org/wiki/Extension:BoilerRoom">https://www.mediawiki.org/wiki/Extension:BoilerRoom</a>
<a href="https://www.mediawiki.org/wiki/Extension:BoilerplateSelection">https://www.mediawiki.org/wiki/Extension:BoilerplateSelection</a>
<a href="https://www.mediawiki.org/wiki/Extension:MultiBoilerplate">https://www.mediawiki.org/wiki/Extension:MultiBoilerplate</a>

The last one is, by far, the most promising IMO as it implements most of the logic in JavaScript.

With a bit of development, those extensions could be converted into a JavaScript-only solution, which any user can write and use on Wikipedia (and any mediawiki), requiring no extensions to be installed.  Once tested, it can be made into a gadget for easy installation by all users on the wiki.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

    <hr><div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=3201&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=3201">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=3201">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=3201">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
<div class="visualClear"></div>
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="head" class="noprint">
			<!-- /search -->
			<div id="p-search">
				<h5><label for="searchInput">Search</label></h5>
				<form id="searchform" action="buglist.cgi" method="get"
				 onsubmit="if (this.quicksearch.value == '')
				 { alert('Please enter one or more search terms first.');
				 return false; } return true;">
					<input type='hidden' name="title" value="Special:Search"/>
					<div id="simpleSearch">
						<input id="searchInput" name="quicksearch" type="text" title="Search Bugzilla [alt-f]" accesskey="f" value="" />
						<button id="searchButton" type='submit' name='button' title="Search Bugzilla for this text">&nbsp;</button>
					</div>
				</form>
			</div>
			<!-- /search -->
			<!-- personal -->
			<div id="p-personal" class="">
				<h5>Personal tools</h5>
				<ul >
							<li id="new_account_container">
								<a href="createaccount.cgi">New&nbsp;Account</a>
							</li>
						<li id="mini_login_container">
  <span class="separator">| </span>
  <a id="login_link" href="show_bug.cgi?id=3201&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('')">Log In</a>

  
  <form action="show_bug.cgi?id=3201" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login"
        onsubmit="return check_mini_login_fields( '' );"
  >
    <input id="Bugzilla_login" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('')"
    >
    <input class="bz_password" 
           id="Bugzilla_password" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy" value="password"
           title="Password"
           onfocus="mini_login_on_focus('')"
    >
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "email address",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('')">[x]</a>
  </form>
</li>
<li id="forgot_container">
  <span class="separator">| </span>
  <a id="forgot_link" href="show_bug.cgi?id=3201&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form"
        class="mini_forgot bz_default_hidden">
    <label for="login">Login:</label>
    <input type="text" name="loginname" size="20" id="login">
    <input id="forgot_button" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token" name="token" value="1419361641-ar8GpoGW9KPWGhlGXwbc5TE33R8T-d6XYna-hDs67sU">
    <a href="#" onclick="return hide_forgot_form('')">[x]</a>
  </form>
</li>

				</ul>
			</div>
			<!-- /personal -->
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="panel" class="noprint">
				<!-- logo -->
				<div id="p-logo"><a style="background-image: url(skins/contrib/Wikimedia/images/bugzilla-logo.png);" href="./"  title="Visit the main page"></a></div>
				<!-- /logo -->
				<!-- navigation -->
				<div class="portal">
					<h5>Navigation</h5>
					<div class="body">
						<ul><li><a href="query.cgi?format=specific">Search bugs</a></li>
			<li><a href="query.cgi?format=advanced">Advanced search</a></li>
			<li><a href="describecomponents.cgi">Browse projects</a></li>
			<li><a href="enter_bug.cgi">Enter a new bug</a></li>
                        <li>
                                <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
                        </li>	
						</ul>
					</div>
				</div>
				<!-- /navigation -->
				<!-- interaction -->
				<!-- /interaction -->
				<!-- toolbox -->
				<div class="portal">
					<h5>Links</h5>
					<div class="body">
						<ul><li><a href="report.cgi">Reports</a></li>
			<li><a href="weekly-bug-summary.cgi?tops=10&days=7">Weekly Summary</a></li>
				<li>
						<a href="request.cgi">Requests</a>
				</li>
						</ul>
					</div>
				</div>
				<!-- /toolbox -->
			</div>
		<!-- /panel -->		

		<!-- footer -->
		<div id="footer" >
			<ul id="footer-info">
				<li>Bugzilla version 4.4.5</li>
			</ul>

			<ul id="footer-places">
				<li><a href="https://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Bug_management/Bugzilla_etiquette" title="Bug management/Bugzilla etiquette">Bugzilla etiquette</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:About" title="Project:About">About MediaWiki.org</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:General_disclaimer" title="Project:General disclaimer">Disclaimers</a></li>
			</ul>
			<ul id="footer-icons" class="noprint">
				<li id="footer-icon-poweredby"><a href="http://www.bugzilla.org/"><img src="skins/contrib/Wikimedia/images/bugzilla-badge.png" height="31" width="88" alt="Powered by Bugzilla" /></a></li>
			</ul>
			<div style="clear:both"></div>
		<div class="outro"></div>
		</div>
		<!-- /footer -->
	</body>
</html>