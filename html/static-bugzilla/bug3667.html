<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 3667 &ndash; Moving Pages in PHP 4.1.2 gives fatal error</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://old-bugzilla.wikimedia.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=3667&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=3667">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=3667">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=3667">



    
    <link href="skins/standard/global.css?1389015166"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/global.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/show_bug.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="extensions/Voting/web/style.css?1389015166" rel="stylesheet"
        type="text/css" ><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css?1389015166" rel="stylesheet"
        type="text/css" >
<![endif]-->

    <link href="skins/contrib/Wikimedia/global.css?1402013050" rel="stylesheet"
        type="text/css" title="Wikimedia"><link href="skins/contrib/Wikimedia/show_bug.css?1402441020" rel="stylesheet"
        type="text/css" title="Wikimedia">

      <link rel="stylesheet" href="skins/contrib/Wikimedia/vector.css?1403109885" media="screen"
            title="Wikimedia" />


    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1389015166"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1389015166"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1389015166"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1389015166"></script><script type="text/javascript" src="js/yui/json/json-min.js?1389015166"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1389015166"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1389015166"></script><script type="text/javascript" src="js/global.js?1389015166"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 15
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 3667 – Moving Pages in PHP 4.1.2 gives fatal error",  
                             "show_bug.cgi?id=3667" );
        document.title = "Bug 3667 – Moving Pages in PHP 4.1.2 gives fatal error";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 3667 – Moving Pages in PHP 4.1.2 gives fatal error", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1389015166"></script><script type="text/javascript" src="js/field.js?1389015166"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="old-bugzilla-wikimedia-org bz_bug bz_status_RESOLVED bz_product_MediaWiki bz_component_Interface bz_bug_3667 yui-skin-sam">



<!-- If custom Wikimedia skin -->
   <div id="page-base" class="noprint"></div>
                <div id="head-base" class="noprint"></div>
                <!-- content -->
                <div id="content-container" >
                        <a id="top"></a>
                        <!-- bodyContent -->
                        <div id="bodyContent">
      <p class="header_addl_info">Last modified: 2010-05-15 15:38:26 UTC</p>

 <!-- If custom Wikimedia skin -->
<h1>Wikimedia Bugzilla is closed!</h1><div id="message" style="text-align: center; color: black">Wikimedia has <a href="https://www.mediawiki.org/wiki/Phabricator/versus_Bugzilla">migrated from Bugzilla to Phabricator</a>. Bug reports should be created and updated in <a href="https://phabricator.wikimedia.org">Wikimedia Phabricator</a> instead. Please <a href="https://www.mediawiki.org/wiki/Phabricator/Help#Creating_your_account">create an account in Phabricator and add your Bugzilla email address</a> to it.<br>Wikimedia Bugzilla is read-only. If you try to edit or create any bug report in Bugzilla you will be shown an intentional error message.<br>In order to access the Phabricator task corresponding to a Bugzilla report, just remove "static-" from its URL.<br>You could still run searches in Bugzilla or access your <a href="https://old-bugzilla.wikimedia.org/page.cgi?id=voting%2Fuser.html">list of votes</a> but bug reports will obviously not be up-to-date in Bugzilla.</div>

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2010-05-15 15:38:26">
  <input type="hidden" name="longdesclength" value="9">
  <input type="hidden" name="id" value="3667">
  <input type="hidden" name="token" value="1419362362-NuWuzRNgVUwG7oxPEAQqWH7QGmnHNMugimlhpNEvpps">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=3667"><b>Bug&nbsp;3667</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Moving Pages in PHP 4.1.2 gives fatal error</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td>Moving Pages in PHP 4.1.2 gives fatal error
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('Moving Pages in PHP 4.1.2 gives fatal error', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >MediaWiki</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr>
    
    <td class="field_label">
      <label for="component">
        <a href="describecomponents.cgi?product=MediaWiki">
        Component:</a>
      </label>
    </td>
    
    <td>Interface
    
    (<a href="buglist.cgi?component=Interface&product=MediaWiki&resolution=---"
      target="new_window">Other open bugs</a>)
    
    </td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>
</label>
</th>
        <td>1.5.x
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Windows 2000
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Normal
       normal<span id="votes_container">
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=3667#vote_3667">vote</a>)
  </span>
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=fields.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Nobody - You can work on this!</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'wikibugs-l\x40lists.wikimedia.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=3667&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=3667">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2005-10-10 06:57 UTC by <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2010-05-15 15:38 UTC 
      (<a href="show_activity.cgi?id=3667">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>0 
          users
        <div id="cc_edit_area">
          <br>
        </div>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_browser">


  <a 
      title="Please set this if the described problem seems to happen only in a specific web browser."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_browser"
  >Web browser:</a>

</th>
  <td class="field_value "
      id="field_container_cf_browser"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_platform">


  <a 
      title="The Mobile Platform the described problem was experienced on."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_platform"
  >Mobile Platform:</a>

</th>
  <td class="field_value "
      id="field_container_cf_platform"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_hugglebeta">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_hugglebeta"
  >Assignee Huggle Beta Tester:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_hugglebeta"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=986"
               title="View the content of the attachment">
          <b>includes/Title.php patch for MediaWiki 1.5.0</b></a>

          <span class="bz_attach_extra_info">
              (14.46 KB,
                patch)

            <br>
            <a href="#attach_986"
               title="Go to the comment associated with the attachment">2005-10-13 02:46 UTC</a>,

            <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=986&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
        </span>
        <a href="attachment.cgi?bugid=3667&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1389015166" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-10 06:57:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Setup:
Debian Woody <a href="https://www.mediawiki.org/wiki/Special:Code/MediaWiki/3" title="revision 3 in SVN">r3</a>.0 (a.k.a. &quot;Brion's mortal enemy&quot;) running PHP 4.1.2 with
MediaWiki 1.5.0

Background:
Trying to modify MediaWiki to make it suitable for use for running my personal
homepage.

To repo:
0) To LocalSettings.php add &quot;$wgUseDatabaseMessages = false;&quot;, so as to allow
the UI to be customized.
1) Edit languages/LanguageEn.php, and add this line:
$wgAllMessagesEn['mainpage']   = &quot;Nick's Homepage&quot;;
2) Login as Wikisysop.
3) Move the &quot;Main Page&quot;, to &quot;Nick's Homepage&quot;.

Expected results: 
The move succeeds.

Actual Results:
Gives this error:
--------------------------
Warning: Wrong datatype for first argument in call to array_key_exists in
/var/www/hosts/wiki-homepage/wiki/includes/Hooks.php on line 42

Fatal error: Call to a member function on a non-object in
/var/www/hosts/wiki-homepage/wiki/includes/Title.php on line 664
--------------------------

Should this work, or have I done something dumb? Also despite the error it seems
to have moved the page successfully, so setting the severity to &quot;minor&quot;.</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rob Church</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-10 08:08:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >If the page moved, then I wouldn't worry. However, you don't need to make
changes to the code to change the interface any more. Going into
MediaWiki:Mainpage and changing the text there to &quot;Nick's Homepage&quot; would have
set up the default page easily; moving the page from &quot;Main Page&quot; to &quot;Nick's
Homepage&quot; is a trifling matter.

Then again, you seem to be more worried about the error message, and rightly so.
Can you reproduce the error - does moving any other page throw up the same results?</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-11 03:11:17 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Thank you for the tip about &quot;MediaWiki:Mainpage&quot; - that's a much easier way of
doing it.

With the error, I can reproduce the error on the current wiki.

Created an article called &quot;Test&quot;, and then moved it to &quot;Test's test&quot;.

Gives this error:
--------------------
Warning: Wrong datatype for first argument in call to array_key_exists in
/var/www/hosts/wiki-homepage/wiki/includes/Hooks.php on line 42

Fatal error: Call to a member function on a non-object in
/var/www/hosts/wiki-homepage/wiki/includes/Title.php on line 664
--------------------

So as to eliminate any changes or customizations that I may have made being the
cause of the problem, I made a new virtual host, with an unmodified copy of
MediaWiki 1.5.0, and recorded all the steps I followed starting right at
installation through to getting the error message. Steps are shown below in the
hope that it may be of assistance:

ludo:/var/www/# cd /var/www/hosts/
ludo:/var/www/hosts# mkdir mediawiki-test
ludo:/var/www/hosts# cd mediawiki-test
ludo:/var/www/hosts/mediawiki-test# tar xfz ~/tmp/mediawiki-1.5.0.tar.gz 
ludo:/var/www/hosts/mediawiki-test# mv mediawiki-1.5.0/ wiki
ludo:/var/www/hosts/mediawiki-test# chown -R www-data.www-data /var/www/hosts
ludo:/var/www/hosts/mediawiki-test#

Then the browser steps:
* open <a href="http://mediawiki-test/wiki">http://mediawiki-test/wiki</a>
* click setup link
* gives this output:

Please include all of the lines below when reporting installation problems.

Checking environment...

    * WARNING: PHP 4.3.2 or higher is recommended. Older versions from 4.1.x up
may work but are not actively supported. PHP 4.1.2: ok
    * Warning: PHP's register_globals option is enabled. MediaWiki will work
correctly, but this setting increases your exposure to potential security
vulnerabilities in PHP-based software running on your server. You should disable
it if you are able.
    * PHP server API is apache; ok, using pretty URLs (index.php/Page_Title)
    * Have XML / Latin1-UTF-8 conversion support.
    * PHP's memory_limit is 16M. If this is too low, installation may fail!
Attempting to raise limit to 20M... ok.
    * Have zlib support; enabling output compression.
    * Neither Turck MMCache nor eAccelerator are installed, can't use object
caching functions
    * GNU diff3 not found.
    * Found GD graphics library built-in, image thumbnailing will be enabled if
you enable uploads.
    * Installation directory: /var/www/hosts/mediawiki-test/wiki
    * Script URI path: /wiki

* Configure as follows:
Site name: mediawiki-test
Contact e-mail: &lt;I'm omitting this to limit spam&gt;
Language: en- English
no license metadata
Sysop account name: Nickj
password: test
pwd again: test
no caching
email: enabled
User-to-user e-mail: enabled
E-mail notification: enabled for changes of watch-listed and user_talk pages
E-mail address authentication: disabled
MySQL server: localhost
Database name: wikitest
db user: wikiuser
DB password: test
DB wd again: test
Database table prefix: &lt;blank/none/not specified&gt;
DB root password: &lt;blank/none/not specified&gt;

* click &quot;Install&quot;
* Output as follows:

MediaWiki 1.5.0 installation

Please include all of the lines below when reporting installation problems.
Checking environment...

    * WARNING: PHP 4.3.2 or higher is recommended. Older versions from 4.1.x up
may work but are not actively supported. PHP 4.1.2: ok
    * Warning: PHP's register_globals option is enabled. MediaWiki will work
correctly, but this setting increases your exposure to potential security
vulnerabilities in PHP-based software running on your server. You should disable
it if you are able.
    * PHP server API is apache; ok, using pretty URLs (index.php/Page_Title)
    * Have XML / Latin1-UTF-8 conversion support.
    * PHP's memory_limit is 16M. If this is too low, installation may fail!
Attempting to raise limit to 20M... ok.
    * Have zlib support; enabling output compression.
    * Neither Turck MMCache nor eAccelerator are installed, can't use object
caching functions
    * GNU diff3 not found.
    * Found GD graphics library built-in, image thumbnailing will be enabled if
you enable uploads.
    * Installation directory: /var/www/hosts/mediawiki-test/wiki
    * Script URI path: /wiki
    * PHP is linked with old MySQL client libraries. If you are using a MySQL
4.1 server and have problems connecting to the database, see
<a href="http://dev.mysql.com/doc/mysql/en/old-client.html">http://dev.mysql.com/doc/mysql/en/old-client.html</a> for help.
    * Trying to connect to MySQL on localhost as root...
          o Connected as root (automatic)
    * Connected to 3.23.49
    * Created database wikitest
    * Creating tables... done.
    * Initializing data...
    * Granting user permissions...
    * Created sysop account Nickj.
    *

Initialising &quot;MediaWiki&quot; namespace...
Clearing message cache...Done.

      Creating LocalSettings.php...

      Installation successful! Move the config/LocalSettings.php file into the
parent directory, then follow this link to your wiki.

* Moved config/LocalSettings.php:
ludo:/var/www/hosts/mediawiki-test# mv wiki/config/LocalSettings.php wiki/
ludo:/var/www/hosts/mediawiki-test#

* Click the link ( <a href="http://mediawiki-test/wiki/index.php">http://mediawiki-test/wiki/index.php</a> ) to open the wiki
* Looks normal.
* Go to <a href="http://mediawiki-test/wiki/index.php/test">http://mediawiki-test/wiki/index.php/test</a>
* Click &quot;edit&quot;
* Type &quot;this is a test&quot;
* save page
* Click &quot;create an account or login&quot; (as anons cannot move page)
* Enter username &quot;Nickj&quot;, pwd &quot;test&quot;, tick &quot;Remember me&quot;, click &quot;login&quot;.
* Click &quot;return the test&quot; link
* click move
* Enter new title as &quot;Test's test&quot;, click &quot;Move page&quot;.
* get a white screen with this error message:
--------------------------------
Warning: Wrong datatype for first argument in call to array_key_exists in
/var/www/hosts/mediawiki-test/wiki/includes/Hooks.php on line 42

Fatal error: Call to a member function on a non-object in
/var/www/hosts/mediawiki-test/wiki/includes/Title.php on line 664
--------------------------------
* Then if I press the browser's back button (to go to
<a href="http://wiki-homepage/wiki/index.php/Test">http://wiki-homepage/wiki/index.php/Test</a> ) I get this error message:
--------------------------------
Fatal error: Call to a member function on a non-object in
/var/www/hosts/wiki-homepage/wiki/includes/Database.php on line 1667
--------------------------------
* Then I went to the homepage, <a href="http://wiki-homepage/wiki/">http://wiki-homepage/wiki/</a> , and it keeps giving
the error above:
--------------------------------
Fatal error: Call to a member function on a non-object in
/var/www/hosts/wiki-homepage/wiki/includes/Database.php on line 1667
--------------------------------
* Pressing reload, and shift-reload, gives the same error. In MS Internet
Explorer 5 I tried to clear the cache by going tools -&gt; internet options -&gt;
general tab -&gt; delete files -&gt; ticked box to also delete offline content (just
in case) -&gt; click OK -&gt; click OK. Then closed IE, and then restarted it (just to
be safe again), and then went to <a href="http://wiki-homepage/wiki/">http://wiki-homepage/wiki/</a> again. Same error
message: &quot;Fatal error: Call to a member function on a non-object in
/var/www/hosts/wiki-homepage/wiki/includes/Database.php on line 1667&quot;. 

At this point, I think I've basically hosed my mediawiki-test wiki ... So, in
answer to your question, yes, the error worries me a bit :-)  Also I'm thinking
now the severity might be higher than minor.

-- All the best, Nick.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-11 04:38:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Please disregard from &quot;Then if I press the browser's back button&quot; onwards in the
above message (before this about the move-error is still correct, but after this
point about the database-error it is wrong). The reason is (and I should have
seen this in the URLs) is that for some reason pressing back in IE went back to
the original (non-test) wiki.

When the test wiki was installed, I used the same DB username but a different
password for the new wiki, and the setup configures the DB user's password as
specified. So, the setup of the new wiki meant the original wiki could not
access the database, which caused it to give an error.

Strangely, it gives different messages in IE and Firefox - Firefox says:
-------------------------------------------------------------------
Sorry! The wiki is experiencing some technical difficulties, and cannot contact
the database server.
Access denied for user: 'wikiuser&#64;localhost' (Using password: YES) (localhost)
-------------------------------------------------------------------
(which is a far more informative error)

whilst IE keeps showing :
-------------------------------------------------------------------
Fatal error: Call to a member function on a non-object in
/var/www/hosts/wiki-homepage/wiki/includes/Database.php on line 1667
-------------------------------------------------------------------

However after changing both wikis to use the same password, then both sites can
be accessed in both browsers.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-11 05:09:09 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Can you reproduce this with PHP 4.3.x/4.4.0/5.x?
</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-11 07:31:53 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Don't know, and I don't currently have a PHP 4.3.x/4.4.0/5.x install with which
I can test this.

I've also since tried moving pages without any apostrophes or any spaces in the
name in case that was the problem (for example I tried moving &quot;T2&quot; to &quot;T3&quot;), and
this generates the error too.

On further investigation, it looks like it's this PHP bug:
<a href="http://bugs.php.net/bug.php?id=20865">http://bugs.php.net/bug.php?id=20865</a> [array_key_exists() fails to find NULL
key]. When I run the test script from that bug in PHP 4.1.2, it generates an
error which says:
=============================================
ludo:~# ~/tmp/test.php 
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  Wrong datatype for first argument in call to array_key_exists
in &lt;b&gt;/root/tmp/test.php&lt;/b&gt; on line &lt;b&gt;16&lt;/b&gt;&lt;br /&gt;
ludo:~# 
=============================================
Looks pretty similar.

I then edited Hooks.php as follows:
=====================================================================
--- includes/Hooks.php.bak   Tue Oct 11 17:15:11 2005
+++ includes/Hooks.php       Tue Oct 11 17:21:56 2005
&#64;&#64; -39,6 +39,11 &#64;&#64;
                        return false;
                }
 
+               if (is_null($event)) {
+                       //#### wfDieDebugBacktrace(&quot;Event was null!\n&quot;);
+                       return false;
+               }
+
                if (!array_key_exists($event, $wgHooks)) {
                        return true;
                }
=====================================================================

This stopped the first of the messages I see, so that now the only error message
is like this:
=====================================================================
Fatal error: Call to a member function on a non-object in
/var/www/hosts/mediawiki-test/wiki/includes/Title.php on line 664
=====================================================================

By the way, the wfDieDebugBacktrace call is commented out because if it's not, I
get this error:
=====================================================================
Fatal error: Call to undefined function: wfdiedebugbacktrace() in
/var/www/hosts/mediawiki-test/wiki/includes/Hooks.php on line 44
=====================================================================

... which suggests to me that it's fairly likely that none of the other calls to
wfDieDebugBacktrace (located both above and below the one I inserted) are going
to work either.</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-13 02:46:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=986" name="attach_986" title="includes/Title.php patch for MediaWiki 1.5.0">attachment 986</a> <a href="attachment.cgi?id=986&amp;action=edit" title="includes/Title.php patch for MediaWiki 1.5.0">[details]</a></span>
includes/Title.php patch for MediaWiki 1.5.0

Visual inspection of the code lead me to suspect that includes/Title.php was
the problem, and specifically that it might be something to do with reference
abuse (which in PHP &lt; 4.4 can corrupt memory), plus one or more null values
being used somewhere. So, I modified includes/Title.php to remove the cruft
that stood out the most (namely: unused vars + one un-initialized var that
should be global + unused globals + the use of references that seemed worst).
Patch against MediaWiki 1.5.0 is attached. With this applied, page moves are
now working successfully again in PHP 4.1.2.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Jenkins</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-20 03:01:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hi, If the above patch is going to take a while to review, can I please request
that a one-line subset of the above patch be applied? Namely the line adding the
&quot;global $wgUser;&quot; around line 1659. This type of fix would qualify for inclusion
in a Linux 2.6.x.y point release (i.e. it's a trivial and simple and short fix,
it helps fix a definite problem, which has affected real users), and for these
reasons I think it would be good to apply this to MediaWiki sooner rather than
later. I have not tested whether this line alone will fix page moves in PHP
4.1.2, but it is definitely a significant part of the problem.</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3667#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-29 06:05:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Added the global, not touching the other bits if there's not any clear reason for it. 
PHP 4.1.2 is no longer supported, so don't really care if it works or not, but it's 
incorrect to be missing the global. :)</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

    <hr><div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=3667&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=3667">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=3667">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=3667">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
<div class="visualClear"></div>
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="head" class="noprint">
			<!-- /search -->
			<div id="p-search">
				<h5><label for="searchInput">Search</label></h5>
				<form id="searchform" action="buglist.cgi" method="get"
				 onsubmit="if (this.quicksearch.value == '')
				 { alert('Please enter one or more search terms first.');
				 return false; } return true;">
					<input type='hidden' name="title" value="Special:Search"/>
					<div id="simpleSearch">
						<input id="searchInput" name="quicksearch" type="text" title="Search Bugzilla [alt-f]" accesskey="f" value="" />
						<button id="searchButton" type='submit' name='button' title="Search Bugzilla for this text">&nbsp;</button>
					</div>
				</form>
			</div>
			<!-- /search -->
			<!-- personal -->
			<div id="p-personal" class="">
				<h5>Personal tools</h5>
				<ul >
							<li id="new_account_container">
								<a href="createaccount.cgi">New&nbsp;Account</a>
							</li>
						<li id="mini_login_container">
  <span class="separator">| </span>
  <a id="login_link" href="show_bug.cgi?id=3667&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('')">Log In</a>

  
  <form action="show_bug.cgi?id=3667" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login"
        onsubmit="return check_mini_login_fields( '' );"
  >
    <input id="Bugzilla_login" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('')"
    >
    <input class="bz_password" 
           id="Bugzilla_password" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy" value="password"
           title="Password"
           onfocus="mini_login_on_focus('')"
    >
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "email address",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('')">[x]</a>
  </form>
</li>
<li id="forgot_container">
  <span class="separator">| </span>
  <a id="forgot_link" href="show_bug.cgi?id=3667&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form"
        class="mini_forgot bz_default_hidden">
    <label for="login">Login:</label>
    <input type="text" name="loginname" size="20" id="login">
    <input id="forgot_button" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token" name="token" value="1419362362-VtBJ4JZ5KV6ThYeTa9BrYkVtcwfPjoDTQg-kuYb-dS8">
    <a href="#" onclick="return hide_forgot_form('')">[x]</a>
  </form>
</li>

				</ul>
			</div>
			<!-- /personal -->
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="panel" class="noprint">
				<!-- logo -->
				<div id="p-logo"><a style="background-image: url(skins/contrib/Wikimedia/images/bugzilla-logo.png);" href="./"  title="Visit the main page"></a></div>
				<!-- /logo -->
				<!-- navigation -->
				<div class="portal">
					<h5>Navigation</h5>
					<div class="body">
						<ul><li><a href="query.cgi?format=specific">Search bugs</a></li>
			<li><a href="query.cgi?format=advanced">Advanced search</a></li>
			<li><a href="describecomponents.cgi">Browse projects</a></li>
			<li><a href="enter_bug.cgi">Enter a new bug</a></li>
                        <li>
                                <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
                        </li>	
						</ul>
					</div>
				</div>
				<!-- /navigation -->
				<!-- interaction -->
				<!-- /interaction -->
				<!-- toolbox -->
				<div class="portal">
					<h5>Links</h5>
					<div class="body">
						<ul><li><a href="report.cgi">Reports</a></li>
			<li><a href="weekly-bug-summary.cgi?tops=10&days=7">Weekly Summary</a></li>
				<li>
						<a href="request.cgi">Requests</a>
				</li>
						</ul>
					</div>
				</div>
				<!-- /toolbox -->
			</div>
		<!-- /panel -->		

		<!-- footer -->
		<div id="footer" >
			<ul id="footer-info">
				<li>Bugzilla version 4.4.5</li>
			</ul>

			<ul id="footer-places">
				<li><a href="https://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Bug_management/Bugzilla_etiquette" title="Bug management/Bugzilla etiquette">Bugzilla etiquette</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:About" title="Project:About">About MediaWiki.org</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:General_disclaimer" title="Project:General disclaimer">Disclaimers</a></li>
			</ul>
			<ul id="footer-icons" class="noprint">
				<li id="footer-icon-poweredby"><a href="http://www.bugzilla.org/"><img src="skins/contrib/Wikimedia/images/bugzilla-badge.png" height="31" width="88" alt="Powered by Bugzilla" /></a></li>
			</ul>
			<div style="clear:both"></div>
		<div class="outro"></div>
		</div>
		<!-- /footer -->
	</body>
</html>