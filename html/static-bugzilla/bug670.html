<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 670 &ndash; special characters in anchor part of interwiki links not escaped 'correctly'</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://old-bugzilla.wikimedia.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=670&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=670">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=670">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=670">



    
    <link href="skins/standard/global.css?1389015166"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/global.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/show_bug.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="extensions/Voting/web/style.css?1389015166" rel="stylesheet"
        type="text/css" ><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css?1389015166" rel="stylesheet"
        type="text/css" >
<![endif]-->

    <link href="skins/contrib/Wikimedia/global.css?1402013050" rel="stylesheet"
        type="text/css" title="Wikimedia"><link href="skins/contrib/Wikimedia/show_bug.css?1402441020" rel="stylesheet"
        type="text/css" title="Wikimedia">

      <link rel="stylesheet" href="skins/contrib/Wikimedia/vector.css?1403109885" media="screen"
            title="Wikimedia" />


    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1389015166"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1389015166"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1389015166"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1389015166"></script><script type="text/javascript" src="js/yui/json/json-min.js?1389015166"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1389015166"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1389015166"></script><script type="text/javascript" src="js/global.js?1389015166"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 15
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 670 – special characters in anchor part of interwiki links not escaped \'correctly\'",  
                             "show_bug.cgi?id=670" );
        document.title = "Bug 670 – special characters in anchor part of interwiki links not escaped \'correctly\'";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 670 – special characters in anchor part of interwiki links not escaped \'correctly\'", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1389015166"></script><script type="text/javascript" src="js/field.js?1389015166"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="old-bugzilla-wikimedia-org bz_bug bz_status_RESOLVED bz_product_Wikimedia bz_component_Interwiki_links bz_bug_670 yui-skin-sam">



<!-- If custom Wikimedia skin -->
   <div id="page-base" class="noprint"></div>
                <div id="head-base" class="noprint"></div>
                <!-- content -->
                <div id="content-container" >
                        <a id="top"></a>
                        <!-- bodyContent -->
                        <div id="bodyContent">
      <p class="header_addl_info">Last modified: 2010-06-21 21:11:47 UTC</p>

 <!-- If custom Wikimedia skin -->
<h1>Wikimedia Bugzilla is closed!</h1><div id="message" style="text-align: center; color: black">Wikimedia has <a href="https://www.mediawiki.org/wiki/Phabricator/versus_Bugzilla">migrated from Bugzilla to Phabricator</a>. Bug reports should be created and updated in <a href="https://phabricator.wikimedia.org">Wikimedia Phabricator</a> instead. Please <a href="https://www.mediawiki.org/wiki/Phabricator/Help#Creating_your_account">create an account in Phabricator and add your Bugzilla email address</a> to it.<br>Wikimedia Bugzilla is read-only. If you try to edit or create any bug report in Bugzilla you will be shown an intentional error message.<br>In order to access the Phabricator task corresponding to a Bugzilla report, just remove "static-" from its URL.<br>You could still run searches in Bugzilla or access your <a href="https://old-bugzilla.wikimedia.org/page.cgi?id=voting%2Fuser.html">list of votes</a> but bug reports will obviously not be up-to-date in Bugzilla.</div>

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2010-06-21 21:11:47">
  <input type="hidden" name="longdesclength" value="10">
  <input type="hidden" name="id" value="670">
  <input type="hidden" name="token" value="1419357668-vURsS4NNZpKY62gBN_XfqpYGWaH8HNNEDGxTq_NdH1w">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=670"><b>Bug&nbsp;670</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">special characters in anchor part of interwiki links not escaped 'correctly'</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td>special characters in anchor part of interwiki links not escaped 'correctly'
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('special characters in anchor part of interwiki links not escaped \'correctly\'', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          WORKSFORME
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Wikimedia</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr>
    
    <td class="field_label">
      <label for="component">
        <a href="describecomponents.cgi?product=Wikimedia">
        Component:</a>
      </label>
    </td>
    
    <td>Interwiki links
    
    (<a href="buglist.cgi?component=Interwiki%20links&product=Wikimedia&resolution=---"
      target="new_window">Other open bugs</a>)
    
    </td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Windows XP
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Normal
       normal<span id="votes_container">
      with
      <a href="page.cgi?id=voting/bug.html&amp;bug_id=670">1 
            vote</a>
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=670#vote_670">vote</a>)
  </span>
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=fields.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Nobody - You can work on this!</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'wikibugs-l\x40lists.wikimedia.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
          <a href="http://meta.wikimedia.org/wiki/User:Gangleri/remarks#InterWiki_link_translation"><span title="http://meta.wikimedia.org/wiki/User:Gangleri/remarks#InterWiki_link_translation">http://meta.wikimedia.org/wiki/User:G...
        </span></a>
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=670&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=670">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2004-10-09 20:13 UTC by <span class="vcard"><span class="fn">lɛʁi לערי ריינהארט</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2010-06-21 21:11 UTC 
      (<a href="show_activity.cgi?id=670">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>3 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="bugzillas+padREMOVETHISdu">bugzillas+padREMOVETHISdu</option>
                <option value="conrad.irwin">conrad.irwin</option>
                <option value="gangleri">gangleri</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_browser">


  <a 
      title="Please set this if the described problem seems to happen only in a specific web browser."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_browser"
  >Web browser:</a>

</th>
  <td class="field_value "
      id="field_container_cf_browser"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_platform">


  <a 
      title="The Mobile Platform the described problem was experienced on."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_platform"
  >Mobile Platform:</a>

</th>
  <td class="field_value "
      id="field_container_cf_platform"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_hugglebeta">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_hugglebeta"
  >Assignee Huggle Beta Tester:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_hugglebeta"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
        <a href="attachment.cgi?bugid=670&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1389015166" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">lɛʁi לערי ריינהארט</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-10-09 20:13:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Dear friends,

Please take a look at 
<a href="http://meta.wikimedia.org/wiki/User:Gangleri/remarks#InterW">http://meta.wikimedia.org/wiki/User:Gangleri/remarks#InterW</a>
iki_link_translation and 
<a href="http://en.wikipedia.org/wiki/User:Gangleri/remarks#proper_l">http://en.wikipedia.org/wiki/User:Gangleri/remarks#proper_l</a>
ink_translation .

Please see the differences. Thanks!

Regards Reinhardt</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">lɛʁi לערי ריינהארט</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-10 02:31:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >More about anchors:

Part I: Just for your information. Would be to much to fix.

a) Sections and subsection titels can look very odd.

See [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%3Aen%3AWikipedia%20%0Atalk%3ACategorization%23Poll_about_Category%3AWhatever.7C.2A_.2C_.7C.28space.29.2C%0A_.7C.21">:en:Wikipedia 
talk:Categorization#Poll_about_Category:Whatever.7C.2A_.2C_.7C.28space.29.2C
_.7C.21</a>|en:Wikipedia talk:Categorization#Poll about Category:Whatever|* , |
(space), |!]] and look how the link to the anchor was made.

b) Tray to create a section / subsection and use an internal link [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=foo">foo</a>]] 
and /or an interwiki link [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%3Azn%3Afoo">:zn:foo</a>]] or an external link 
[<a href="http://www.foo.int/">http://www.foo.int/</a> foo] in the title. Save the section / subsection and 
look at the url in your browser.

c) Tray to use '''font''' ''styles'' and / or &quot;quotes&quot; and / or 'marks' as 
title. Tray all the special characters !%&amp;?*# and so on.

Part B:

At [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%3Ais%3ANotandi%3AGangleri%2Ftest%2FSni%C3%B0%3AFlokkatr%C3%A9">:is:Notandi:Gangleri/test/Snið:Flokkatré</a>]] there are 
two &quot;'''anchors'''&quot; &lt;nowiki&gt;&lt;font id=&quot;Landafraedi&quot; /&gt; and &lt;font 
id=&quot;Island&quot; /&gt;&lt;/nowiki&gt;. They work only because in both cases special 
characters as &quot;æð&quot; in &quot;Landafræði&quot; and &quot;Í&quot; in &quot;Ísland&quot; have been replaced.

I would be happy, if the issue with the special characters and ( and ) 
could be solved.

Best regards ~~~~
</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">lɛʁi לערי ריינהארט</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-10 16:04:51 UTC
        </span>
      </div>



<pre class="bz_comment_text" >See also [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=bug%20845">bug 845</a>]] and [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=test%3AUser%3AGangleri%2Ftests%2Fanchors">test:User:Gangleri/tests/anchors</a>]].
Regards Reinhardt</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Wikipedia:en:User:Paddu</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-11 18:57:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Here's a step-by-step procedure to illustrate at least one of the bugs:

1. Open this URL:
<a href="http://test.wikipedia.org/w/index.php?title=User:Gangleri/tests/anchors&amp;action=edit&amp;section=17">http://test.wikipedia.org/w/index.php?title=User:Gangleri/tests/anchors&amp;action=edit&amp;section=17</a>
.
2. Click &quot;save page&quot; (need not change any text in the page).
3. Expected: URL loaded:
<a href="http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#edit_here">http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#edit_here</a>
   Actual: URL loaded:
<a href="http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#.5B.5Bedit.5D.5D_here">http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#.5B.5Bedit.5D.5D_here</a>

Similarly for
<a href="http://test.wikipedia.org/w/index.php?title=User:Gangleri/tests/anchors&amp;action=edit&amp;section=18">http://test.wikipedia.org/w/index.php?title=User:Gangleri/tests/anchors&amp;action=edit&amp;section=18</a>
the browser goes to
<a href="http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#here_.27.27.27too.27.27.27">http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#here_.27.27.27too.27.27.27</a>
instead of <a href="http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#here_too">http://test.wikipedia.org/wiki/User:Gangleri/tests/anchors#here_too</a>.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">lɛʁi לערי ריינהארט</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-16 04:54:51 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Additional remark(s):

Spaces (also multiple subsequent spaces) are translated correctly in an 
anchor of an interwiki link.

See some examples (and an link to real &quot;[[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=en%3APathology">en:Pathology</a>|pathological]]&quot; 
anchor) at <a href="http://test.wikipedia.org/w/index.php?title=User%3AGangleri">http://test.wikipedia.org/w/index.php?title=User%3AGangleri</a>%
2Ftests%2Fanchors&amp;diff=0&amp;oldid=4348

Regards Reinhardt</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rowan Collins [IMSoP]</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-06 17:45:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >If I understand this report correctly, the precise problem can be summarised as
follows (for reference, this paragraph would have been an ideal initial comment
for this bug report):

When typing an internal link to a section, you can use &quot;special&quot; characters like
&quot;(&quot;, &quot;)&quot;, etc and they will be converted to the &quot;escaped&quot; forms like &quot;.28&quot; and
&quot;.29&quot; (e.g. &quot;[[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%23foo%20%28bar%29">#foo (bar)</a>]]&quot; is equivalent to &quot;[[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%23foo_.28bar.29">#foo_.28bar.29</a>]]&quot;). However,
InterWiki links don't undergo this transformation, resulting in invalid links
(e.g. &quot;[[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=fr%3AFoo%23foo%20%28bar%29">fr:Foo#foo (bar)</a>]]&quot; will create a link to .../wiki/foo#foo_%28bar%29
not .../wiki/foo#foo_.28bar.29)

I think this is basically a matter of how much we assume to know about the
target of an interwiki link - many interwiki links are to non-MediaWiki sites,
which won't follow these special escaping rules. One possibility would be to
escape the link differently depending whether the interwiki prefix is marked in
the database as &quot;local&quot; or not (i.e. assume that everything 'local' is a
MediaWiki, and everything else isn't).

At first sight, it would seem logical to make incoming URLs with &quot;wrong&quot;
characters in behave as though they had them escaped, but this is awkward
because the wiki can't manipulate the address requested other than telling the
browser to reload as though it was a different page (it's entirely up to the
browser to scroll the page based on text after the &quot;#&quot;).



To reply to some other comments:

(In reply to <a href="show_bug.cgi?id=670#c1">comment #1</a>)
<span class="quote">&gt; a) Sections and subsection titels can look very odd.</span >

There's really not a lot that can be done about that; escaping of some kind is
inevitable unless we simply restrict what characters headings can contain.
However, when working correctly, you should never have to type these escaped
forms, so it shouldn't matter.
 
<span class="quote">&gt; b) Tray to create a section / subsection and use an internal link [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=foo">foo</a>]] 
&gt; and /or an interwiki link [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%3Azn%3Afoo">:zn:foo</a>]] or an external link 
&gt; [<a href="http://www.foo.int/">http://www.foo.int/</a> foo] in the title. Save the section / subsection and 
&gt; look at the url in your browser.</span >

That's an unrelated bug: the &quot;add section&quot; code is guessing wrong what the
anchor will be on the final page. It might be worth filing another bug for.

<span class="quote">&gt; At [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%3Ais%3ANotandi%3AGangleri%2Ftest%2FSni%C3%B0%3AFlokkatr%C3%A9">:is:Notandi:Gangleri/test/Snið:Flokkatré</a>]] there are 
&gt; two &quot;'''anchors'''&quot; &lt;nowiki&gt;&lt;font id=&quot;Landafraedi&quot; /&gt; and &lt;font 
&gt; id=&quot;Island&quot; /&gt;&lt;/nowiki&gt;. They work only because in both cases special 
&gt; characters as &quot;æð&quot; in &quot;Landafræði&quot; and &quot;Í&quot; in &quot;Ísland&quot; have been replaced.</span >

I'm not sure what you mean here; in what sense did they &quot;not work&quot; before this
change? Can you come up with a simplified test-case to demonstrate? If you just
mean that interwiki links weren't generated correctly, as with the main issue in
this report, then that is to be expected, for exactly the same reasons.
</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Richard J. Holton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-06 19:25:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >At least _part_ of the issue here is the difference between the way that the
parser creates anchors from headings (for the purpose of linking from the TOC),
and the way that in-page targets are handled in links (e.g. [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=PAGE%20NAME%23heading">PAGE NAME#heading</a>]].

The code in parser.php (function formatHeading) seems to do more work to ensure
that the anchor can be linked to. In linker.php, function makeKnownLinkObj, the
code is a bit simpler (less robust?), and a very similar bit of code exists in
editPage.php, function sectionAnchor.

Given the relative opacity of the code in parser.php, I'm not sure how practical
it would be to pull the code there into a function visible from linker and
editPage. Something along this line is probably needed.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Wikipedia:en:User:Paddu</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-10 09:39:50 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=670#c5">comment #5</a>)
<span class="quote">&gt; &gt; b) Tray to create a section / subsection and use an internal link [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=foo">foo</a>]] 
&gt; &gt; and /or an interwiki link [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=%3Azn%3Afoo">:zn:foo</a>]] or an external link 
&gt; &gt; [<a href="http://www.foo.int/">http://www.foo.int/</a> foo] in the title. Save the section / subsection and 
&gt; &gt; look at the url in your browser.
&gt; 
&gt; That's an unrelated bug: the &quot;add section&quot; code is guessing wrong what the
&gt; anchor will be on the final page. It might be worth filing another bug for.</span >

Filed as <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - With complex section headers. section editing+saving loads the page with invalid anchors"
   href="show_bug.cgi?id=1860">bug 1860</a>.</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">lɛʁi לערי ריינהארט</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-06-11 10:53:28 UTC
        </span>
      </div>



<pre class="bz_comment_text" ><a class="bz_bug_link 
          bz_status_NEW "
   title="NEW - Copy-and-paste-friendly anchors for section headings"
   href="show_bug.cgi?id=2381">bug 2381</a>: &quot;enhancement request: traying to achive copy and past anchors&quot;
suggests a workaround to handle some / many of the described anchors</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=670#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Conrad Irwin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-06-21 21:11:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >At some point in the last 5 years and 10 days, the parser started anchor-escaping interwiki links in the same way as local links. There are other bugs with anchor link generation, see <a class="bz_bug_link 
          bz_status_PATCH_TO_REVIEW "
   title="PATCH_TO_REVIEW - Anchor links are created based on different methods causing broken links"
   href="show_bug.cgi?id=18431">bug 18431</a> and <a class="bz_bug_link 
          bz_status_NEW "
   title="NEW - Fix fragment identifiers in links to sections"
   href="show_bug.cgi?id=5019">bug 5019</a> et.al., but I think the issue identified in <a href="show_bug.cgi?id=670#c5">comment 5</a> has been solved, so I'm closing this bug.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

    <hr><div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=670&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=670">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=670">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=670">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
<div class="visualClear"></div>
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="head" class="noprint">
			<!-- /search -->
			<div id="p-search">
				<h5><label for="searchInput">Search</label></h5>
				<form id="searchform" action="buglist.cgi" method="get"
				 onsubmit="if (this.quicksearch.value == '')
				 { alert('Please enter one or more search terms first.');
				 return false; } return true;">
					<input type='hidden' name="title" value="Special:Search"/>
					<div id="simpleSearch">
						<input id="searchInput" name="quicksearch" type="text" title="Search Bugzilla [alt-f]" accesskey="f" value="" />
						<button id="searchButton" type='submit' name='button' title="Search Bugzilla for this text">&nbsp;</button>
					</div>
				</form>
			</div>
			<!-- /search -->
			<!-- personal -->
			<div id="p-personal" class="">
				<h5>Personal tools</h5>
				<ul >
							<li id="new_account_container">
								<a href="createaccount.cgi">New&nbsp;Account</a>
							</li>
						<li id="mini_login_container">
  <span class="separator">| </span>
  <a id="login_link" href="show_bug.cgi?id=670&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('')">Log In</a>

  
  <form action="show_bug.cgi?id=670" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login"
        onsubmit="return check_mini_login_fields( '' );"
  >
    <input id="Bugzilla_login" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('')"
    >
    <input class="bz_password" 
           id="Bugzilla_password" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy" value="password"
           title="Password"
           onfocus="mini_login_on_focus('')"
    >
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "email address",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('')">[x]</a>
  </form>
</li>
<li id="forgot_container">
  <span class="separator">| </span>
  <a id="forgot_link" href="show_bug.cgi?id=670&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form"
        class="mini_forgot bz_default_hidden">
    <label for="login">Login:</label>
    <input type="text" name="loginname" size="20" id="login">
    <input id="forgot_button" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token" name="token" value="1419357669-Yw0eb4wRXYbBtWed-oQhoR6U780GMxxUP5kqDJ8pC2g">
    <a href="#" onclick="return hide_forgot_form('')">[x]</a>
  </form>
</li>

				</ul>
			</div>
			<!-- /personal -->
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="panel" class="noprint">
				<!-- logo -->
				<div id="p-logo"><a style="background-image: url(skins/contrib/Wikimedia/images/bugzilla-logo.png);" href="./"  title="Visit the main page"></a></div>
				<!-- /logo -->
				<!-- navigation -->
				<div class="portal">
					<h5>Navigation</h5>
					<div class="body">
						<ul><li><a href="query.cgi?format=specific">Search bugs</a></li>
			<li><a href="query.cgi?format=advanced">Advanced search</a></li>
			<li><a href="describecomponents.cgi">Browse projects</a></li>
			<li><a href="enter_bug.cgi">Enter a new bug</a></li>
                        <li>
                                <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
                        </li>	
						</ul>
					</div>
				</div>
				<!-- /navigation -->
				<!-- interaction -->
				<!-- /interaction -->
				<!-- toolbox -->
				<div class="portal">
					<h5>Links</h5>
					<div class="body">
						<ul><li><a href="report.cgi">Reports</a></li>
			<li><a href="weekly-bug-summary.cgi?tops=10&days=7">Weekly Summary</a></li>
				<li>
						<a href="request.cgi">Requests</a>
				</li>
						</ul>
					</div>
				</div>
				<!-- /toolbox -->
			</div>
		<!-- /panel -->		

		<!-- footer -->
		<div id="footer" >
			<ul id="footer-info">
				<li>Bugzilla version 4.4.5</li>
			</ul>

			<ul id="footer-places">
				<li><a href="https://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Bug_management/Bugzilla_etiquette" title="Bug management/Bugzilla etiquette">Bugzilla etiquette</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:About" title="Project:About">About MediaWiki.org</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:General_disclaimer" title="Project:General disclaimer">Disclaimers</a></li>
			</ul>
			<ul id="footer-icons" class="noprint">
				<li id="footer-icon-poweredby"><a href="http://www.bugzilla.org/"><img src="skins/contrib/Wikimedia/images/bugzilla-badge.png" height="31" width="88" alt="Powered by Bugzilla" /></a></li>
			</ul>
			<div style="clear:both"></div>
		<div class="outro"></div>
		</div>
		<!-- /footer -->
	</body>
</html>