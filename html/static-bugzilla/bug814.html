<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 814 &ndash; LDAP Authentication</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://old-bugzilla.wikimedia.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=814&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=814">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=814">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=814">



    
    <link href="skins/standard/global.css?1389015166"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/global.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/show_bug.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="extensions/Voting/web/style.css?1389015166" rel="stylesheet"
        type="text/css" ><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css?1389015166" rel="stylesheet"
        type="text/css" >
<![endif]-->

    <link href="skins/contrib/Wikimedia/global.css?1402013050" rel="stylesheet"
        type="text/css" title="Wikimedia"><link href="skins/contrib/Wikimedia/show_bug.css?1402441020" rel="stylesheet"
        type="text/css" title="Wikimedia">

      <link rel="stylesheet" href="skins/contrib/Wikimedia/vector.css?1403109885" media="screen"
            title="Wikimedia" />


    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1389015166"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1389015166"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1389015166"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1389015166"></script><script type="text/javascript" src="js/yui/json/json-min.js?1389015166"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1389015166"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1389015166"></script><script type="text/javascript" src="js/global.js?1389015166"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 15
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 814 – LDAP Authentication",  
                             "show_bug.cgi?id=814" );
        document.title = "Bug 814 – LDAP Authentication";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 814 – LDAP Authentication", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1389015166"></script><script type="text/javascript" src="js/field.js?1389015166"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="old-bugzilla-wikimedia-org bz_bug bz_status_CLOSED bz_product_MediaWiki bz_component_User_login_and_signup bz_bug_814 yui-skin-sam">



<!-- If custom Wikimedia skin -->
   <div id="page-base" class="noprint"></div>
                <div id="head-base" class="noprint"></div>
                <!-- content -->
                <div id="content-container" >
                        <a id="top"></a>
                        <!-- bodyContent -->
                        <div id="bodyContent">
      <p class="header_addl_info">Last modified: 2007-03-13 13:10:33 UTC</p>

 <!-- If custom Wikimedia skin -->
<h1>Wikimedia Bugzilla is closed!</h1><div id="message" style="text-align: center; color: black">Wikimedia has <a href="https://www.mediawiki.org/wiki/Phabricator/versus_Bugzilla">migrated from Bugzilla to Phabricator</a>. Bug reports should be created and updated in <a href="https://phabricator.wikimedia.org">Wikimedia Phabricator</a> instead. Please <a href="https://www.mediawiki.org/wiki/Phabricator/Help#Creating_your_account">create an account in Phabricator and add your Bugzilla email address</a> to it.<br>Wikimedia Bugzilla is read-only. If you try to edit or create any bug report in Bugzilla you will be shown an intentional error message.<br>In order to access the Phabricator task corresponding to a Bugzilla report, just remove "static-" from its URL.<br>You could still run searches in Bugzilla or access your <a href="https://old-bugzilla.wikimedia.org/page.cgi?id=voting%2Fuser.html">list of votes</a> but bug reports will obviously not be up-to-date in Bugzilla.</div>

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2007-03-13 13:10:33">
  <input type="hidden" name="longdesclength" value="167">
  <input type="hidden" name="id" value="814">
  <input type="hidden" name="token" value="1419357893-x0qdtSevp-3pFnB9CXqCaA6f6IROm2voskbQh3thM_s">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=814"><b>Bug&nbsp;814</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">LDAP Authentication</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td>LDAP Authentication
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('LDAP Authentication', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">CLOSED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >MediaWiki</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr>
    
    <td class="field_label">
      <label for="component">
        <a href="describecomponents.cgi?product=MediaWiki">
        Component:</a>
      </label>
    </td>
    
    <td>User login and signup
    
    (<a href="buglist.cgi?component=User%20login%20and%20signup&product=MediaWiki&resolution=---"
      target="new_window">Other open bugs</a>)
    
    </td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>
</label>
</th>
        <td>1.10.x
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">All
       All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Normal
       enhancement<span id="votes_container">
      with
      <a href="page.cgi?id=voting/bug.html&amp;bug_id=814">4 
            votes</a>
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=814#vote_814">vote</a>)
  </span>
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=fields.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Ryan Lane</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'wikibugs-l\x40lists.wikimedia.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
          <a href="http://meta.wikimedia.org/wiki/LDAP_Authentication"><span title="http://meta.wikimedia.org/wiki/LDAP_Authentication">http://meta.wikimedia.org/wiki/LDAP_A...
        </span></a>
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">patch
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - Authentication plugin interface"
   href="show_bug.cgi?id=892">892</a> 
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=814&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=814">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2004-11-01 16:39 UTC by <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2007-03-13 13:10 UTC 
      (<a href="show_activity.cgi?id=814">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>15 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="ahecox">ahecox</option>
                <option value="bgmilne">bgmilne</option>
                <option value="cchan">cchan</option>
                <option value="dan_young">dan_young</option>
                <option value="dax">dax</option>
                <option value="don">don</option>
                <option value="gunnar">gunnar</option>
                <option value="mail">mail</option>
                <option value="mde">mde</option>
                <option value="robla">robla</option>
                <option value="stefan.boberg">stefan.boberg</option>
                <option value="tomer">tomer</option>
                <option value="Udo.Adametz">Udo.Adametz</option>
                <option value="wikibugs-l">wikibugs-l</option>
                <option value="wurblzap">wurblzap</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_browser">


  <a 
      title="Please set this if the described problem seems to happen only in a specific web browser."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_browser"
  >Web browser:</a>

</th>
  <td class="field_value "
      id="field_container_cf_browser"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_platform">


  <a 
      title="The Mobile Platform the described problem was experienced on."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_platform"
  >Mobile Platform:</a>

</th>
  <td class="field_value "
      id="field_container_cf_platform"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_hugglebeta">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_hugglebeta"
  >Assignee Huggle Beta Tester:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_hugglebeta"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=254"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Diff of changes to 1.5</span></b></a>

          <span class="bz_attach_extra_info">
              (20.00 KB,
                patch)

            <br>
            <a href="#attach_254"
               title="Go to the comment associated with the attachment">2005-02-03 15:03 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=254&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_application_x-gzip bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=282"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Patch for mediawiki 1.5</span></b></a>

          <span class="bz_attach_extra_info">
              (5.60 KB,
                application/x-gzip)

            <br>
            <a href="#attach_282"
               title="Go to the comment associated with the attachment">2005-02-11 05:51 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=282&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_application_x-gzip bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=283"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Patch for mediawiki 1.4</span></b></a>

          <span class="bz_attach_extra_info">
              (5.21 KB,
                application/x-gzip)

            <br>
            <a href="#attach_283"
               title="Go to the comment associated with the attachment">2005-02-11 05:57 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=283&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a4" class="bz_contenttype_application_x-gzip bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=287"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Updated patch to add LDAP authentication to mediawiki</span></b></a>

          <span class="bz_attach_extra_info">
              (7.29 KB,
                application/x-gzip)

            <br>
            <a href="#attach_287"
               title="Go to the comment associated with the attachment">2005-02-14 02:43 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=287&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a5" class="bz_contenttype_application_x-gzip">
        <td valign="top">
            <a href="attachment.cgi?id=413"
               title="View the content of the attachment">
          <b>Version .8 of the LDAP patch (For Mediawiki 1.4)</b></a>

          <span class="bz_attach_extra_info">
              (6.74 KB,
                application/x-gzip)

            <br>
            <a href="#attach_413"
               title="Go to the comment associated with the attachment">2005-04-09 22:55 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=413&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a6" class="bz_contenttype_application_x-gzip bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=551"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0 of the LDAP patch (For Mediawiki 1.5)</span></b></a>

          <span class="bz_attach_extra_info">
              (7.36 KB,
                application/x-gzip)

            <br>
            <a href="#attach_551"
               title="Go to the comment associated with the attachment">2005-05-15 22:37 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=551&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a7" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=787"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Patch DefaultSettings and Setup ($wgAuth)</span></b></a>

          <span class="bz_attach_extra_info">
              (1.57 KB,
                patch)

            <br>
            <a href="#attach_787"
               title="Go to the comment associated with the attachment">2005-08-14 17:07 UTC</a>,

            <span class="vcard"><span class="fn">D. Datzert</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=787&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a8" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=945"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0a of the LdapAuthentication.php (For Mediawiki 1.5) (=v1.0 plus changes in #50 #51 and #52)</span></b></a>

          <span class="bz_attach_extra_info">
              (17.64 KB,
                text/plain)

            <br>
            <a href="#attach_945"
               title="Go to the comment associated with the attachment">2005-10-07 14:13 UTC</a>,

            <span class="vcard"><span class="fn">Udo Adametz</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=945&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a9" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=1036"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Patch to 1.0.a for require attribute</span></b></a>

          <span class="bz_attach_extra_info">
              (2.89 KB,
                patch)

            <br>
            <a href="#attach_1036"
               title="Go to the comment associated with the attachment">2005-11-01 21:27 UTC</a>,

            <span class="vcard"><span class="fn">Jeff Mandel</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1036&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a10" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=1038"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0b of the LdapAuthentication.php Plugin (for Mediawiki 1.5)</span></b></a>

          <span class="bz_attach_extra_info">
              (17.89 KB,
                text/plain)

            <br>
            <a href="#attach_1038"
               title="Go to the comment associated with the attachment">2005-11-02 23:44 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1038&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a11" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=1042"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0c of the LdapAuthentication.php Plugin (for Mediawiki 1.5)</span></b></a>

          <span class="bz_attach_extra_info">
              (18.18 KB,
                text/plain)

            <br>
            <a href="#attach_1042"
               title="Go to the comment associated with the attachment">2005-11-03 16:06 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1042&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a12" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=1412"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0d of the LdapAuthentication.php Plugin (for Mediawiki 1.5)</span></b></a>

          <span class="bz_attach_extra_info">
              (17.28 KB,
                text/plain)

            <br>
            <a href="#attach_1412"
               title="Go to the comment associated with the attachment">2006-02-22 19:10 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1412&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a13" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=1426"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0e of the LdapAuthentication.php Plugin (for Mediawiki 1.5)</span></b></a>

          <span class="bz_attach_extra_info">
              (17.27 KB,
                text/plain)

            <br>
            <a href="#attach_1426"
               title="Go to the comment associated with the attachment">2006-03-03 00:00 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=1426&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a14" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=2050"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0f of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)</span></b></a>

          <span class="bz_attach_extra_info">
              (22.00 KB,
                text/plain)

            <br>
            <a href="#attach_2050"
               title="Go to the comment associated with the attachment">2006-07-05 03:51 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2050&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a15" class="bz_contenttype_application_x-php bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=2218"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.0g of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)</span></b></a>

          <span class="bz_attach_extra_info">
              (27.62 KB,
                application/x-php)

            <br>
            <a href="#attach_2218"
               title="Go to the comment associated with the attachment">2006-08-12 01:14 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2218&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a16" class="bz_contenttype_application_x-php">
        <td valign="top">
            <a href="attachment.cgi?id=2697"
               title="View the content of the attachment">
          <b>Version 1.0h of the LdapAuthentication.php Plugin (for Mediawiki 1.5+)</b></a>

          <span class="bz_attach_extra_info">
              (28.42 KB,
                application/x-php)

            <br>
            <a href="#attach_2697"
               title="Go to the comment associated with the attachment">2006-11-13 22:54 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2697&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a17" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=2798"
               title="View the content of the attachment">
          <b>Ldap Group Support against 1.0e</b></a>

          <span class="bz_attach_extra_info">
              (5.13 KB,
                patch)

            <br>
            <a href="#attach_2798"
               title="Go to the comment associated with the attachment">2006-11-30 07:55 UTC</a>,

            <span class="vcard"><span class="fn">Alfons Zitterbacke</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2798&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a18" class="bz_contenttype_application_x-php bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=2823"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.1a of the LdapAuthentication.php plugin (for Mediawiki 1.6+)</span></b></a>

          <span class="bz_attach_extra_info">
              (35.84 KB,
                application/x-php)

            <br>
            <a href="#attach_2823"
               title="Go to the comment associated with the attachment">2006-12-04 19:15 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2823&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a19" class="bz_contenttype_application_x-php bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=2830"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.1b of the LdapAuthentication.php plugin (for Mediawiki 1.6+)</span></b></a>

          <span class="bz_attach_extra_info">
              (36.14 KB,
                application/x-php)

            <br>
            <a href="#attach_2830"
               title="Go to the comment associated with the attachment">2006-12-06 22:14 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2830&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a20" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=2857"
               title="View the content of the attachment">
          <b>Patch to 1.1b including hacks to support NTLM</b></a>

          <span class="bz_attach_extra_info">
              (3.21 KB,
                patch)

            <br>
            <a href="#attach_2857"
               title="Go to the comment associated with the attachment">2006-12-13 19:21 UTC</a>,

            <span class="vcard"><span class="fn">Alastair Hole</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2857&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a21" class="bz_contenttype_application_x-php bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=2924"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Version 1.1c of the LdapAuthentication.php plugin (for Mediawiki 1.6+)</span></b></a>

          <span class="bz_attach_extra_info">
              (45.04 KB,
                application/x-php)

            <br>
            <a href="#attach_2924"
               title="Go to the comment associated with the attachment">2006-12-22 21:49 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=2924&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a22" class="bz_contenttype_application_x-php">
        <td valign="top">
            <a href="attachment.cgi?id=3173"
               title="View the content of the attachment">
          <b>Version 1.1d of the LdapAuthentication.php plugin (for Mediawiki 1.6+)</b></a>

          <span class="bz_attach_extra_info">
              (46.25 KB,
                application/x-php)

            <br>
            <a href="#attach_3173"
               title="Go to the comment associated with the attachment">2007-02-02 22:06 UTC</a>,

            <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=3173&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (17)
        </span>
        <a href="attachment.cgi?bugid=814&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1389015166" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-01 16:39:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >DefaultSettings.php (add):

$wgUseLDAP = false;
$wgLDAPDomainNames = array(&quot;&quot;);
$wgLDAPServerNames = array(&quot;&quot;);
$wgLDAPSearchStrings = array(&quot;&quot;);
$wgLDAPUseSSL = true;
$wgLDAPUseLocal = false;

Language.php (add):

'yourdomainname' =&gt; 'Your LDAP Domain'
'blankpasswordnotallowed' =&gt; 'Blank passwords are not allowed.'

includes/User.php (diff -u old new):

--- User.php.new.old	2004-11-01 09:43:28.000000000 -0600
+++ User.php.new	2004-11-01 09:30:39.000000000 -0600
&#64;&#64; -1010,6 +1010,12 &#64;&#64;
 	 */
 	function checkPassword( $password ) {
 		$this-&gt;loadFromDatabase();
+                if ( 0 == strcmp( &quot;&quot;, $password ) ) {
+                        return false;
+                }
+                if ( $this-&gt;checkLDAPPassword( $password ) &amp;&amp; 0 !=
strcmp('local', $_SESSION[&quot;ldapdomain&quot;]-&gt;mDomain ) ) {
+                        return true;
+                }
 		$ep = $this-&gt;encryptPassword( $password );
 		if ( 0 == strcmp( $ep, $this-&gt;mPassword ) ) {
 			return true;
&#64;&#64; -1025,6 +1031,42 &#64;&#64;
 		}
 		return false;
 	}
-}
 
+
+        function checkLDAPPassword( $password ) {
+                global $wgLDAPDomainNames, $wgLDAPServerNames,
$wgLDAPSearchStrings;
+                global $wgLDAPUseLocal, $wgLDAPUseSSL;
+
+                if ( $wgLDAPUseSSL ) {
+                        $serverpre = &quot;ldaps://&quot;;
+                } else {
+                        $serverpre = &quot;ldap://&quot;;
+                }
+
+                $domain = $_SESSION[&quot;ldapdomain&quot;]-&gt;mDomain;
+                $tmpservers = $wgLDAPServerNames[&quot;$domain&quot;];
+                $tok = strtok($tmpservers, &quot; &quot;);
+                while ($tok) {
+                        $servers = $servers . &quot; &quot; . $serverpre . $tok;
+                        $tok = strtok(&quot; &quot;);
+                }
+                $servers = rtrim($servers);
+
+                $tmpuserdn = $wgLDAPSearchStrings[&quot;$domain&quot;];
+                $userdn = str_replace(&quot;USER-NAME&quot;,$this-&gt;mName,$tmpuserdn);
+                $userpass = $password;
+                $ldapconn = &#64;ldap_connect( $servers );
+                if ( $ldapconn ) {
+                        ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
+                        $bind = &#64;ldap_bind( $ldapconn, $userdn, $userpass );
+                        if (!$bind) {
+                                return false;
+                        }
+                } else {
+                        return false;
+                }
+                return true;
+        }
+
+}
 ?&gt;

includes/SpecialUserlogin.php (diff -u old new):

--- SpecialUserlogin.php.new.old	2004-11-01 09:57:41.000000000 -0600
+++ SpecialUserlogin.php	2004-11-01 10:02:01.000000000 -0600
&#64;&#64; -32,11 +32,12 &#64;&#64;
 class LoginForm {
 	var $mName, $mPassword, $mRetype, $mReturnto, $mCookieCheck, $mPosted;
 	var $mAction, $mCreateaccount, $mCreateaccountMail, $mMailmypassword;
-	var $mLoginattempt, $mRemember, $mEmail;
+	var $mLoginattempt, $mRemember, $mEmail, $mDomain;
 	
 	function LoginForm( &amp;$request ) {
 		global $wgLang, $wgAllowRealName;
 
+		$this-&gt;mDomain = $request-&gt;getVal( 'wpDomain' );
 		$this-&gt;mName = $request-&gt;getText( 'wpName' );
 		$this-&gt;mPassword = $request-&gt;getText( 'wpPassword' );
 		$this-&gt;mRetype = $request-&gt;getText( 'wpRetype' );
&#64;&#64; -149,15 +150,18 &#64;&#64;
 		global $wgUser, $wgOut;
 		global $wgMaxNameChars;
 		global $wgMemc, $wgAccountCreationThrottle, $wgDBname, $wgIP;
+		global $wgUseLDAP, $wgLDAPUseLocal;
 
 		if (!$wgUser-&gt;isAllowedToCreateAccount()) {
 			$this-&gt;userNotPrivilegedMessage();
 			return;
 		}
 
-		if ( 0 != strcmp( $this-&gt;mPassword, $this-&gt;mRetype ) ) {
-			$this-&gt;mainLoginForm( wfMsg( 'badretype' ) );
-			return;
+		if ( !$wgUseLDAP || 0 == strcmp('local', $this-&gt;mDomain ) ) {
+			if ( 0 != strcmp( $this-&gt;mPassword, $this-&gt;mRetype ) ) {
+				$this-&gt;mainLoginForm( wfMsg( 'badretype' ) );
+				return;
+			}
 		}
 		
 		$name = trim( $this-&gt;mName );
&#64;&#64; -194,8 +198,21 &#64;&#64;
 			}
 		}
 
+		if ( $wgUseLDAP &amp;&amp; 0 != strcmp('local', $this-&gt;mDomain ) ) { 
+	                if (!$u-&gt;checkPassword( $this-&gt;mPassword )) {
+        	                $this-&gt;mainLoginForm( wfMsg( 'wrongpassword' ) );
+	                        return;
+        	        }
+		} else {
+			# We shouldn't allow blank passwords, even on 
+			# local accounts
+			if ( 0 == strcmp( &quot;&quot;, $this-mPassword ) ) {
+				return;
+			}
+		}
+
 		$u-&gt;addToDatabase();
-		$u-&gt;setPassword( $this-&gt;mPassword );
+		if ( !$wgUseLDAP ) { $u-&gt;setPassword( $this-&gt;mPassword ); }
 		$u-&gt;setEmail( $this-&gt;mEmail );
 		$u-&gt;setRealName( $this-&gt;mRealName );
 
&#64;&#64; -224,14 +241,16 &#64;&#64;
 		}
 		$id = $u-&gt;idForName();
 		if ( 0 == $id ) {
-			$this-&gt;mainLoginForm( wfMsg( 'nosuchuser', $u-&gt;getName() ) );
+			$this-&gt;mainLoginForm( wfMsg( 'nosuchuser', $u-&gt;getName()) );
 			return;
 		}
 		$u-&gt;setId( $id );
 		$u-&gt;loadFromDatabase();
+
+		$_SESSION[&quot;ldapdomain&quot;] = $this;
 		if (!$u-&gt;checkPassword( $this-&gt;mPassword )) {
-			$this-&gt;mainLoginForm( wfMsg( 'wrongpassword' ) );
-			return;
+			$this-&gt;mainLoginForm( wfMsg( 'wrongpassword' ) );	
+			return;	 
 		}
 
 		# We've verified now, update the real record
&#64;&#64; -351,11 +370,13 &#64;&#64;
 	function mainLoginForm( $err ) {
 		global $wgUser, $wgOut, $wgLang;
 		global $wgDBname, $wgAllowRealName;
+		global $wgUseLDAP, $wgLDAPDomainNames, $wgLDAPUseLocal;
 
 		$le = wfMsg( 'loginerror' );
 		$yn = wfMsg( 'yourname' );
 		$yp = wfMsg( 'yourpassword' );
 		$ypa = wfMsg( 'yourpasswordagain' );
+		$ydn = wfMsg( 'yourdomainname' );
 		$rmp = wfMsg( 'remembermypassword' );
 		$nuo = wfMsg( 'newusersonly' );
 		$li = wfMsg( 'login' );
&#64;&#64; -392,7 +413,7 &#64;&#64;
 			$wgOut-&gt;addHTML( &quot;&lt;h2&gt;$li:&lt;/h2&gt;\n&lt;p&gt;$lp&lt;/p&gt;&quot; );
 		} else {
 			$wgOut-&gt;addHTML( &quot;&lt;h2&gt;$le:&lt;/h2&gt;\n&lt;font size='+1' 
-	color='red'&gt;$err&lt;/font&gt;\n&quot; );
+			color='red'&gt;$err&lt;/font&gt;\n&quot; );
 		}
 		if ( 1 == $wgUser-&gt;getOption( 'rememberpassword' ) ) {
 			$checked = ' checked';
&#64;&#64; -413,6 +434,7 &#64;&#64;
 		$encRetype = htmlspecialchars( $this-&gt;mRetype );
 		$encEmail = htmlspecialchars( $this-&gt;mEmail );
 		$encRealName = htmlspecialchars( $this-&gt;mRealName );
+		$encDomain = htmlspecialchars( $this-&gt;mDomain );
 
 		if ($wgUser-&gt;getID() != 0) {
 			$cambutton = &quot;&lt;input tabindex='6' type='submit' name=\&quot;wpCreateaccountMail\&quot;
value=\&quot;{$cam}\&quot; /&gt;&quot;;
&#64;&#64; -436,21 +458,44 &#64;&#64;
 	&lt;td align='left'&gt;
 	&lt;input tabindex='2' type='password' name=\&quot;wpPassword\&quot;
value=\&quot;{$encPassword}\&quot; size='20' /&gt;
 	&lt;/td&gt;
-	&lt;td align='left'&gt;
-	&lt;input tabindex='4' type='checkbox' name=\&quot;wpRemember\&quot; value=\&quot;1\&quot;
id=\&quot;wpRemember\&quot;$checked /&gt;&lt;label for=\&quot;wpRemember\&quot;&gt;$rmp&lt;/label&gt;
-	&lt;/td&gt;
-	&lt;/tr&gt;&quot;);
+	&quot;);
+
+		if ($wgUseLDAP) {	 
+			foreach ($wgLDAPDomainNames as $dom) {	 
+				$doms = $doms . &quot;&lt;option&gt;$dom&lt;/option&gt;&quot;;
+			}
+			if ($wgLDAPUseLocal) {	 
+				$doms = $doms . &quot;&lt;option&gt;local&lt;/option&gt;&quot;;	 
+			}	 
+		$wgOut-&gt;addHTML(&quot;&lt;tr&gt;&lt;td align='right'&gt;$ydn:&lt;/td&gt;	 
+		&lt;td align='left'&gt;	 
+		&lt;select tabindex='9' name=\&quot;wpDomain\&quot; value=\&quot;{$encDomain}\&quot;&gt;	
+		$doms	 
+		&lt;/select&gt;	 
+		&lt;/td&gt;&lt;/tr&gt;&quot;);	 
+		} else {
+		$wgOut-&gt;addHTML(&quot;
+        &lt;td align='left'&gt;
+        &lt;input tabindex='4' type='checkbox' name=\&quot;wpRemember\&quot; value=\&quot;1\&quot;
id=\&quot;wpRemember\&quot;$checked /&gt;&lt;label for=\&quot;wpRemember\&quot;&gt;$rmp&lt;/label&gt;
+        &lt;/td&gt;&lt;/tr&gt;&quot;);
+		}
+
 
 		if ($wgUser-&gt;isAllowedToCreateAccount()) {
 			$encRetype = htmlspecialchars( $this-&gt;mRetype );
 			$encEmail = htmlspecialchars( $this-&gt;mEmail );
 	$wgOut-&gt;addHTML(&quot;&lt;tr&gt;&lt;td colspan='3'&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;
-	&lt;td align='right'&gt;$ypa:&lt;/td&gt;
-	&lt;td align='left'&gt;
-	&lt;input tabindex='5' type='password' name=\&quot;wpRetype\&quot; value=\&quot;{$encRetype}\&quot; 
-	size='20' /&gt;
-	&lt;/td&gt;&lt;td&gt;$nuo&lt;/td&gt;&lt;/tr&gt;
-	&lt;tr&gt;
+	&lt;td align='right'&gt;$nuo&lt;/td&gt;&lt;/tr&gt;&quot;);
+
+	if (!$wgUseLDAP || $wgLDAPUseLocal) { 	
+		$wgOut-&gt;addHTML(&quot;&lt;td align='right'&gt;$ypa:&lt;/td&gt;
+		&lt;td align='left'&gt;
+		&lt;input tabindex='5' type='password' name=\&quot;wpRetype\&quot; value=\&quot;{$encRetype}\&quot; 
+		size='20' /&gt;
+		&lt;/td&gt;&lt;/tr&gt;&quot;);
+	}
+
+	$wgOut-&gt;addHTML(&quot;&lt;tr&gt;
 	&lt;td align='right'&gt;$ye:&lt;/td&gt;
 	&lt;td align='left'&gt;
 	&lt;input tabindex='7' type='text' name=\&quot;wpEmail\&quot; value=\&quot;{$encEmail}\&quot;
size='20' /&gt;
&#64;&#64; -470,16 +515,22 &#64;&#64;
 	$cambutton
 	&lt;/td&gt;&lt;/tr&gt;&quot;);
 		}
-	    
+
+	$wgOut-&gt;addHTML(&quot;
+        &lt;tr&gt;&lt;td colspan='3'&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;
+        &lt;td colspan='3' align='left'&gt;
+        &lt;p&gt;$efl&lt;br /&gt;&quot;);
+
+	if ( !wgUseLDAP) {
 		$wgOut-&gt;addHTML(&quot;
-	&lt;tr&gt;&lt;td colspan='3'&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;
-	&lt;td colspan='3' align='left'&gt;
-	&lt;p&gt;$efl&lt;br /&gt;
-	&lt;input tabindex='10' type='submit' name=\&quot;wpMailmypassword\&quot; value=\&quot;{$mmp}\&quot;
/&gt;&lt;/p&gt;
-	&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
-	&lt;/form&gt;\n&quot; );
-		$wgOut-&gt;addHTML( $endText );
+	&lt;input tabindex='10' type='submit' name=\&quot;wpMailmypassword\&quot; value=\&quot;{$mmp}\&quot;
/&gt;&lt;/p&gt;&quot;);
 	}
+	
+		$wgOut-&gt;addHTML(&quot;
+	&lt;/td&gt;&lt;/tr&gt;
+	&lt;/table&gt;&lt;/form&gt;\n $endText&quot; );
+	}
+	
 
 	/**
 	 * &#64;access private
&#64;&#64; -531,3 +582,4 &#64;&#64;
 	}
 }
 ?&gt;
+</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Antoine &quot;hashar&quot; Musso (WMF)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-01 19:46:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I am going to review and test a bit this patch in the next day.
LDAP authentication is something I am really interested in :o)

Thanks Ryan !</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-01 21:09:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Something to note when you test is that passwords are not encrypted when they
are sent to the LDAP server. My write up on how to use it would try to enforce
the idea of keeping SSL on (which it is by default).</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-01 22:14:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hmm, it seems I forgot to mention how to use my patch. My apologies. Here is a
quick rundown:

I've added 6 options to DefaultSettings.php and LocalSettings.php which are the
following when used by an admin:

$wgUseLDAP = true;
$wgLDAPDomainNames = array(&quot;testADdomain&quot;,&quot;testLDAPdomain&quot;);
$wgLDAPServerNames =
array(&quot;testADdomain&quot;=&gt;&quot;testADserver.example.com&quot;,&quot;testLDAPdomain&quot;=&gt;&quot;testLDAPserver.example.com
testLDAPserver2.example.com&quot;);
$wgLDAPSearchStrings = array(&quot;testADdomain&quot;=&gt;&quot;TDOMAIN\\USER-NAME&quot;,
&quot;testLDAPdomain&quot;=&gt;&quot;cn=USER-NAME,ou=people,dc=example,dc=com&quot;);
$wgLDAPUseSSL = true;
$wgLDAPUseLocal = true;

In this example, there are three different domains, one is local, one is an
Active Directory domain, and the other is a normal LDAP domain (Sun directory
server, openLDAP, etc). The user must provide the search string for a user's
distinguished name (USER-NAME is substituted in SpecialUserLogin.php with the
actual user's loginname). Using SSL is optional (although it is the default) and
so is using the local domain (which is the wiki itself, and is not on by
default). Of course, using LDAP is off by default.

When using LDAP, passwords are not stored in the database (unless users create
accounts on the local domain). Blank passwords are no longer allowed since we
wouldn't want people using the local domain logging in as domain users.

The interface for logging in is slightly different when using LDAP as well.
Since the LDAP directory will be managing user accounts and passwords, I have
removed the &quot;mail me a new password&quot; button, and the validate password field
(unless $wgLDAPUseLocal is true). I have added a selection box that will allow
users to choose which domain they wish to authenticate against (in the above
example, the options would be &quot;testADdomain&quot;, &quot;testLDAPdomain&quot;, and &quot;local&quot;).

A few problems i have are not how I have it currently implemented, but with
features that could be added later. For instance, large sites (wikipedia, and
the like) i'm sure do not want to handle user accounts manually; small sites,
and organizations that use it internally probably do. A feature that could be
added to the basic LDAP authentication is the ability for the wiki to add user
accounts and manage passwords like it does currently (locally). The problem with
this is that most LDAP directories cannot work in this fashion. For instance, if
the wiki was to mail a new password to a user, it would need to change the
password on the LDAP directory which would cause the user's old password to no
longer work. Obviously this is a huge DoS situation. Adding user accounts is
less of a problem, but because of time considerations, I cannot implement it.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">SB</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-15 18:58:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >A couple bug fixes to the patch...

in includes/SpecialUserlogin.php there is one typo (a missing dollar sign) and a
minor bug...

In function mainLoginForm $dom is uninitialized (spits out a Undef. Var. NOTICE
to the log) it should be similar to:

if ($wgUseLDAP) {
    $doms=&quot;&quot;;  // added this
    foreach ($wgLDAPDomainNames as $dom) {
        $doms = $doms . &quot;&lt;option&gt;$dom&lt;/option&gt;&quot;;
    }
    if ($wgLDAPUseLocal) {
      $doms = $doms . &quot;&lt;option&gt;local&lt;/option&gt;&quot;;
    }
    ...

Also in function mainLoginForm the last few lines should read:

if ( !$wgUseLDAP) {    // fixed missing dollar sign
	$wgOut-&gt;addHTML(&quot;&lt;input tabindex='10' type='submit' name=\&quot;wpMailmypassword\&quot;
value=\&quot;{$mmp}\&quot;&gt; /&gt;&lt;/p&gt;&quot;);
}


SB
</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-16 03:43:01 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Since the ability to use some external authentication system 
is a fairly general need, I'm adding a plugin hook for external 
authentication systems; it should be pretty straightforward to 
rearrange the LDAP code as an extension this way.
</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-17 17:10:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Bugfix:

Can add local users with $wgLDAPUseLocal, but cannot login afterwards because
the password isnt being stored in the wiki. Here is the fix.

In SpecialUserLogin.php, in addNewAccountInternal():

-		if ( !$wgUseLDAP ) { $u-&gt;setPassword( $this-&gt;mPassword ); }
+               if ( !$wgUseLDAP || 0 == strcmp('local', $this-&gt;mDomain) ) {
$u-&gt;setPassword( $this-&gt;mPassword ); }</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-12-01 21:36:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Bugfix:

Adding accounts is not working when LDAP is enabled (unless you add local
accounts). Here is the fix:

In SpecialUserLogin.php, in addNewAccountInternal():

+               $_SESSION[&quot;ldapdomain&quot;] = $this;
                if ( $wgUseLDAP &amp;&amp; 0 != strcmp('local', $this-&gt;mDomain ) ) {
                        if (!$u-&gt;checkPassword( $this-&gt;mPassword )) {
                                $this-&gt;mainLoginForm( wfMsg( 'wrongpassword' ) );
                                return;
                        }
                } else {
                        # We shouldn't allow blank passwords, even on
                        # local accounts
                        if ( 0 == strcmp( &quot;&quot;, $this-&gt;mPassword ) ) {
                                return;
                        }
                }</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">T. Gries</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-12-16 12:51:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I added the link to the metawiki page about LDAP authentication. Changed to 1.5 (as I think, that I won't come with 1.4, am I 
correct ?)

Tom
</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-01-13 23:08:00 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have recoded this as an extension. However, it does require a minimal amount
of core code changes. Specifically, I had to remove the ability for people to
use create accounts with blank passwords or to logon with blank passwords. I
also added a small interface change (which is done in a template), which needed
a small modification of includes/SpecialUserLogin.php.

Further core code modification will be required. Specifically, the way changing
passwords works, and mailing temporary passwords. For the current extension,
these features should be disabled when $wgAuth-&gt;strict() is true, since they
would be useless.

I have talked to Thomas Gries about merging the code with enotif. So a code diff
may come from him.

Ryan</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">T. Gries</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-01-13 23:48:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c9">comment #9</a>)
<span class="quote">&gt; I have recoded this as an extension. However, it does require a minimal amount</span >
[...]
<span class="quote">&gt; I have talked to Thomas Gries about merging the code with enotif. So a code diff
&gt; may come from him.
&gt; Ryan</span >

Ryan, just to confirm: I have read. Something coming in a while. (Please, can
you have also an eye on the accompanying meta wikipages
<a href="http://meta.wikipedia.org/LDAP_Authentication">http://meta.wikipedia.org/LDAP_Authentication</a> , which could be useful for our
team work, too ? It's just a reminder and can perhaps help to collaborate.)

Tom</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-02-03 15:03:14 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=254" name="attach_254" title="Diff of changes to 1.5">attachment 254</a> <a href="attachment.cgi?id=254&amp;action=edit" title="Diff of changes to 1.5">[details]</a></span>
Diff of changes to 1.5

Diff of my changes to 1.5, and LdapAuthentication.php</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-02-11 05:51:14 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=282" name="attach_282" title="Patch for mediawiki 1.5">attachment 282</a> <a href="attachment.cgi?id=282&amp;action=edit" title="Patch for mediawiki 1.5">[details]</a></span>
Patch for mediawiki 1.5

This is the current patch for mediawiki 1.5 to add LDAP Authentication. With
this patch the wiki is able to pull a user email address, real name, nickname,
and language preference from the LDAP directory. If the attributes in the LDAP
server are blank, the wiki will use the preferences from the local database.

This patch will NOT work with 1.4.</pre>
    </div><div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-02-11 05:57:51 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=283" name="attach_283" title="Patch for mediawiki 1.4">attachment 283</a> <a href="attachment.cgi?id=283&amp;action=edit" title="Patch for mediawiki 1.4">[details]</a></span>
Patch for mediawiki 1.4

This is the current patch for mediawiki 1.4 to add LDAP Authentication. With
this patch the wiki is able to pull a user email address, real name, nickname,
and language preference from the LDAP directory. If the attributes in the LDAP
server are blank, the wiki will use the preferences from the local database.

This patch will NOT work with 1.5.</pre>
    </div><div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-02-11 19:21:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Bugfix on last two patches (don't know HOW this got in here). In
LdapAuthentication.php

This:
        function initUser( &amp;$user ) {
                # Override this to do something.
                //We are creating an LDAP user, it is very important that we do
                //NOT set a local password because it could compromise the
                //security of our domain.
                $user-&gt;setPassword( '' );
                if ('' != $this-&gt;lang) {
                        $u-&gt;setOption('language',$this-&gt;lang);
                }
                if ('' != $this-&gt;nickname) {
                        $u-&gt;setOption('nickname',$this-&gt;nickname);
                }
                if ('' != $this-&gt;realname) {
                        $u-&gt;setRealName($this-&gt;realname);
                }
                if ('' != $this-&gt;email) {
                        $u-&gt;setEmail($this-&gt;email);
                }
        }

Should be:

        function initUser( &amp;$user ) {
                # Override this to do something.
                //We are creating an LDAP user, it is very important that we do
                //NOT set a local password because it could compromise the
                //security of our domain.
                $user-&gt;setPassword( '' );
                if ('' != $this-&gt;lang) {
                        $user-&gt;setOption('language',$this-&gt;lang);
                }
                if ('' != $this-&gt;nickname) {
                        $user-&gt;setOption('nickname',$this-&gt;nickname);
                }
                if ('' != $this-&gt;realname) {
                        $user-&gt;setRealName($this-&gt;realname);
                }
                if ('' != $this-&gt;email) {
                        $user-&gt;setEmail($this-&gt;email);
                }
        }
</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-02-14 02:43:25 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=287" name="attach_287" title="Updated patch to add LDAP authentication to mediawiki">attachment 287</a> <a href="attachment.cgi?id=287&amp;action=edit" title="Updated patch to add LDAP authentication to mediawiki">[details]</a></span>
Updated patch to add LDAP authentication to mediawiki

I'm on a roll this weekend! This patch adds the ability for the wiki to use an
LDAP server to create users, update user information, change passwords, and
pull information from an LDAP server.

Unfortunately, updating users, and adding users does not currently work with
Active Directory, and its likely the users are not able to mail themselves a
password yet (with $wgAuth-&gt;strict() returning true).

This patch is only for 1.5. A backport for 1.4 should be uploaded soon
hopefully.</pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 13:42:24 UTC
        </span>
      </div>



<pre class="bz_comment_text" >So ... if you can't add users with AD, how would you add users?  What is
different about AD's ldap interface that is causing problems?  I'm tasked with
getting auth against AD working and would be glad to help/hack however you need.</pre>
    </div><div id="c17" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 13:45:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Let me state my confusion more precisely.  By &quot;adding users&quot;, I mean new wiki
logins, not adding new users to AD through mediawiki.  That being said, I
haven't seen in my limited LDAP/AD/PHP experiments why adding users via AD is
different than LDAP.  Bugzilla does it just fine.</pre>
    </div><div id="c18" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 14:32:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >... what type of files are those last two patches?  firefox seems to think they
are binary.</pre>
    </div><div id="c19" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 18:06:56 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Sorry to monopolize this bug all of a sudden.  I've got an upgraded demo of my
wiki site ready to test.  It looks like the non-obsoleted patches in this bug
are busted.

Can you re-post the diffs as text/plain?</pre>
    </div><div id="c20" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 18:13:42 UTC
        </span>
      </div>



<pre class="bz_comment_text" >D'oh I see it's a .tar.gz now.  If that is the case it shouldn't be labelled
&quot;patch&quot; IMHO.  I think just a single diff file would be preferrable for all
involved anyway.

My $0.02.</pre>
    </div><div id="c21" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">T. Gries</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 18:24:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >See also <a href="http://bugzilla.wikimedia.org/show_bug.cgi?id=1360">http://bugzilla.wikimedia.org/show_bug.cgi?id=1360</a> for Auto-Login /
Auto-account-creation  ( incl. working patch for 1.4 )</pre>
    </div><div id="c22" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 19:27:28 UTC
        </span>
      </div>



<pre class="bz_comment_text" >In my case auto-login isn't necessarily desirable.  Full-bore LDAP support is
needed.

IMHO, you really shouldn't need a separate case for AD, since AD has a pretty
standard LDAP interface.  One catch in my instance is that I need to
authenticate an &quot;app user&quot; first to then try and authenticate logins.  Like I
would have a &quot;Wiki User&quot; or &quot;Bugzilla User&quot;.</pre>
    </div><div id="c23" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 20:05:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >OK.  Your patch uses the actual bind as the authentication mechanism.  What
bugzilla does (and works in my AD case), is have a separate bind, and then do an
LDAP search to verify the login.  My in case, we only have a special set of
users that can bind.

I'll probably hack things around to get around this for now.

Please let me know what you think of this idea.</pre>
    </div><div id="c24" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-07 20:13:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >GOD.  Don't pay any attention to me.  Please just ignore what I spout off
without testing.</pre>
    </div><div id="c25" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-09 22:55:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=413" name="attach_413" title="Version .8 of the LDAP patch (For Mediawiki 1.4)">attachment 413</a> <a href="attachment.cgi?id=413&amp;action=edit" title="Version .8 of the LDAP patch (For Mediawiki 1.4)">[details]</a></span>
Version .8 of the LDAP patch (For Mediawiki 1.4)

Lol. I used to get emails when comments were being added to this page, but it
seems i'm not getting them any more. I'll check here more often.

All of my patches allow you to add new wiki users to the wiki db. What my new
patches are starting to allow is for the wiki to use LDAP as a full blown
backend. Instead of adding a user through your LDAP server to allow them access
to the wiki, a user could create an account on the wiki, and a user would be
added to the LDAP server. I am also allowing updates to user attributes through
the wiki, because the next major versions of my plugin will allow full blown
LDAP backend support, so that all user preferences and such are stored in LDAP.


I've added options to allow/disallow this new behavior, since most people will
not want this.

There isn't a huge difference in adding users in AD. There is a slight problem
with adding passwords to AD though. I will work around this soon hopefully.
Also, there is a requirement in AD that you use SSL to add users/change
passwords, etc. Also, in general, when adding new users through LDAP in AD, the
user is created as disabled, without a password. I also don't have easy access
to an AD when doing testing, or writing the patches, so AD support will be
somewhat shaky (although, the original functionality should work with AD, even
in the newest versions).

When merging this plugin into your code, please do it by hand, people seem to
be having problems merging with diff.</pre>
    </div><div id="c26" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-09 23:02:44 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c23">comment #23</a>)
<span class="quote">&gt; OK.  Your patch uses the actual bind as the authentication mechanism.  What
&gt; bugzilla does (and works in my AD case), is have a separate bind, and then do an
&gt; LDAP search to verify the login.  My in case, we only have a special set of
&gt; users that can bind.
&gt; 
&gt; I'll probably hack things around to get around this for now.
&gt; 
&gt; Please let me know what you think of this idea.</span >


In this case, you would have to have a proxyagent type user in your LDAP server,
correct? I may add this as a user defined option, because not every unix/linux
domain uses a proxyagent, and most AD domains do not. I do understand the need
for it in some cases though, if your users are in multiple ou's, then a direct
bind will not work.
</pre>
    </div><div id="c27" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-04-10 23:43:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c26">comment #26</a>)
<span class="quote">&gt; In this case, you would have to have a proxyagent type user in your LDAP server,
&gt; correct? I may add this as a user defined option, because not every unix/linux
&gt; domain uses a proxyagent, and most AD domains do not. I do understand the need
&gt; for it in some cases though, if your users are in multiple ou's, then a direct
&gt; bind will not work.</span >

Yes our users are in multiple ou's.  For now I just added the single bind user
and have it do a search to determine the individual user auth.

Anyway, cheers on the work so far!</pre>
    </div><div id="c28" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Caius</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-05 09:39:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I'm trying to autheticate against AD. Finally it worked with these changes:

LocalSettings.php:

$wgLDAPSearchStrings = array(
  &quot;testADdomain&quot;=&gt;&quot;USER-NAME&quot;      ### instead of TDOMAIN\\USER-NAME
  );

When I login I get these warnings:
Warning: ldap_read(): Search: Invalid DN syntax in /..../LdapAuthentication.php on line 150
Warning: ldap_get_entries(): supplied argument is not a valid ldap result resource 
in /..../LdapAuthentication.php on line 150

But it works.</pre>
    </div><div id="c29" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-05 09:44:37 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I'd like to get any necessary changes to the core code or AuthPlugin interface ready in the 1.5 
release so end users can easily drop in the LDAP extension.

Ryan, is there a current patch for this ready to go?</pre>
    </div><div id="c30" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-08 21:14:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c29">comment #29</a>)
<span class="quote">&gt; I'd like to get any necessary changes to the core code or AuthPlugin interface</span >
ready in the 1.5 
<span class="quote">&gt; release so end users can easily drop in the LDAP extension.
&gt; 
&gt; Ryan, is there a current patch for this ready to go?</span >

Brion,

Give me a couple of days to get my new release out. It fixes the &quot;Mail me a new
password&quot; problem that I was having. Otherwise, the 1.5 patch is mature enough
for addition.</pre>
    </div><div id="c31" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c31">Comment 31</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-08 21:31:07 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c28">comment #28</a>)
<span class="quote">&gt; I'm trying to autheticate against AD. Finally it worked with these changes:
&gt; 
&gt; LocalSettings.php:
&gt; 
&gt; $wgLDAPSearchStrings = array(
&gt;   &quot;testADdomain&quot;=&gt;&quot;USER-NAME&quot;      ### instead of TDOMAIN\\USER-NAME
&gt;   );
&gt; 
&gt; When I login I get these warnings:
&gt; Warning: ldap_read(): Search: Invalid DN syntax in</span >
/..../LdapAuthentication.php on line 150
<span class="quote">&gt; Warning: ldap_get_entries(): supplied argument is not a valid ldap result</span >
resource 
<span class="quote">&gt; in /..../LdapAuthentication.php on line 150
&gt; 
&gt; But it works.</span >


Well, TDOMAIN should be renamed to your actual domain. But if using just the
username works, thats great too.

Those two warnings you are getting is because of the DN syntax in your
$wgLDAPSearchStrings. I really should update my documentation some. I'll clarify
some though.

My newest version of the patch allows the wiki to pull nickname, language, email
address, real name, etc. from LDAP. To do so, the LDAP plugin reads an LDAP
entry from the LDAP server. The problem with this is that it needs a complete DN. 

Your search string is not giving a full DN for your user, so the read is
failing. This won't cause problems for you, because those preferences won't be
overwritten unless they contain information (and if the read is failing, they do
not).

If you want this functionality, you'll have to give a full DN in the search
strings. If all of your users are in the same OU (i believe this is generally
the case in AD because it copies all users into ou=Users or something similar),
then you can set your search string to be
&quot;sAMAccountName=USER-NAME,ou=Users,dc=domain,dc=com&quot;. If you have access to your
domain controller, you can check this. You can probably also check it with an
LDAP browser (there are a bunch freely available) even if you don't have access
to the domain controller.

I'm going to add an option for disabling reads in the next version so that
you'll stop getting warnings.</pre>
    </div><div id="c32" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c32">Comment 32</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 22:37:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=551" name="attach_551" title="Version 1.0 of the LDAP patch (For Mediawiki 1.5)">attachment 551</a> <a href="attachment.cgi?id=551&amp;action=edit" title="Version 1.0 of the LDAP patch (For Mediawiki 1.5)">[details]</a></span>
Version 1.0 of the LDAP patch (For Mediawiki 1.5)

Sorry for the delay on the latest patch.

This is version 1.0 of the LDAP authentication patch. This release should fix
the &quot;mail me a password&quot; problem. This release also adds the ability to search
for users through proxy credentials (this is useful if all of your users are
not in the same ou). Also added is a option to disable fetching of user
preferences.

If you are currently using the LDAP patch to add users and set preferences, the
option &quot;$wgLDAPWikiDN&quot; and &quot;$wgLDAPWikiPassword&quot; have been changed to
&quot;$wgLDAPWriterDN&quot; and &quot;$wgLDAPWriterPassword&quot;.

This patch has been pretty well tested using openLDAP, and should work equally
as well with Sun Directory Server. I have not had a chance to test this version
of the patch with Active Directory. If you notice any problems with the new
features on Active Directory, let me know (the normal authentication should
work perfectly fine).

Currently not working in this version, that will be fixed in the next is: If
using proxy credentials, you can only use one domain, and the local domain. If
using proxy credentials, you cannot add users to your LDAP server through the
wiki (you can still add local users).

I will hopefully post a 1.4 version of this patch in the next week. I will also
update my documentation at: <a href="http://meta.wikimedia.org/wiki/LDAP_Authentication">http://meta.wikimedia.org/wiki/LDAP_Authentication</a></pre>
    </div><div id="c33" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c33">Comment 33</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Edward Rudd</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-16 15:52:21 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have one quick question about this patch.. Which is, with this patch will I be
able to require authentication off of the LDAP (via a possible filter so only
certain accounts can access it). And if you are not authenticated you can not
see any content in the Wiki??? Or is the only way of accomplishing that via HTTP
Auth?</pre>
    </div><div id="c34" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c34">Comment 34</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-16 16:55:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c33">comment #33</a>)
<span class="quote">&gt; I have one quick question about this patch.. Which is, with this patch will I be
&gt; able to require authentication off of the LDAP (via a possible filter so only
&gt; certain accounts can access it). And if you are not authenticated you can not
&gt; see any content in the Wiki??? Or is the only way of accomplishing that via HTTP
&gt; Auth?</span >

Using just LDAP authentication (minimal options), the wiki will only
authenticate users in LDAP, not users in the mysql database. You should be able
to use the normal options for stopping users from viewing and editing pages
unless they are logged in. Filtering users is left upon you. 

One way to filter would be to have a seperate OU for wiki users. Another way
would be to use a proxyagent (available this version, see the caveats), and make
an aci that only allows the proxyagent to access specific users, or users in a
specific group. A proxyagent searches the directory for a user matching the
username, and then binds as the user. This is probably a good way to go.

You shouldn't need HTTP auth at all using this patch.</pre>
    </div><div id="c35" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Edward Rudd</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-16 18:36:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c34">comment #34</a>)
<span class="quote">&gt; 
&gt; One way to filter would be to have a seperate OU for wiki users. Another way
&gt; would be to use a proxyagent (available this version, see the caveats), and make
&gt; an aci that only allows the proxyagent to access specific users, or users in a
&gt; specific group. A proxyagent searches the directory for a user matching the
&gt; username, and then binds as the user. This is probably a good way to go.
&gt; </span >

So there is no way to currently specify an LDAP filter? ie. (wikiAcces=TRUE) for
the proxy &quot;Search&quot; credentials? 
</pre>
    </div><div id="c36" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c36">Comment 36</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-16 19:56:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c35">comment #35</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=814#c34">comment #34</a>)
&gt; &gt; 
&gt; &gt; One way to filter would be to have a seperate OU for wiki users. Another way
&gt; &gt; would be to use a proxyagent (available this version, see the caveats), and make
&gt; &gt; an aci that only allows the proxyagent to access specific users, or users in a
&gt; &gt; specific group. A proxyagent searches the directory for a user matching the
&gt; &gt; username, and then binds as the user. This is probably a good way to go.
&gt; &gt; 
&gt; 
&gt; So there is no way to currently specify an LDAP filter? ie. (wikiAcces=TRUE) for
&gt; the proxy &quot;Search&quot; credentials? 
&gt; </span >

No, not in this version. I will add this next version. If you want to add this
yourself, the following code change should work:

In LdapAuthentication.php (in function getUserDN() ), change:

$filter = &quot;(&quot; . $wgLDAPSearchAttributes[$_SESSION['wsDomain']] . &quot;=$username)&quot;;

to:

$filter =
str_replace(&quot;USER-NAME&quot;,$username,$wgLDAPSearchAttributes[$_SESSION['wsDomain']]);

In LocalSettings.php, put (these are proxyagent settings, you'll still need
$wgLDAPServerNames and $wgLDAPDomainNames):

$wgLDAPProxyAgent = &quot;cn=proxyagent,ou=profile,dc=base,dc=dn&quot;;
$wgLDAPProxyAgentPassword = &quot;password&quot;; //this should work with hashes btw
$wgLDAPBaseDNs = array(&quot;yourdomainname&quot;=&gt;&quot;dc=base,dc=dn&quot;);
$wgLDAPSearchAttributes =
array(&quot;yourdomainname&quot;=&gt;&quot;(uid=USER-NAME)(wikiAccess=TRUE)&quot;);

If you want to be able to update LDAP from the wiki, you'll need:

$wgLDAPWriterDN = &quot;cn=writer,dc=base,dc=dn&quot;;
$wgLDAPWriterPassword = &quot;password&quot;; //this should work with hashes
$wgLDAPUpdateLDAP = true; //to set password, change preferences, etc</pre>
    </div><div id="c37" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c37">Comment 37</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-06-03 12:02:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I've checked the changes to the core code into CVS HEAD, will be included in 1.5 so the plugin file can be dropped in 
easy.
</pre>
    </div><div id="c38" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c38">Comment 38</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nicholas J Kreucher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-06-22 23:02:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >wondering if the 1.0 patch has been back ported to 1.4 yet... I am having a bit
of trouble getting any of the latest patches working with 1.4.5 and wanted to
check before I started digging in. thanks!</pre>
    </div><div id="c39" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c39">Comment 39</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-06-23 13:19:11 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c38">comment #38</a>)
<span class="quote">&gt; wondering if the 1.0 patch has been back ported to 1.4 yet... I am having a bit
&gt; of trouble getting any of the latest patches working with 1.4.5 and wanted to
&gt; check before I started digging in. thanks!</span >

No, sorry. I am probably dropping support for 1.4 in patches 1.0+. I've been
extremely busy lately and its been hard to get time to work on this. 

The latest 1.4 patch should work for you though. It probably has the
functionality you need (basic ssl encrypted LDAP authentication). If you need to
use proxy credentials, that is only available in 1.0+, so you may be out of luck
until mediawiki 1.5 comes out.

I still haven't updated my documentation for patch 1.0, i'll try to get to that
tonight (a couple variable names changed).</pre>
    </div><div id="c40" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c40">Comment 40</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Antoine &quot;hashar&quot; Musso (WMF)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-07-13 17:08:45 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ryan lane is working on this, not me :o)</pre>
    </div><div id="c41" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c41">Comment 41</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">D. Datzert</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-14 17:07:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=787" name="attach_787" title="Patch DefaultSettings and Setup ($wgAuth)">attachment 787</a> <a href="attachment.cgi?id=787&amp;action=edit" title="Patch DefaultSettings and Setup ($wgAuth)">[details]</a></span>
Patch DefaultSettings and Setup ($wgAuth)

I want to suggest appling this patch to mediawiki above 1.5beta4.
It will do the modifications described in the ticket for DefaultSettings.php
and will setup the $wgAuth object in the Setup.php to the correct
LdapAuthenticationPlugin()

Regards,
Dirk</pre>
    </div><div id="c42" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c42">Comment 42</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-15 13:18:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >It would be better if this:

$wgLDAPUseSSL = false;

was instead this:

$wgLDAPUseSSL = true;

In DefaultSettings.php, because it is very dangerous to not use SSL. Passwords
are *NOT* sent across the line encrypted. To protect people, it would be better
for the plugin to not work for them (because their server isn't set up
correctly), than it would be for them to unknowingly send passwords across the
line in the clear.

Also, I don't know if the Setup.php additions are OK. I believe the reason
AuthenticationPlugin.php was added was so that there could be multiple
authentication plugins used just like extensions are now used. So it is probably
better if the plugin is treated the same way as an extension (the way it is
being used now).</pre>
    </div><div id="c43" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c43">Comment 43</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Christian Meutes</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-17 08:03:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have added &quot;$wgLDAPScope;&quot; to the configuration file to search for the
USER-NAME in the sub-scope OR in one-scope mode.

example:
# Scope is sub or one   
$wgLDAPScope = &quot;sub&quot;;

following the patch for the patch version 1.4:

--- LdapAuthentication.php      Tue Aug 16 17:03:05 2005
+++ LdapAuthentication.php.old  Tue Aug 16 15:13:54 2005
&#64;&#64; -50,13 +50,16 &#64;&#64;
        function userExists( $username ) {
                 global $wgLDAPSearchStrings, $wgLDAPAddLDAPUsers;
                global $wgLDAPWikiDN, $wgLDAPWikiPassword;
-               global $wgLDAPScope;
+
                //If we can't add LDAP users, we don't really need to check
                //if the user exists, the authenticate method will do this for
                //us. This will decrease hits to the LDAP server.
                if (!$wgLDAPAddLDAPUsers) {
                        return true;
                }
+
+                $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];
+                $userdn = str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
                $ldapconn = $this-&gt;connect();
                if ($ldapconn) {
                         ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
&#64;&#64; -67,25 +70,7 &#64;&#64;
                                //user, and we don't want that.
                                        return true;
                         }
-                       if($wgLDAPScope==&quot;sub&quot;) 
-                               {
-                               $userdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
-                               preg_match(&quot;/(.*?)=USER-NAME/&quot;,$userdn,$attrmatch);
-                               $searchattr=$attrmatch[1];
-                               $basedn=preg_replace(&quot;/.*?USER-NAME,/&quot;,&quot;&quot;,$userdn);
-                               $search=ldap_search($ldapconn, $basedn,
&quot;($searchattr=$username)&quot;,$searchattr);
-                               $info  =ldap_get_entries($ldapconn, $search);
-                               if($info[&quot;count&quot;]==1) 
-                                       {
-                                       $entry=ldap_first_entry($ldapconn,$search);
-                                       }
-                               } 
-                               else
-                               {
-                               $tmpuserdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
-                                       $userdn =
str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
-                               $entry = &#64;ldap_read($ldapconn, $userdn,
&quot;objectclass=*&quot;);
-                       }
+                        $entry = &#64;ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
                        if (isset($wgLDAPProxyDN)) {
                                //lets clean up
                                &#64;ldap_unbind();
&#64;&#64; -145,46 +130,28 &#64;&#64;
         */
        function authenticate( $username, $password ) {
                 global $wgLDAPSearchStrings;
-               global $wgLDAPScope;
 
                if ( '' == $password ) {
                        return false;
                }
-               $ldapconn = $this-&gt;connect( );
-               if ( $ldapconn ) {
-                       if($wgLDAPScope==&quot;sub&quot;)
-                       {
-                               $userdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
-                               ldap_set_option( $ldapconn,
LDAP_OPT_PROTOCOL_VERSION, 3);
-                               preg_match(&quot;/(.*?)=USER-NAME/&quot;,$userdn,$attrmatch);
-                               $searchattr=$attrmatch[1];
-                               $basedn=preg_replace(&quot;/.*?USER-NAME,/&quot;,&quot;&quot;,$userdn);
-                               $search=ldap_search($ldapconn, $basedn,
&quot;($searchattr=$username)&quot;);
-                               $entry=ldap_first_entry($ldapconn,$search);
-                               $binddn=ldap_get_dn($ldapconn,$entry);
-                               $bind = &#64;ldap_bind( $ldapconn, $binddn, $password );
-                               if (!$bind) {
-                                       return false;
-                               } 
-                       }
-                       else
-                       {
-                               $tmpuserdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
-                               $userdn =
str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
-                               $bind = &#64;ldap_bind( $ldapconn, $userdn, $password );
-                                if (!$bind) {
-                                        return false;
-                                       }
-                       }
 
-               $entry = ldap_read($ldapconn, $binddn, &quot;objectclass=*&quot;);
-               $info = ldap_get_entries($ldapconn, $entry);
-               $this-&gt;email = $info[0][&quot;mail&quot;][0];
-               $this-&gt;lang = $info[0][&quot;preferredlanguage&quot;][0];
-               $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
-               $this-&gt;realname = $info[0][&quot;cn&quot;][0];
-               // Lets clean up.
-               &#64;ldap_unbind();
+                $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];
+                $userdn = str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
+                $ldapconn = $this-&gt;connect( );
+                if ( $ldapconn ) {
+                        ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
+                        $bind = &#64;ldap_bind( $ldapconn, $userdn, $password );
+                        if (!$bind) {
+                                return false;
+                        }
+                       $entry = ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
+                       $info = ldap_get_entries($ldapconn, $entry);
+                       $this-&gt;email = $info[0][&quot;mail&quot;][0];
+                       $this-&gt;lang = $info[0][&quot;preferredlanguage&quot;][0];
+                       $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
+                       $this-&gt;realname = $info[0][&quot;cn&quot;][0];
+                       // Lets clean up.
+                       &#64;ldap_unbind();
                 } else {
                         return false;
                 }


</pre>
    </div><div id="c44" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c44">Comment 44</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Christian Meutes</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-17 08:14:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >i confused the new and the old file with the diff command, now the right patch:

--- LdapAuthentication.php.old  Tue Aug 16 15:13:54 2005
+++ LdapAuthentication.php      Tue Aug 16 17:03:05 2005
&#64;&#64; -50,16 +50,13 &#64;&#64;
        function userExists( $username ) {
                 global $wgLDAPSearchStrings, $wgLDAPAddLDAPUsers;
                global $wgLDAPWikiDN, $wgLDAPWikiPassword;
-
+               global $wgLDAPScope;
                //If we can't add LDAP users, we don't really need to check
                //if the user exists, the authenticate method will do this for
                //us. This will decrease hits to the LDAP server.
                if (!$wgLDAPAddLDAPUsers) {
                        return true;
                }
-
-                $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];
-                $userdn = str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
                $ldapconn = $this-&gt;connect();
                if ($ldapconn) {
                         ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
&#64;&#64; -70,7 +67,25 &#64;&#64;
                                //user, and we don't want that.
                                        return true;
                         }
-                        $entry = &#64;ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
+                       if($wgLDAPScope==&quot;sub&quot;) 
+                               {
+                               $userdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
+                               preg_match(&quot;/(.*?)=USER-NAME/&quot;,$userdn,$attrmatch);
+                               $searchattr=$attrmatch[1];
+                               $basedn=preg_replace(&quot;/.*?USER-NAME,/&quot;,&quot;&quot;,$userdn);
+                               $search=ldap_search($ldapconn, $basedn,
&quot;($searchattr=$username)&quot;,$searchattr);
+                               $info  =ldap_get_entries($ldapconn, $search);
+                               if($info[&quot;count&quot;]==1) 
+                                       {
+                                       $entry=ldap_first_entry($ldapconn,$search);
+                                       }
+                               } 
+                               else
+                               {
+                               $tmpuserdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
+                                       $userdn =
str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
+                               $entry = &#64;ldap_read($ldapconn, $userdn,
&quot;objectclass=*&quot;);
+                       }
                        if (isset($wgLDAPProxyDN)) {
                                //lets clean up
                                &#64;ldap_unbind();
&#64;&#64; -130,28 +145,46 &#64;&#64;
         */
        function authenticate( $username, $password ) {
                 global $wgLDAPSearchStrings;
+               global $wgLDAPScope;
 
                if ( '' == $password ) {
                        return false;
                }
+               $ldapconn = $this-&gt;connect( );
+               if ( $ldapconn ) {
+                       if($wgLDAPScope==&quot;sub&quot;)
+                       {
+                               $userdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
+                               ldap_set_option( $ldapconn,
LDAP_OPT_PROTOCOL_VERSION, 3);
+                               preg_match(&quot;/(.*?)=USER-NAME/&quot;,$userdn,$attrmatch);
+                               $searchattr=$attrmatch[1];
+                               $basedn=preg_replace(&quot;/.*?USER-NAME,/&quot;,&quot;&quot;,$userdn);
+                               $search=ldap_search($ldapconn, $basedn,
&quot;($searchattr=$username)&quot;);
+                               $entry=ldap_first_entry($ldapconn,$search);
+                               $binddn=ldap_get_dn($ldapconn,$entry);
+                               $bind = &#64;ldap_bind( $ldapconn, $binddn, $password );
+                               if (!$bind) {
+                                       return false;
+                               } 
+                       }
+                       else
+                       {
+                               $tmpuserdn =
$wgLDAPSearchStrings[$_SESSION['wsDomain']];
+                               $userdn =
str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
+                               $bind = &#64;ldap_bind( $ldapconn, $userdn, $password );
+                                if (!$bind) {
+                                        return false;
+                                       }
+                       }
 
-                $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];
-                $userdn = str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
-                $ldapconn = $this-&gt;connect( );
-                if ( $ldapconn ) {
-                        ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
-                        $bind = &#64;ldap_bind( $ldapconn, $userdn, $password );
-                        if (!$bind) {
-                                return false;
-                        }
-                       $entry = ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
-                       $info = ldap_get_entries($ldapconn, $entry);
-                       $this-&gt;email = $info[0][&quot;mail&quot;][0];
-                       $this-&gt;lang = $info[0][&quot;preferredlanguage&quot;][0];
-                       $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
-                       $this-&gt;realname = $info[0][&quot;cn&quot;][0];
-                       // Lets clean up.
-                       &#64;ldap_unbind();
+               $entry = ldap_read($ldapconn, $binddn, &quot;objectclass=*&quot;);
+               $info = ldap_get_entries($ldapconn, $entry);
+               $this-&gt;email = $info[0][&quot;mail&quot;][0];
+               $this-&gt;lang = $info[0][&quot;preferredlanguage&quot;][0];
+               $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
+               $this-&gt;realname = $info[0][&quot;cn&quot;][0];
+               // Lets clean up.
+               &#64;ldap_unbind();
                 } else {
                         return false;
                 }
</pre>
    </div><div id="c45" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c45">Comment 45</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Hiemer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-18 07:22:00 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hi,
I am trying for a whole day to get the ldap authentication running under 1.4.7
and 1.5beta4 but nothing works could anyone provide his/her running version, not
in diff files, but in the already changed php files? Everytime I try to patch
some files something goes wrong, not all patches succeed and so on.

Thanks a lot. 

Johannes</pre>
    </div><div id="c46" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c46">Comment 46</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-08-18 13:45:00 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Please try patching the code by hand, and not using the patch command. A few
people have reported trouble when using the patch command. Also, make sure you
are using the right version of the patch for the right version of the wiki.
version 1.0 of the patch will not work with the 1.4 series of mediawiki. With
1.5, I believe that the code had already been added to the main source, all you
should have to do is drop in the LDAP Authentication Plugin and include it into
the LocalSettings.php. 

I just updated my documentation at:

     <a href="http://meta.wikimedia.org/wiki/LDAP_Authentication">http://meta.wikimedia.org/wiki/LDAP_Authentication</a>

to reflect the newest version of my patch (1.0). Use this for mediawiki 1.5.

Use patch version .8 for mediawiki 1.4.</pre>
    </div><div id="c47" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c47">Comment 47</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Sarith Sircar</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-07 10:51:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I’m new to PHP and therefore still have a long way to go. However, I’ve been asked to 
build a localized version for my company, using LDAP authentication. I’ve been trying 
to get this thing to work but no luck so far. I was wondering if you have a running 
version that you could send me please, or a link to a website that would help me step-
by-step with the necessary patching.

Your kind help is much appreciated.

Warm Regards,
Sarith</pre>
    </div><div id="c48" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c48">Comment 48</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Sarith Sircar</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-09 15:15:44 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I’ve been trying to do the LDAP integration for Wiki but so far I am unable to get it 
working. My Version of Wiki is mediawiki-1.4.5 and the patch I am using is 
changes.8.14. Am I using the correct versions?

My problem is this:

I have manually patched the files and now am able to get my domain listed in the 
special user login page. I have made the necessary changes in the LocalSettings.php, 
DefaultSettings.php, AuthPlugin.php, User.php, Language.php, SpecialUserLogin.php, 
UserLogin.php files. However, when I go to the Special User Login page, type in my 
credentials as listed in the Active Directory of my company, and click on ‘Login’, all 
I see is a blank page on my browser. This is what I see in the URL: 
<a href="http://localhost/Wikipedia/index.php">http://localhost/Wikipedia/index.php</a>?
title=Special:Userlogin&amp;action=submitlogin&amp;returnto=Main_Page

Can you please help me with getting this up and running? Your expert inputs would be 
much appreciated.

Thank you</pre>
    </div><div id="c49" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c49">Comment 49</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Edward Rudd</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-09 21:13:12 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is not a support channel.  Go to IRC or the mailing lists to get support.
DO not change the bug status information like the way you did..  If you've found
a bug, file a new report, don't change the status of an enhancement bug and
&quot;morph&quot; into your issue.

I'm reverting the status on this bug.</pre>
    </div><div id="c50" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c50">Comment 50</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris Thorman</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-18 11:38:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I found what seems to be a bug in the LdapAuthentication.php code that was affecting the &quot;proxy:&quot; mode; I fixed it on my running system and now have 
LDAP working in my MediaWiki!  (Thanks, guys!)

Here is what I had to change:

--- LdapAuthentication.php.old  2005-09-18 05:46:50.000000000 -0400
+++ LdapAuthentication.php      2005-09-18 06:12:49.000000000 -0400
&#64;&#64; -52,6 +52,7 &#64;&#64;
                global $wgLDAPWriterDN, $wgLDAPWriterPassword;
                global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
                global $wgLDAPBaseDN;
+        global $wgLDAPSearchAttributes;
 
                //If we can't add LDAP users, we don't really need to check
                //if the user exists, the authenticate method will do this for
&#64;&#64; -64,8 +65,9 &#64;&#64;
                $ldapconn = $this-&gt;connect();
                if ($ldapconn) {
                         ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
-                       if ($searchtype == &quot;proxy&quot; &amp;&amp; isset($wgLDAPProxyAgent)) {
+                       if ($this-&gt;SearchType == &quot;proxy&quot; &amp;&amp; isset($wgLDAPProxyAgent)) {
                                $userdn = $this-&gt;getUserDN($ldapconn, $username);
+
                                if ($userdn == '') {
                                        return false;
                                }
&#64;&#64; -79,7 +81,8 &#64;&#64;
                         }
                        if ($this-&gt;SearchType == 'proxy') {
                                //we need to do a subbase search for the entry
-                               $filter = &quot;($wgLDAPSearchAttribute=$username)&quot;;
+                $searchattr = $wgLDAPSearchAttributes[$_SESSION['wsDomain']];
+                               $filter = &quot;($searchattr=$username)&quot;;
                                $entry = &#64;ldap_search($ldapconn, $searchstring, $filter);
                        } else {
                                //search for the entry itself</pre>
    </div><div id="c51" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c51">Comment 51</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">JDPorter</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-20 02:37:44 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I had to change every instance of

ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);

to 

ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
ldap_set_option( $ldapconn, LDAP_OPT_REFERRALS, 0);

in order to authenticate against our W2k3 servers.</pre>
    </div><div id="c52" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c52">Comment 52</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Pierre Gambarotto</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-30 12:00:37 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Patch proposition for group membership :
I slightly modified LdapAuthentication.php to provide support for group membership : a user is authenticated if he can bin to the ldap
AND he is member of an ldap group (groupofnames or groupofuniques names).

New setting : 
--- in LocalSettings.php or in DefaultSettings.php
$wgLDAPGroupDN = &quot;cn=test,ou=groups,dc=mycompany,dc=com&quot;
---

The patch is at the end of the comment.
Default : only LDAP groups are supported (i.e. not posixgroups)
If a person provides correct authentication (login/password) but isn't member of the group,
the error message is still &quot;Wrong password&quot; or similar.

The patch :
--- LdapAuthentication.php.orig 2005-09-30 10:59:23.000000000 +0200
+++ LdapAuthentication.php      2005-09-30 11:30:05.000000000 +0200
&#64;&#64; -146,7 +146,7 &#64;&#64;
                global $wgLDAPWriterDN, $wgLDAPWriterPassword;
                global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
                global $wgLDAPSearchAttribute;
-
+               global $wgLDAPGroupDN;
                if ( '' == $password ) {
                        return false;
                }
&#64;&#64; -173,6 +173,9 &#64;&#64;
                                $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
                                $this-&gt;realname = $info[0][&quot;cn&quot;][0];
                        }
+                       if ($wgLDAPGroupDN) {
+                               return $this-&gt;isMemberOfLdapGroup($ldapconn, $userdn, $wgLDAPGroupDN);
+                       }
                        // Lets clean up.
                        &#64;ldap_unbind();
                 } else {
&#64;&#64; -510,6 +513,23 &#64;&#64;
                $userdn = $info[0][&quot;dn&quot;];
                return $userdn;
        }
+
+       function isMemberOfLdapGroup($ldapconn, $userDN, $groupDN) {
+               global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
+               global $wgLDAPSearchAttributes;
+                $bind = &#64;ldap_bind( $ldapconn, $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword );
+               if (!$bind) {
+                       return '';
+               }
+               //we need to do a subbase search for the entry
+               $filter = &quot;(member=&quot;.$userDN.&quot;)&quot;;
+               $info=ldap_get_entries($ldapconn,&#64;ldap_search($ldapconn, $groupDN, $filter));
+               return ($info[&quot;count&quot;]&gt;=1);
+
+       }
+
+
+
 }
 
 ?&gt;
</pre>
    </div><div id="c53" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c53">Comment 53</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-09-30 13:00:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Using LDAP group is definitely a good idea.  A++.</pre>
    </div><div id="c54" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c54">Comment 54</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">JDPorter</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-03 16:43:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Am planning on patching User.php to set user rights according to group. Thoughts?</pre>
    </div><div id="c55" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c55">Comment 55</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-03 16:52:09 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c54">comment #54</a>)
<span class="quote">&gt; Am planning on patching User.php to set user rights according to group. Thoughts?</span >

Sounds good. Patch against 1.5 CVS, as all the changes in my patch except for
LdapAuthentication.php should be in the 1.5 branch already.

On another topic:

Could someone apply the last few patches that were submitted, against
LdapAuthentication.php, and add it as the current patch please? I am unable to
work on this right now as I don't have access to a non-work computer (I'm still
evacuated from Katrina).</pre>
    </div><div id="c56" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c56">Comment 56</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Udo Adametz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-07 14:13:34 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=945" name="attach_945" title="Version 1.0a of the LdapAuthentication.php (For Mediawiki 1.5) (=v1.0 plus changes in #50 #51 and #52)">attachment 945</a> <a href="attachment.cgi?id=945&amp;action=edit" title="Version 1.0a of the LdapAuthentication.php (For Mediawiki 1.5) (=v1.0 plus changes in #50 #51 and #52)">[details]</a></span>
Version 1.0a of the LdapAuthentication.php (For Mediawiki 1.5) (=v1.0 plus changes in #50 #51 and #52)

Because of the wish from Ryan lane I applied the last few patches that were
submitted against LdapAuthentication.php. For me it works fine.</pre>
    </div><div id="c57" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c57">Comment 57</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-07 14:20:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >So did LDAP auth not make into already-released 1.5.0?</pre>
    </div><div id="c58" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c58">Comment 58</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Udo Adametz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-07 15:16:20 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I use Mediawiki 1.5.0 and the LdapAuthentication.php from your LDAP patch v1.0 to authenticate against our company AD. So far it is working fine. 

(In reply to <a href="show_bug.cgi?id=814#c3">comment #3</a>)
<span class="quote">&gt; The interface for logging in is slightly different when using LDAP as well.Since the LDAP directory will be managing user accounts and passwords, </span >
I haveremoved the &quot;mail me a new password&quot; button, and the validate password field(unless $wgLDAPUseLocal is true). I have added a selection box 
that will allowusers to choose which domain they wish to authenticate against (in the aboveexample, the options would 
be &quot;testADdomain&quot;, &quot;testLDAPdomain&quot;, and &quot;local&quot;).

At first: I'm not very familiar with PHP, but: After reading your post i would expect that the &quot;mail me a new password&quot; button should disapear !? 
But even if i set $wgLDAPUseLocal=false the &quot;mail me a new Password&quot; button, and some other fields (Retype password, Create new account buttom, 
etc.) are always apearing on the user login page. Is this what you intented, and i only don't understand the coherences, or ist this a bug ?

Second: Unfortunately the usernames (loginname) in out AD are very cryptic, like xy15. Is the any posibillity/option that not the &quot;cn&quot;, like xy15, 
but the &quot;displayname&quot;, like Smith John, of the AD/LDAP users is used as wiki username? For example: i would like to log into the wiki with 
name &quot;xy15&quot;, but on the wiki history pages should apear &quot;Smith John&quot;. It would be very handy for us, and maby for other people to...

Thanks you, for any hints.</pre>
    </div><div id="c59" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c59">Comment 59</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Udo Adametz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-07 15:32:24 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c57">comment #57</a>)
<span class="quote">&gt; So did LDAP auth not make into already-released 1.5.0?</span >

Yes, but only the changes to the core files (AuthPlugin.diff,Language.diff,SpecialPreferences.diff,SpecialUserlogin.diff,User.diff,Userlogin.diff) 
are included in the 1.5.0. For a new installation you still need the LdapAuthentication.php, witch is not included in the relase 1.5.0



</pre>
    </div><div id="c60" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c60">Comment 60</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-17 16:55:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Is there an FM for me to RT?  Just curious how I set this up.  Just drop it into
a dir somewhere and it should show up as an option somewhere?</pre>
    </div><div id="c61" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c61">Comment 61</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-17 16:57:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c60">comment #60</a>)
<span class="quote">&gt; Is there an FM for me to RT?  Just curious how I set this up.  Just drop it into
&gt; a dir somewhere and it should show up as an option somewhere?</span >


Did you happen to check out the URL at the top of this page? ;)

<a href="http://meta.wikimedia.org/wiki/LDAP_Authentication">http://meta.wikimedia.org/wiki/LDAP_Authentication</a></pre>
    </div><div id="c62" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c62">Comment 62</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-17 17:00:45 UTC
        </span>
      </div>



<pre class="bz_comment_text" >/me hangs his head in shame and plunges the knife deep into his belly.</pre>
    </div><div id="c63" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c63">Comment 63</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-17 18:14:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c58">comment #58</a>)
<span class="quote">&gt; I use Mediawiki 1.5.0 and the LdapAuthentication.php from your LDAP patch v1.0</span >
to authenticate against our company AD. So far it is working fine. 
<span class="quote">&gt; 
&gt; At first: I'm not very familiar with PHP, but: After reading your post i would</span >
expect that the &quot;mail me a new password&quot; button should disapear !? 
<span class="quote">&gt; But even if i set $wgLDAPUseLocal=false the &quot;mail me a new Password&quot; button,</span >
and some other fields (Retype password, Create new account buttom, 
<span class="quote">&gt; etc.) are always apearing on the user login page. Is this what you intented,</span >
and i only don't understand the coherences, or ist this a bug ?
<span class="quote">&gt; </span >

Well, actually, the patch allows for mailing of a new password now. It also
allows for creation of new accounts and such. Originally the patch would remove
those fields, but now the patch for 1.5 is pretty much just
&quot;LdapAuthentication.php&quot;, so if you would like to disable these, you can edit
function &quot;modifyUITemplate&quot; in &quot;LdapAuthentication.php&quot; and add the following: 

     $template-&gt;set( 'create', false );
     $template-&gt;set( 'useemail', false );

<span class="quote">&gt; Second: Unfortunately the usernames (loginname) in out AD are very cryptic,</span >
like xy15. Is the any posibillity/option that not the &quot;cn&quot;, like xy15, 
<span class="quote">&gt; but the &quot;displayname&quot;, like Smith John, of the AD/LDAP users is used as wiki</span >
username? For example: i would like to log into the wiki with 
<span class="quote">&gt; name &quot;xy15&quot;, but on the wiki history pages should apear &quot;Smith John&quot;. It would</span >
be very handy for us, and maby for other people to...
<span class="quote">&gt; 
&gt; Thanks you, for any hints.</span >

Function &quot;authenticate&quot; in &quot;LdapAuthentication.php&quot; is where these attributes
are retreived. I have nickname set to &quot;displayname&quot; and real name set to &quot;cn&quot;.
You may want to set real name to be &quot;displayname&quot; as well as the nickname.
People should be able to log into the wiki using their usernames, and have their
nickname or real name shown as their displayname if you do this.</pre>
    </div><div id="c64" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c64">Comment 64</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Udo Adametz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-18 08:46:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c63">comment #63</a>)
<span class="quote">&gt; you can editfunction &quot;modifyUITemplate&quot; in &quot;LdapAuthentication.php&quot; and add the following:</span >
&gt;
<span class="quote">&gt; $template-&gt;set( 'create', false );
&gt; $template-&gt;set( 'useemail', false );</span >

Slowly but surely the single functions become more clearly to me. Thank you for your explanations, that works really nice for me! Perhaps you might 
want to add another variable, with controls this settings through the LocalSettings.php ?

<span class="quote">&gt; Function &quot;authenticate&quot; in &quot;LdapAuthentication.php&quot; is where these attributesare
&gt; retreived. I have nickname set to &quot;displayname&quot; and real name set to &quot;cn&quot;.You may
&gt; want to set real name to be &quot;displayname&quot; as well as the nickname.People should
&gt; be able to log into the wiki using their usernames, and have theirnickname or
&gt; real name shown as their displayname if you do this.</span >

Futher I changed in LdapAuthentication.php:

$this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
$this-&gt;realname = $info[0][&quot;cn&quot;][0];

into

$this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
$this-&gt;realname = $info[0][&quot;displayname&quot;][0];

but this does not work so far. After the login of a &quot;new&quot; user (=a user who have never been loged in bevor), the user settings (email, language, 
nickname (e.g.John Smith)) are correctly received from the AD, and are displayed in the user preferences. But the displayed Name in the upper right 
corner, and the link to the users page, are still named with the cryptic cn (e.g. xy15) an not with the displayname (e.g. Smith John).

Have you any futher suggestions? Thank you.</pre>
    </div><div id="c65" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c65">Comment 65</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-18 13:49:05 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c64">comment #64</a>)
<span class="quote">&gt; Slowly but surely the single functions become more clearly to me. Thank you</span >
for your explanations, that works really nice for me! Perhaps you might 
<span class="quote">&gt; want to add another variable, with controls this settings through the</span >
LocalSettings.php ?

I was thinking about it, but it could possibly add quite a few new options, and
since the template could be changed (and likely will be changed) by a lot of
people when they localize their wiki, the options may not be worthwhile.

<span class="quote">&gt; Futher I changed in LdapAuthentication.php:
&gt; 
&gt; $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
&gt; $this-&gt;realname = $info[0][&quot;cn&quot;][0];
&gt; 
&gt; into
&gt; 
&gt; $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
&gt; $this-&gt;realname = $info[0][&quot;displayname&quot;][0];
&gt; 
&gt; but this does not work so far. After the login of a &quot;new&quot; user (=a user who</span >
have never been loged in bevor), the user settings (email, language, 
<span class="quote">&gt; nickname (e.g.John Smith)) are correctly received from the AD, and are</span >
displayed in the user preferences. But the displayed Name in the upper right 
<span class="quote">&gt; corner, and the link to the users page, are still named with the cryptic cn</span >
(e.g. xy15) an not with the displayname (e.g. Smith John).
<span class="quote">&gt; 
&gt; Have you any futher suggestions? Thank you.</span >

Actually, now that I look into it, it seems that the name that shows in the
upper right hand corner is the login name of the user. The real name and
nickname do not seem to change how that is displayed. What should be displayed
for your users is whatever they log in as; so, if your AD usernames are some
weird cryptic name, then thats what will be shown.</pre>
    </div><div id="c66" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c66">Comment 66</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jeff Mandel</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-28 22:09:25 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Here's a patch that will add the ability to require the authenticated user to
have a required attribute in order to get access to the wiki. I was inspired to
do this by the require ldap-attribute of apache's mod_auth_ldap.

I started v 1.0 before the changes were included to makeup 1.0a. Hopefully I
have merged them properly, it does still work for me, though I didn't try the
group member feature. If the patch doesn't work for you, I can provide the full
file for better merging or comparison if that helps.

I moved the proxy user check to getUserDN. I noticed wherever the getUserDN was
called, a proxy check was done right before it, so I just incorporated it into
the getUserDN function.

Jeff


Additional parameters for LocalSettings:
Check for this or not:
$wgLDAPRequireAuthAttribute = true;

Look for the attribute/value, for example:
$wgLDAPAuthAttribute = array(
  &quot;ldap&quot;=&gt;&quot;businesscategory=wikiuser&quot;
  );

Businesscategory is a  multivalued attribute in the inetorgperson schema so it's
probably there for you to use already.

--- LdapAuthentication-1.0a.php 2005-10-28 14:47:28.000000000 -0700
+++ LdapAuthentication-require-attr.php 2005-10-28 14:45:35.000000000 -0700
&#64;&#64; -168,12 +168,17 &#64;&#64;
                if ( $ldapconn ) {
                        ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
                        ldap_set_option( $ldapconn, LDAP_OPT_REFERRALS, 0);
-                       if ($searchtype == &quot;proxy&quot; &amp;&amp; isset($wgLDAPProxyAgent)) {
+                       // Add additional search even if non-proxy to see if the
user
+                       // has the optionally required attribute. This should really
+                       // be done in the userExists section, but userExists
also checks
+                       // the wiki, and the user might be there if their role
was once
+                       // valid.
+                       // Proxy check is moved to getUserDN, so we can apply
the proxy
+                       // and the authattribute filter in one location only. - jeff
                                $userdn = $this-&gt;getUserDN($ldapconn, $username);
                                if ($userdn == '') {
                                        return false;
                                }
-                       }
                        $bind = &#64;ldap_bind($ldapconn, $userdn, $password);
                        if (!$bind) {
                                return false;
&#64;&#64; -253,12 +258,11 &#64;&#64;
                if ($ldapconn) {
                        ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
                        ldap_set_option( $ldapconn, LDAP_OPT_REFERRALS, 0);
-                       if ($searchtype == &quot;proxy&quot; &amp;&amp; isset($wgLDAPProxyAgent)) {
+                       // Proxy checking moved to the getUserDN function - jeff
                                $userdn = $this-&gt;getUserDN($ldapconn,
$user-&gt;getName());
                                if ($userdn == '') {
                                        return false;
                                }
-                       }
                        if (!isset($wgLDAPWriterDN)) {
                                return false;
                        }
&#64;&#64; -305,12 +309,11 &#64;&#64;
                if ($ldapconn) {
                        ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
                        ldap_set_option( $ldapconn, LDAP_OPT_REFERRALS, 0);
-                       if ($searchtype == &quot;proxy&quot; &amp;&amp; isset($wgLDAPProxyAgent)) {
+                       // Proxy checking moved to the getUserDN function - jeff
                                $userdn = $this-&gt;getUserDN($ldapconn,
$user-&gt;getName());
                                if ($userdn == '') {
                                        return false;
                                }
-                       }
                        $bind = &#64;ldap_bind( $ldapconn, $wgLDAPWriterDN,
$wgLDAPWriterPassword );
                        if (!$bind) {
                                return false;
&#64;&#64; -514,13 +517,29 &#64;&#64;

        function getUserDN($ldapconn, $username) {
                global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
-               global $wgLDAPSearchAttributes;
-               $bind = &#64;ldap_bind( $ldapconn, $wgLDAPProxyAgent,
$wgLDAPProxyAgentPassword );
-               if (!$bind) {
-                       return '';
+               global $wgLDAPSearchAttributes, $wgLDAPRequireAuthAttribute;
+               global $wgLDAPAuthAttribute;
+               if ($searchtype == &quot;proxy&quot; &amp;&amp; isset($wgLDAPProxyAgent)) {
+                       $bind = &#64;ldap_bind( $ldapconn, $wgLDAPProxyAgent,
$wgLDAPProxyAgentPassword );
+                       if (!$bind) {
+                               return '';
+                       }
+               } else {
+               // Do the search anonymously
+                       $bind = &#64;ldap_bind( $ldapconn );
+                       if (!$bind) {
+                               return '';
+                       }
                }
+
                //we need to do a subbase search for the entry
-               $filter = &quot;(&quot; . $wgLDAPSearchAttributes[$_SESSION['wsDomain']] .
&quot;=$username)&quot;;
+               // Check that the user also has the required attribute - jeff
+               if ($wgLDAPRequireAuthAttribute) {
+                       $filter = &quot;(&quot; .
$wgLDAPAuthAttribute[$_SESSION['wsDomain']] . &quot;)&quot;;
+               } else {
+                       $filter = &quot;(&quot; .
$wgLDAPSearchAttributes[$_SESSION['wsDomain']] . &quot;=$username)&quot;;
+               }
+
                $entry = &#64;ldap_search($ldapconn,
$this-&gt;getSearchString($username), $filter);
                if (!$entry) {
                        return '';
&#64;&#64; -529,10 +548,10 &#64;&#64;
                $userdn = $info[0][&quot;dn&quot;];
                return $userdn;
        }
-
        function isMemberOfLdapGroup($ldapconn, $userDN, $groupDN) {
                global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
                global $wgLDAPSearchAttributes;
+
                $bind = &#64;ldap_bind( $ldapconn, $wgLDAPProxyAgent,
$wgLDAPProxyAgentPassword );
                if (!$bind) {
                        return '';
</pre>
    </div><div id="c67" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c67">Comment 67</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-31 13:59:25 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Comment on <span class="bz_obsolete"><a href="attachment.cgi?id=787" name="attach_787" title="Patch DefaultSettings and Setup ($wgAuth)">attachment 787</a> <a href="attachment.cgi?id=787&amp;action=edit" title="Patch DefaultSettings and Setup ($wgAuth)">[details]</a></span>
Patch DefaultSettings and Setup ($wgAuth)

This patch may cause problems, and as such, I'm not recommending it.</pre>
    </div><div id="c68" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c68">Comment 68</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">slakkie</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-01 15:05:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hi,

I am not seeing through anymore, is there now a working solution for LDAP. If so could someone please direct us 
to the final files and documentation. As it is a bit mixed up where what is at the moment.

That would be very kind. Thank you!!

Regards
Slakkie</pre>
    </div><div id="c69" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c69">Comment 69</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-01 15:16:03 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c68">comment #68</a>)
<span class="quote">&gt; Hi,
&gt; 
&gt; I am not seeing through anymore, is there now a working solution for LDAP. If</span >
so could someone please direct us 
<span class="quote">&gt; to the final files and documentation. As it is a bit mixed up where what is at</span >
the moment.
<span class="quote">&gt; 
&gt; That would be very kind. Thank you!!
&gt; 
&gt; Regards
&gt; Slakkie</span >

The &quot;URL&quot; will lead you to the documentation. The current version of this patch
is 1.0a (I haven't obsoleted 1.0 yet because I haven't had the ability to test
1.0a fully, but others have tested it).

Is this in confusion to me obsoleting <span class="bz_obsolete"><a href="attachment.cgi?id=787" name="attach_787" title="Patch DefaultSettings and Setup ($wgAuth)">attachment 787</a> <a href="attachment.cgi?id=787&amp;action=edit" title="Patch DefaultSettings and Setup ($wgAuth)">[details]</a></span>? That was a patch to
&quot;DefaultSettings.php&quot; and &quot;Setup.php&quot;, which could have caused problems to some
people.

The current patch is a working solution for authentication, and as a partial
backend to mediawiki. It should fit your needs, if not let me know what is
missing (or submit a patch for what is missing).</pre>
    </div><div id="c70" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c70">Comment 70</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jeff Mandel</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-01 21:27:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=1036" name="attach_1036" title="Patch to 1.0.a for require attribute">attachment 1036</a> <a href="attachment.cgi?id=1036&amp;action=edit" title="Patch to 1.0.a for require attribute">[details]</a></span>
Patch to 1.0.a for require attribute

This is a restructured version of the first patch submitted to add support for
requiring a user to have a certain attribute to finish authenticating to the
wiki. It now properly handles the case where no proxy user is allowed, nor is
an anonymous search allowed.

Thanks to Marcus Schwartz who suggested this change.

This is a patch against v 1.0a, and only makes changes necessary to implement
the feature. I did move the GroupDN check above retrieve prefs, since I thought
there's no need to get any prefs if the user is not allowed access. This patch
has been tested with openldap and mw 1.5.

Additional parameters for LocalSettings:
Check for this or not:
$wgLDAPRequireAuthAttribute = true;

Look for the attribute/value, for example:
$wgLDAPAuthAttribute = array(
&quot;ldap&quot;=&gt;&quot;businesscategory=wikiuser&quot;
);

Businesscategory is a multivalued attribute in the inetorgperson schema so it's

probably there for you to use already.

Please let me know if you have any issues with the patch, I can send a fully
patched file if necessary.

Jeff</pre>
    </div><div id="c71" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c71">Comment 71</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-02 23:44:34 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=1038" name="attach_1038" title="Version 1.0b of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">attachment 1038</a> <a href="attachment.cgi?id=1038&amp;action=edit" title="Version 1.0b of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">[details]</a></span>
Version 1.0b of the LdapAuthentication.php Plugin (for Mediawiki 1.5)

Version 1.0b is now the current version of this plugin for Mediawiki 1.5.

This version of the plugin adds in the patch to 1.0a for role based
restriction, fixes a bug in the group based restrictions, and removes some
global variables in functions where they were not being used.

The bug in the group based restrictions could have occured when the wiki was
set up to do straight binds (when not using proxy authentication), and group
based restriction was enabled. The function &quot;isMemberOfLdapGroup&quot; was rebinding
as the proxy agent. To fix this problem, I just removed the rebinding, as
binding was being done before the method was called in the &quot;authenticate&quot;
function. This could be an issue if the user logging into the system is not
allowed to read group information in LDAP, as the last bind done in the
&quot;authenticate&quot; function is as the user logging in. As this is generally not the
case, this should not cause problems.</pre>
    </div><div id="c72" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c72">Comment 72</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-03 16:06:37 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=1042" name="attach_1042" title="Version 1.0c of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">attachment 1042</a> <a href="attachment.cgi?id=1042&amp;action=edit" title="Version 1.0c of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">[details]</a></span>
Version 1.0c of the LdapAuthentication.php Plugin (for Mediawiki 1.5)

Version 1.0c is now the current version of this plugin for Mediawiki 1.5.

This version of the plugin fixes a bug I introduced while testing in 1.0b,
where I accidentally commented something out (would only affect you if you were
using a local domain). It also fixes another bug I introduced in the
&quot;isMemberOfLdapGroup&quot; function. The bug would cause the function not to rebind
as the proxyagent. This was done to fix a bug where the proxyagent would rebind
whether the plugin was set to use straight binds or proxy binds (breaking
straight binds). However, the fix introduced a problem where if the user
binding did not have permissions to read groups, authentication would fail.

This fix still has a problem, but there will be problems no matter how this is
solved. With this fix, if the proxyagent does not have read permissions on
groups, then authentication will also fail. However, it is much better
situation to have the proxyagent try to read, than to have the user binding try
to read, as the proxyagent is more likely to have read access on all of the
directory (as this is generally what proxyagents are for).

So, the fix will cause the proxyagent to rebind in the &quot;isMemberOfLdapGroup&quot;
function if proxy authentication is being used.</pre>
    </div><div id="c73" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c73">Comment 73</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-03 18:54:36 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Is the plan for this to eventually be packaged with mediawiki proper?

PS LdapAuthentication 1.0a (and now 1.0c) work just great for me.  I use
proxyAgent for binding/searching.  Haven't done group member checking yet, but
now we may.  Great work!</pre>
    </div><div id="c74" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c74">Comment 74</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-03 22:13:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >No, it's a third-party plugin. MediaWiki is designed for public reference sites,
not for corporate intranets, so it's not something we'd be likely to maintain.</pre>
    </div><div id="c75" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c75">Comment 75</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kevin Grinberg</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-07 23:20:19 UTC
        </span>
      </div>



<pre class="bz_comment_text" >RE: Ryan's instructions for getting group authentication to work on AD

I spent a lot longer than I should have trying to get it to work as written, but
finally debugged it down to a case-sensitivity issue:

$info[0][&quot;distinguishedName&quot;][0];
should be
$info[0][&quot;distinguishedname&quot;][0];

I'm not sure if it's just my setup (PHP 5.0.5 on Windows, authenticating against
a 2003 AD), or something more general, but making the array key names lowercase
seems like a safer bet.

Also, is there any reason not to move the &quot;if ($wgLDAPRetrievePrefs) {&quot; section
above the &quot;if ($wgLDAPGroupDN) {&quot; check?

I already pull the preferences, so I didn't see the point in duplicating the
code... just switching the order of the sections (pull LDAP properties first,
including distinguishedname, then check for group membership) seemed to work out
well for me.  Is there any reason not to make the switch in the patch?</pre>
    </div><div id="c76" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c76">Comment 76</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-10 07:07:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c75">comment #75</a>)
<span class="quote">&gt; RE: Ryan's instructions for getting group authentication to work on AD
&gt; 
&gt; Also, is there any reason not to move the &quot;if ($wgLDAPRetrievePrefs) {&quot; section
&gt; above the &quot;if ($wgLDAPGroupDN) {&quot; check?
&gt; 
&gt; I already pull the preferences, so I didn't see the point in duplicating the
&gt; code... just switching the order of the sections (pull LDAP properties first,
&gt; including distinguishedname, then check for group membership) seemed to work out
&gt; well for me.  Is there any reason not to make the switch in the patch?</span >

Well, in your case, it would work more efficiently to pull preferences first, and then check the group. If you are not using AD, then it is probably more efficient to pull 
after you check for group membership. I'll look into a better way of doing this. Thanks for the update, I'll change my documentation to reflect the lowercase requirement 
on the attribute name.</pre>
    </div><div id="c77" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c77">Comment 77</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">David Schibeci</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-30 04:12:42 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Thanks to Ryan for the LdapAuthentication.php Plugin and Pierre for adding group
membership.

I've modified LdapAuthentication.php to use a variable for the member attribute
as we use groupOfUniqueMembers rather than groupOfMembers.

Here is my modification if anyone else might find it useful:

--- /root/mediawiki/LdapAuthentication-1.0c.php 2005-11-30 10:41:29.000000000 +0800
+++ includes/LdapAuthentication.php     2005-11-30 10:41:49.000000000 +0800
&#64;&#64; -154,6 +154,7 &#64;&#64;
                global $wgLDAPRetrievePrefs;
                global $wgLDAPProxyAgent;
                global $wgLDAPGroupDN;
+               global $wgLDAPMemberAttributes;
                global $wgLDAPRequireAuthAttribute, $wgLDAPAuthAttribute;
 
                if ( '' == $password ) {
&#64;&#64; -183,7 +184,7 &#64;&#64;
                                if ($info[&quot;count&quot;] &lt; 1) { return false; }
                         }
                        if ($wgLDAPGroupDN) {
-                               return $this-&gt;isMemberOfLdapGroup($ldapconn,
$userdn, $wgLDAPGroupDN);
+                               return $this-&gt;isMemberOfLdapGroup($ldapconn,
$userdn, $wgLDAPGroupDN[$_SESSION['wsDomain']],
$wgLDAPMemberAttributes[$_SESSION['wsDomain']]);
                        }
                        if ($wgLDAPRetrievePrefs) {
                                $entry = &#64;ldap_read($ldapconn, $userdn,
&quot;objectclass=*&quot;);
&#64;&#64; -541,7 +542,7 &#64;&#64;
                return $userdn;
        }
 
-       function isMemberOfLdapGroup($ldapconn, $userDN, $groupDN) {
+       function isMemberOfLdapGroup($ldapconn, $userDN, $groupDN, $memberattr) {
                global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
                global $wgLDAPSearchAttributes;
                //If we are using a proxyagent, we should search the groups
using a proxyagent.
&#64;&#64; -553,7 +554,7 &#64;&#64;
                        }
                }
                //we need to do a subbase search for the entry
-               $filter = &quot;(member=&quot;.$userDN.&quot;)&quot;;
+               $filter = &quot;($memberattr=&quot;.$userDN.&quot;)&quot;;
                $info=ldap_get_entries($ldapconn,&#64;ldap_search($ldapconn,
$groupDN, $filter));
                return ($info[&quot;count&quot;]&gt;=1);
        }

I also made $wgLDAPGroupDN an array which is why
$wgLDAPGroupDN[$_SESSION['wsDomain']] is sent to isMemberOfLdapGroup</pre>
    </div><div id="c78" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c78">Comment 78</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Sarith Sircar</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-12-21 11:12:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I've installed Wiki 1.5.3 on IIS 5.0, Win 2K Pro, PHP 5.1, MySQL 3.23. After doing an 
LDAP integration, the authentication works fine. But when I get the &quot;login succesful&quot; 
page, this appears - 

Notice: Undefined variable: servers in 
C:\Wiki\mediawiki\includes\LdapAuthentication.php on line 87

Your help appreciated.</pre>
    </div><div id="c79" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c79">Comment 79</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Edward Rudd</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-12-21 14:08:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(Copied from <a href="show_bug.cgi?id=814#c49">Comment #49</a>)
This is not a support channel. Go to IRC or the mailing lists to get support.
DO not change the bug status information like the way you did.. If you've found
a bug, file a new report, don't change the status of an enhancement bug and
&quot;morph&quot; into your issue.

I'm reverting the status on this bug.</pre>
    </div><div id="c80" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c80">Comment 80</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Sarith Sircar</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-12-22 09:08:05 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c79">comment #79</a>)
<span class="quote">&gt; (Copied from <a href="show_bug.cgi?id=814#c49">Comment #49</a>)This is not a support channel. Go to IRC or the mailing lists to get </span >
support.DO not change the bug status information like the way you did.. If you've founda bug, file 
a new report, don't change the status of an enhancement bug and&quot;morph&quot; into your issue.I'm 
reverting the status on this bug.

Well, I'd think that if a patch doesnt work 100% in the said configurations and throws exceptions, 
it should be considered a bug. If you cant replicate the error or dont have a clue, might as well 
mention that.
</pre>
    </div><div id="c81" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c81">Comment 81</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rob Church</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-12-22 13:10:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c80">comment #80</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=814#c79">comment #79</a>)
&gt; &gt; (Copied from <a href="show_bug.cgi?id=814#c49">Comment #49</a>)This is not a support channel. Go to IRC or the</span >
mailing lists to get 
<span class="quote">&gt; support.DO not change the bug status information like the way you did.. If</span >
you've founda bug, file 
<span class="quote">&gt; a new report, don't change the status of an enhancement bug and&quot;morph&quot; into</span >
your issue.I'm 
<span class="quote">&gt; reverting the status on this bug.
&gt; 
&gt; Well, I'd think that if a patch doesnt work 100% in the said configurations</span >
and throws exceptions, 
<span class="quote">&gt; it should be considered a bug. If you cant replicate the error or dont have a</span >
clue, might as well 
<span class="quote">&gt; mention that.</span >

Was the &quot;patch&quot; part of the code provided in the official MediaWiki distribution
tarball?

</pre>
    </div><div id="c82" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c82">Comment 82</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Eisner</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-05 09:40:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hi,

what do you think about making the attributes more flexible (see <a href="show_bug.cgi?id=814#c67">comment #67</a>) e.
g. by shifting the values of

                               $this-&gt;email = $info[0][&quot;mail&quot;][0];
                                $this-&gt;lang = $info[0][&quot;preferredlanguage&quot;][0];
                                $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
                                $this-&gt;realname = $info[0][&quot;cn&quot;][0];

as variables to the Localsettings, then it would be easier to customize for not
so standard set up LDAP Servers. </pre>
    </div><div id="c83" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c83">Comment 83</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Eisner</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-05 09:43:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >oops, i meant <a href="show_bug.cgi?id=814#c63">comment #63</a> - sorry</pre>
    </div><div id="c84" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c84">Comment 84</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Eisner</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-05 10:54:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >One more question on groups. As already discussed it is possible to give access
based on different groups defined on the LDAP Server. What I would like to do
ist to assign group right within the wikidb according to this information which
can easily be retrived together with the uerprefs, so I can use

 $wgGroupPermissions

rules based on the data from the LDAP. Creating the groups can be done manually
before, but assignment of users in an automatic way on (1st?) login would be
great instead of using Special:Userrights or editing the database directly.

Anybody any ideas how to achive this?</pre>
    </div><div id="c85" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c85">Comment 85</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-06 22:48:03 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c82">comment #82</a>)
<span class="quote">&gt; Hi,
&gt; 
&gt; what do you think about making the attributes more flexible (see <a href="show_bug.cgi?id=814#c67">comment #67</a>) e.
&gt; g. by shifting the values of
&gt; 
&gt;                                $this-&gt;email = $info[0][&quot;mail&quot;][0];
&gt;                                 $this-&gt;lang = $info[0][&quot;preferredlanguage&quot;][0];
&gt;                                 $this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
&gt;                                 $this-&gt;realname = $info[0][&quot;cn&quot;][0];
&gt; 
&gt; as variables to the Localsettings, then it would be easier to customize for not
&gt; so standard set up LDAP Servers. </span >

Next time I have a chance to update the plugin, I'll add options for these. The
biggest problem with doing this is that it adds four new options to the
configuration. I guess I'll have to look into adding a &quot;LDAPDefaultSettings.php&quot;
file.</pre>
    </div><div id="c86" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c86">Comment 86</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-06 23:00:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c84">comment #84</a>)
<span class="quote">&gt; One more question on groups. As already discussed it is possible to give access
&gt; based on different groups defined on the LDAP Server. What I would like to do
&gt; ist to assign group right within the wikidb according to this information which
&gt; can easily be retrived together with the uerprefs, so I can use
&gt; 
&gt;  $wgGroupPermissions
&gt; 
&gt; rules based on the data from the LDAP. Creating the groups can be done manually
&gt; before, but assignment of users in an automatic way on (1st?) login would be
&gt; great instead of using Special:Userrights or editing the database directly.
&gt; 
&gt; Anybody any ideas how to achive this?</span >

This is definitely possible... It would be taxing on your LDAP servers if you
have very heavy traffic though. Since LDAP would be your authoritative source,
and since this is authorization information, you shouldn't cache the information
from LDAP. So, every time someone requests a page, it would probably cause a
lookup in LDAP. I guess you could cache the information per session if you
rarely change the info in LDAP...

I'll look into a good way to implement this, as this is also something I'd like.
No promises on time frame though, as I don't have reliable internet access. If
someone else wants to look into how to tackle this, please have at it.</pre>
    </div><div id="c87" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c87">Comment 87</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Nick Hildebrant</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-11 06:02:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I had some issues getting LDAP Auth working in MediaWiki 1.5.5. After logging in
with a valid uname and passwd I got the error:

Call to a member function on a non-object in SpecialUserlogin.php on 314.

This seems like a mediawiki bug, and the following change to
SpecialUserlogin.php was required to make LDAP Auth work...

&lt;                                       $u = $this-&gt;initUser( $u );
---
<span class="quote">&gt;                                       $u =&amp; $this-&gt;initUser( $u );</span ></pre>
    </div><div id="c88" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c88">Comment 88</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Manilal K M</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-11 06:08:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have posted this mail to the <a href="mailto:wikitech-l&#64;wikipedia.org">wikitech-l&#64;wikipedia.org</a>. But got Ryan's
instruction to post it here. 

I have just started hacking mediawiki. I am trying to apply the LDAP
authentication plugin to mediawiki-1.5.2 in a FC-4. I'm using openldap-2.2.23-5.
 I have read the  documentation at :
<a href="http://meta.wikimedia.org/wiki/LDAP_Authentication">http://meta.wikimedia.org/wiki/LDAP_Authentication</a> and downloaded the plugin
from :<a href="http://bugzilla.wikipedia.org/attachment.cgi?id=1042&amp;action=view">http://bugzilla.wikipedia.org/attachment.cgi?id=1042&amp;action=view</a>

I have dropped the above file in /includes and changed Localsettings.php
accordingly. Luckily everything seems to be working fine. But everything crashed
when I tried to Group based authentication in mediawiki. I have added group
entry to the ldap server, restarted it and then inlcuded the configuration
parameters for group based
authentication. Now my Localsettings.php looks like this:
&lt;code&gt;
require_once( 'LdapAuthentication.php' );
$wgAuth = new LdapAuthenticationPlugin();
$wgLDAPDomainNames = array( &quot;libregeek&quot; );
$wgLDAPServerNames = array( &quot;libregeek&quot;=&gt;&quot;localhost&quot;  );
$wgLDAPSearchStrings = array(
&quot;libregeek&quot;=&gt;&quot;uid=USER-NAME,ou=People,dc=libregeek,dc=net&quot;  );
$wgLDAPUseSSL = false;
$wgLDAPUseLocal = false;
$wgLDAPAddLDAPUsers = false;
$wgLDAPUpdateLDAP = false;
$wgLDAPMailPassword = false;
$wgLDAPRetrievePrefs = false;
$wgMinimalPasswordLength = 1;

$wgLDAPGroupDN = &quot;cn=itpeople,ou=Groups,dc=libregeek,dc=net&quot;;
$wgLDAPProxyAgent = &quot;cn=root,dc=libregeek,dc=net&quot;;
$wgLDAPProxyAgentPassword = &quot;secret&quot;; //this should work with hashes btw
$wgLDAPBaseDNs = array(&quot;libregeek&quot;=&gt;&quot;dc=libregeek,dc=net&quot;);
$wgLDAPSearchAttributes =
array(&quot;libregeek&quot;=&gt;&quot;(uid=USER-NAME)(wikiAccess=TRUE)&quot;);
&lt;/code&gt;

With this configuration I can't login . It simply says &quot;The password you entered
is incorrect (or missing). Please try again.&quot;. is there any missing
configuration items ?? I just tried to print the global variables corresponding
to Proxies in LdapAuthentication.php and it gives nothing. One more thing I
didn't got the correct idea of Proxy. is it like the &quot;Manager&quot; account who has
read permission to all the directory entries. 

what may have gone wrong?
please help
regards

Manilal</pre>
    </div><div id="c89" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c89">Comment 89</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-12 01:10:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c88">comment #88</a>)
<span class="quote">&gt; I have posted this mail to the <a href="mailto:wikitech-l&#64;wikipedia.org">wikitech-l&#64;wikipedia.org</a>. But got Ryan's
&gt; instruction to post it here. 
&gt; </span >

Actually, I wanted you to post it to the discussion page on meta ;). This spot
is really more for people who are developing addons for the plugin.

V/r,

Ryan Lane</pre>
    </div><div id="c90" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c90">Comment 90</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neil M</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-30 18:20:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I modified the LDAP code to do a search before doing the bind, this is typical
of LDAP authentication mechanisms.  This is required if your LDAP does not use
uid in the DN string.  It also allows you to use other unique attributes for
login, such as &quot;mail&quot; or &quot;cn&quot;.  I highly recommend that this standard
functionality be added to the next release.

        function getSearchString($username) {
            global $wgLDAPSearchStrings, $wgLDAPBaseDNs;
            $userdn = $wgLDAPBaseDNs[$_SESSION['wsDomain']];
                $this-&gt;SearchType = &quot;proxy&quot;;
                if (!isset($userdn)) {
                        $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];

                        // NCM added for dn search before bind
                        $parseddn = split(&quot;USER-NAME&quot;, $tmpuserdn);
                        $searchdn = substr($parseddn[1], 1);
                        $filter = $parseddn[0] . $username;

                        $ldapconn = $this-&gt;connect();
                        if ($ldapconn) {
                                ldap_set_option( $ldapconn,
LDAP_OPT_PROTOCOL_VERSION, 3);
                                ldap_set_option( $ldapconn, LDAP_OPT_REFERRALS, 0);
                                # request these attributes
                                $justthese = array(&quot;dn&quot;);

                                $sr = ldap_search($ldapconn, $searchdn, $filter,
$justthese);
                                if ($sr !== FALSE) {
                                        $info = ldap_get_entries($ldapconn, $sr);
                                        $userdn = $info[0][&quot;dn&quot;];
                                } else {
                                        ldap_error($ldapconn);
                                }

                                ldap_unbind($ldapconn);
                                $this-&gt;SearchType = &quot;nonproxy&quot;;
                        }
                        else {
                                $userdn =
str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
                        }
                }

                return $userdn;
        }</pre>
    </div><div id="c91" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c91">Comment 91</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-30 20:06:01 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c90">comment #90</a>)
<span class="quote">&gt; I modified the LDAP code to do a search before doing the bind, this is typical
&gt; of LDAP authentication mechanisms.  This is required if your LDAP does not use
&gt; uid in the DN string.  It also allows you to use other unique attributes for
&gt; login, such as &quot;mail&quot; or &quot;cn&quot;.  I highly recommend that this standard
&gt; functionality be added to the next release.
&gt; 
&gt;         function getSearchString($username) {
&gt;             global $wgLDAPSearchStrings, $wgLDAPBaseDNs;
&gt;             $userdn = $wgLDAPBaseDNs[$_SESSION['wsDomain']];
&gt;                 $this-&gt;SearchType = &quot;proxy&quot;;
&gt;                 if (!isset($userdn)) {
&gt;                         $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];
&gt; 
&gt;                         // NCM added for dn search before bind
&gt;                         $parseddn = split(&quot;USER-NAME&quot;, $tmpuserdn);
&gt;                         $searchdn = substr($parseddn[1], 1);
&gt;                         $filter = $parseddn[0] . $username;
&gt; 
&gt;                         $ldapconn = $this-&gt;connect();
&gt;                         if ($ldapconn) {
&gt;                                 ldap_set_option( $ldapconn,
&gt; LDAP_OPT_PROTOCOL_VERSION, 3);
&gt;                                 ldap_set_option( $ldapconn,</span >
LDAP_OPT_REFERRALS, 0);
<span class="quote">&gt;                                 # request these attributes
&gt;                                 $justthese = array(&quot;dn&quot;);
&gt; 
&gt;                                 $sr = ldap_search($ldapconn, $searchdn, $filter,
&gt; $justthese);
&gt;                                 if ($sr !== FALSE) {
&gt;                                         $info = ldap_get_entries($ldapconn, $sr);
&gt;                                         $userdn = $info[0][&quot;dn&quot;];
&gt;                                 } else {
&gt;                                         ldap_error($ldapconn);
&gt;                                 }
&gt; 
&gt;                                 ldap_unbind($ldapconn);
&gt;                                 $this-&gt;SearchType = &quot;nonproxy&quot;;
&gt;                         }
&gt;                         else {
&gt;                                 $userdn =
&gt; str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
&gt;                         }
&gt;                 }
&gt; 
&gt;                 return $userdn;
&gt;         }</span >

It looks like this change affects straight binds...

What if the directory server required authentication to search? In that case,
this change breaks straight binds. If you want to search, you should be doing a
proxy search. If you don't have a proxyagent, try setting the proxyagent
information blank to do your search.

Many people do not allow anonymous searching (I for one do not), but still want
to do straight binds (me again).

If the plugin for some reason will not allow anonymous searching, please send a
patch for that.

If I am misunderstanding what your code changes do, let me know (and please
submit changes in unified diff format in the future, as it is easier to see what
you changed).</pre>
    </div><div id="c92" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c92">Comment 92</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neil M</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-21 22:43:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Sorry, I think these changes should address your concerns.  If the search fails
(or bad anonymous/proxy bind occurs), then the function will kick out the
original DN with the replaced USER-NAME string just like the original function did.

--- ../extensions/LdapAuthentication.php  2006-02-21 14:00:31.000000000 -0800
+++ LdapAuthentication.php      2006-02-21 14:00:30.000000000 -0800
&#64;&#64; -505,13 +505,39 &#64;&#64;

  function getSearchString($username) {
             global $wgLDAPSearchStrings, $wgLDAPBaseDNs;
+    global $wgLDAPProxyAgent, $wgLDAPProxyAgentPassword;
             $userdn = $wgLDAPBaseDNs[$_SESSION['wsDomain']];
     $this-&gt;SearchType = &quot;proxy&quot;;
     if (!isset($userdn)) {
                       $tmpuserdn = $wgLDAPSearchStrings[$_SESSION['wsDomain']];
                       $userdn = str_replace(&quot;USER-NAME&quot;,$username,$tmpuserdn);
+
+     // NCM added for dn search before bind
+     $parseddn = split(&quot;USER-NAME&quot;, $tmpuserdn);
+     $searchdn = substr($parseddn[1], 1);
+     $filter = $parseddn[0] . $username;
+
+     $ldapconn = $this-&gt;connect();
+     if ($ldapconn) {
+      $bind = &#64;ldap_bind( $ldapconn, $wgLDAPProxyAgent,
$wgLDAPProxyAgentPassword );
+      if ($bind) {
+       ldap_set_option( $ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);
+                                      ldap_set_option( $ldapconn,
LDAP_OPT_REFERRALS, 0);
+       # request these attributes
+       $justthese = array(&quot;dn&quot;);
+
+       $sr = &#64;ldap_search($ldapconn, $searchdn, $filter, $justthese);
+       if ($sr !== FALSE) {
+        $info = ldap_get_entries($ldapconn, $sr);
+        $userdn = $info[0][&quot;dn&quot;];
+       } else {
+        ldap_error($ldapconn);
+       }
+      }
+      ldap_unbind($ldapconn);
      $this-&gt;SearchType = &quot;nonproxy&quot;;
     }
+    }
     return $userdn;
  }</pre>
    </div><div id="c93" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c93">Comment 93</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-22 19:10:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=1412" name="attach_1412" title="Version 1.0d of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">attachment 1412</a> <a href="attachment.cgi?id=1412&amp;action=edit" title="Version 1.0d of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">[details]</a></span>
Version 1.0d of the LdapAuthentication.php Plugin (for Mediawiki 1.5)

This is a bugfix version of the plugin. 

This should address comments #90-92. It also fixes an issue where even if local
authentication was chosen, the plugin would try to authenticate to the LDAP
server. Notice that if you are trying to create local accounts, it will still
try to contact the LDAP server (this is so that people cannot create local
accounts with the same name as LDAP users). It also fixes a bug with proxy
authentication, where if the plugin was misconfigured just the right way, it
would let users in without authenticating (you'd notice this if it was
happening...).

The code was partially refactored. It was cleaned up quite a bit, and the way
proxy authentication was being done is now different (it was being done in a
very asinine way before). It should be a transparent change though. It does
allow you to use $wgLDAPSearchStrings and $wgLDAPBaseDN together (although
there still isn't much reason to do it).

I have not yet added variables for preference attributes, but I plan on getting
to that next release.</pre>
    </div><div id="c94" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c94">Comment 94</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-22 19:17:01 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c92">comment #92</a>)
<span class="quote">&gt; Sorry, I think these changes should address your concerns.  If the search fails
&gt; (or bad anonymous/proxy bind occurs), then the function will kick out the
&gt; original DN with the replaced USER-NAME string just like the original function</span >
did.

Well, it really doesn't. These changes don't really add anything the plugin
doesn't already do. What you were adding, is done when you do a proxy search.
I've refactored my code, and it should be a little more apparent what I'm doing
in the newest version. You can get the functionality you want, by doing a proxy
search instead of a straight bind.

Look at the configuration options at:
<a href="http://meta.wikimedia.org/wiki/LDAP_Authentication_Configuration_Examples#Single_Domain_Requiring_Proxyagent_Binding">http://meta.wikimedia.org/wiki/LDAP_Authentication_Configuration_Examples#Single_Domain_Requiring_Proxyagent_Binding</a>

It'll do what you need. Just leave out &quot;$wgLDAPProxyAgent&quot; and
&quot;$wgLDAPProxyAgentPassword&quot; for anonymous searches. If for some reason, I'm just
not understanding how my plugin isn't doing exactly what your code is doing
above, let me know.</pre>
    </div><div id="c95" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c95">Comment 95</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Neil M</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-23 02:31:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ok, that looks good except getUserDN() needs a line that reads &quot;global
$wgLDAPBaseDNs;&quot;  Also it wasn't clear in the documentation what the difference
between using $wgLDAPBaseDNs and $wgLDAPSearchStrings is.  I'm not using a
Proxyagent so I never looked in that section where $wgLDAPBaseDNs is referenced
until now.</pre>
    </div><div id="c96" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c96">Comment 96</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Hackeron</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-23 02:45:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Cant get this to work with enotifWiki 3.60 + MediaWiki 1.5.6 - I get:

Warning: Missing argument 1 for inituser() in
/var/www/mediawiki1.5.6+enotifwiki3.60/includes/LdapAuthentication.php on line 484

Fatal error: Call to a member function on a non-object in
/var/www/mediawiki1.5.6+enotifwiki3.60/includes/LdapAuthentication.php on line 491

Any ideas?</pre>
    </div><div id="c97" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c97">Comment 97</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">T. Gries</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-23 05:38:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c96">comment #96</a>)
<span class="quote">&gt; Cant get this to work with enotifWiki 3.60 + MediaWiki 1.5.6 - I get:
&gt; 
&gt; Warning: Missing argument 1 for inituser() in
&gt; /var/www/mediawiki1.5.6+enotifwiki3.60/includes/LdapAuthentication.php on line 484
&gt; Fatal error: Call to a member function on a non-object in
&gt; /var/www/mediawiki1.5.6+enotifwiki3.60/includes/LdapAuthentication.php on line 491</span >

Please keep in mind, that questions regarding EnotifWiki should perhaps better
be placed on the page on <a href="http://www.enotifwiki.org">http://www.enotifwiki.org</a> in order not to disturb the
main development line of MediaWiki.

In your case I am still not sure why this problem came up, but EnotifWiki has
not been tested together with LdapAuthentication and has another method built in
see [1] which perhaps can be adapted to work with LdapAuthentication. Sorry for
this limited help.

[1] <a href="http://bugzilla.wikipedia.org/show_bug.cgi?id=1360">http://bugzilla.wikipedia.org/show_bug.cgi?id=1360</a> Auto-login /
Auto-account-creation by hostname for intranet MediaWikis</pre>
    </div><div id="c98" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c98">Comment 98</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-03 00:00:09 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=1426" name="attach_1426" title="Version 1.0e of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">attachment 1426</a> <a href="attachment.cgi?id=1426&amp;action=edit" title="Version 1.0e of the LdapAuthentication.php Plugin (for Mediawiki 1.5)">[details]</a></span>
Version 1.0e of the LdapAuthentication.php Plugin (for Mediawiki 1.5)

This is the latest version of the LdapAuthentication plugin.

This fixes <a href="show_bug.cgi?id=814#c95">comment #95</a>, which was introduced with plugin version 1.0d, and may
affect proxy-style logins.</pre>
    </div><div id="c99" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c99">Comment 99</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mario</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-10 09:30:24 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have a problem: When I change the password of a user in AD I can logon in
MediaWiki with the new and the old password. Can anyone help me?</pre>
    </div><div id="c100" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c100">Comment 100</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jonathan King</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-13 17:11:42 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Has anybody noticed that the version number of the attached files are wrong?
Presently, the version 1.0e link is to a file that has a version 1.0a notice
inside. Ryan, I assume that you are the one to update this in the future? When
1.0f comes around, can you update the internal documentation please? Thanks for
a great addition!</pre>
    </div><div id="c101" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c101">Comment 101</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-14 00:21:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c99">comment #99</a>)
<span class="quote">&gt; I have a problem: When I change the password of a user in AD I can logon in
&gt; MediaWiki with the new and the old password. Can anyone help me?</span >

This may be a bug. The wiki may be saving the user's password in the database
(it shouldn't be). Please post this on the talk page at meta (follow the URL at
the top of this page), so that we can debug it and see if this is a bug or not.</pre>
    </div><div id="c102" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c102">Comment 102</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mike Vonderbecke</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-22 17:50:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I'm having some problems getting Group authentication working with Active
Directory on a Windows 2000 domain.  I've hacked the code per the documentation
and set up my wgLDAPGroupDN variable to be
&quot;CN=wikitest,CN=Users,DC=ourdomain,DC=com&quot; (where ourdomain obviously is the
actual value).

Every time I try to log in I get an error that the password is missing or
incorrect.  This is on a user that was already able to login via LDAP
Authentication prior to turning on group auth.  I double checked that the User
is a member of the wikitest group, I also double checked the distinguishedname
of both the group and the user using the ADSIEdit program that comes with W2k
server and they match up.

Any ideas as to why I'm having a problem?  I have 1.0e.</pre>
    </div><div id="c103" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c103">Comment 103</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-22 19:21:49 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c102">comment #102</a>)
<span class="quote">&gt; I'm having some problems getting Group authentication working with Active
&gt; Directory on a Windows 2000 domain.  I've hacked the code per the documentation
&gt; and set up my wgLDAPGroupDN variable to be
&gt; &quot;CN=wikitest,CN=Users,DC=ourdomain,DC=com&quot; (where ourdomain obviously is the
&gt; actual value).
&gt; 
&gt; Every time I try to log in I get an error that the password is missing or
&gt; incorrect.  This is on a user that was already able to login via LDAP
&gt; Authentication prior to turning on group auth.  I double checked that the User
&gt; is a member of the wikitest group, I also double checked the distinguishedname
&gt; of both the group and the user using the ADSIEdit program that comes with W2k
&gt; server and they match up.
&gt; 
&gt; Any ideas as to why I'm having a problem?  I have 1.0e.</span >

Please use the discussion page on the LDAP Authentication page at meta. This is
not a support forum.</pre>
    </div><div id="c104" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c104">Comment 104</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-03-22 23:04:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >While we are on the topic of group authentication. Justin Grote mentioned he was
going to be working on a better solution for this. I haven't heard anything back
from him (this was January 29th). If anyone knows what the status of that is,
please post it.

It seems we have a need for updated code, and if he isn't working on it I'll
start working on it.</pre>
    </div><div id="c105" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c105">Comment 105</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-07 16:22:00 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Has anyone got this working with mediawiki 1.6?  We just upgraded and
authentication always fails now.

We're authenticating against AD, worked fine with 1.5.5.</pre>
    </div><div id="c106" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c106">Comment 106</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-07 16:23:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Just noticed this error at the top of the page after auth failure as well:

&lt;b&gt;Warning&lt;/b&gt;:  Compilation failed: characters with values &gt; 255 are not yet
supported in classes at offset 33 in
&lt;b&gt;/usr/local/mediawiki-1.6.1/includes/User.php&lt;/b&gt; on line &lt;b&gt;224&lt;/b&gt;&lt;br /&gt;
</pre>
    </div><div id="c107" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c107">Comment 107</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-07 16:41:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c106">comment #106</a>)
<span class="quote">&gt; Just noticed this error at the top of the page after auth failure as well:
&gt; 
&gt; &lt;b&gt;Warning&lt;/b&gt;:  Compilation failed: characters with values &gt; 255 are not yet
&gt; supported in classes at offset 33 in
&gt; &lt;b&gt;/usr/local/mediawiki-1.6.1/includes/User.php&lt;/b&gt; on line &lt;b&gt;224&lt;/b&gt;&lt;br /&gt;
&gt; </span >

This was due to a PHP/unicode/preg_match() issue, unrelated to LDAP auth.  I
commented out that block of code and LDAP auth still fails, but the error goes
away :p</pre>
    </div><div id="c108" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c108">Comment 108</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Don Seiler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-07 17:12:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c105">comment #105</a>)
<span class="quote">&gt; Has anyone got this working with mediawiki 1.6?  We just upgraded and
&gt; authentication always fails now.
&gt; 
&gt; We're authenticating against AD, worked fine with 1.5.5.</span >


GAH don't mind me.  This is a case of too many things changing at once and too
many cooks.  Other admin updated to new version of LdapAuthentication, and proxy
binding wasn't being done there.  Reverted to older version of
LdapAuthentication.php and all works fine.  I'll have to look at configs for new
version to see what is different.</pre>
    </div><div id="c109" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c109">Comment 109</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jared Greenwald</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-07 18:03:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I tired the .8 patch for my 1.4.15 config and I can't seem to get it working. 
I'm not even sure its setup correctly.  I followed the examples in found in the
wiki, but when I try using an ldap uid to login, it fails.</pre>
    </div><div id="c110" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c110">Comment 110</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-12 21:16:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c109">comment #109</a>)
<span class="quote">&gt; I tired the .8 patch for my 1.4.15 config and I can't seem to get it working. 
&gt; I'm not even sure its setup correctly.  I followed the examples in found in the
&gt; wiki, but when I try using an ldap uid to login, it fails.</span >

I gotta be honest. I probably don't remember how to setup version .8 with
mediawiki 1.4. I'd have to look back at my old code. I've dropped support for
version .8 and mediawiki 1.4. If you can, upgrade your wiki to 1.5 or 1.6
series, the documentation for that is good.</pre>
    </div><div id="c111" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c111">Comment 111</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Hang Xie</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-22 21:47:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >It will be great if user can choose the way for hashing password in LDAP.

fyi, i'm trying to integrate mediawiki with my existing LDAP, SHA generated by
this plugin will break an existing application as it knows CRYPT only.

i added a new configuration, $wgLDAPPasswordHash to get this works, here is the
diff to 1.0e:

232c232,233
&lt;
---
<span class="quote">&gt;               global $wgLDAPPasswordHash;</span >
&gt;
241,242c242,255
&lt;               $pwd_md5 = base64_encode(pack('H*',sha1($password)));
&lt;               $pass = &quot;{SHA}&quot;.$pwd_md5;
---
&gt;
<span class="quote">&gt;               switch ($wgLDAPPasswordHash) {
&gt;                       case 'crypt':
&gt;                               $pass = '{CRYPT}' . crypt($password);
&gt;                               break;
&gt;                       case 'clear':
&gt;                               $pass = $password;
&gt;                               break;
&gt;                       default:
&gt;                               $pwd_md5 =</span >
base64_encode(pack('H*',sha1($password)));
<span class="quote">&gt;                               $pass = &quot;{SHA}&quot;.$pwd_md5;
&gt;                               break;
&gt;               }</span >
&gt;

more hashing can be added but i will just leave it there.</pre>
    </div><div id="c112" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c112">Comment 112</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-23 00:11:24 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c111">comment #111</a>)
<span class="quote">&gt; It will be great if user can choose the way for hashing password in LDAP.
&gt; 
&gt; fyi, i'm trying to integrate mediawiki with my existing LDAP, SHA generated by
&gt; this plugin will break an existing application as it knows CRYPT only.
&gt; 
&gt; i added a new configuration, $wgLDAPPasswordHash to get this works, here is the
&gt; diff to 1.0e:
&gt; 
&gt; 232c232,233
&gt; &lt;
&gt; ---
&gt; &gt;               global $wgLDAPPasswordHash;
&gt; &gt;
&gt; 241,242c242,255
&gt; &lt;               $pwd_md5 = base64_encode(pack('H*',sha1($password)));
&gt; &lt;               $pass = &quot;{SHA}&quot;.$pwd_md5;
&gt; ---
&gt; &gt;
&gt; &gt;               switch ($wgLDAPPasswordHash) {
&gt; &gt;                       case 'crypt':
&gt; &gt;                               $pass = '{CRYPT}' . crypt($password);
&gt; &gt;                               break;
&gt; &gt;                       case 'clear':
&gt; &gt;                               $pass = $password;
&gt; &gt;                               break;
&gt; &gt;                       default:
&gt; &gt;                               $pwd_md5 =
&gt; base64_encode(pack('H*',sha1($password)));
&gt; &gt;                               $pass = &quot;{SHA}&quot;.$pwd_md5;
&gt; &gt;                               break;
&gt; &gt;               }
&gt; &gt;
&gt; 
&gt; more hashing can be added but i will just leave it there.</span >

I'm probably wrong, but... Don't all passwords have to be base64 encoded in LDAP?</pre>
    </div><div id="c113" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c113">Comment 113</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-23 00:12:21 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c111">comment #111</a>)
<span class="quote">&gt; It will be great if user can choose the way for hashing password in LDAP.
&gt; 
&gt; fyi, i'm trying to integrate mediawiki with my existing LDAP, SHA generated by
&gt; this plugin will break an existing application as it knows CRYPT only.
&gt; 
&gt; i added a new configuration, $wgLDAPPasswordHash to get this works, here is the
&gt; diff to 1.0e:
&gt; 
&gt; 232c232,233
&gt; &lt;
&gt; ---
&gt; &gt;               global $wgLDAPPasswordHash;
&gt; &gt;
&gt; 241,242c242,255
&gt; &lt;               $pwd_md5 = base64_encode(pack('H*',sha1($password)));
&gt; &lt;               $pass = &quot;{SHA}&quot;.$pwd_md5;
&gt; ---
&gt; &gt;
&gt; &gt;               switch ($wgLDAPPasswordHash) {
&gt; &gt;                       case 'crypt':
&gt; &gt;                               $pass = '{CRYPT}' . crypt($password);
&gt; &gt;                               break;
&gt; &gt;                       case 'clear':
&gt; &gt;                               $pass = $password;
&gt; &gt;                               break;
&gt; &gt;                       default:
&gt; &gt;                               $pwd_md5 =
&gt; base64_encode(pack('H*',sha1($password)));
&gt; &gt;                               $pass = &quot;{SHA}&quot;.$pwd_md5;
&gt; &gt;                               break;
&gt; &gt;               }
&gt; &gt;
&gt; 
&gt; more hashing can be added but i will just leave it there.</span >

I'm probably wrong, but... Don't all passwords have to be base64 encoded in
LDAP? I like the patch otherwise, and I'll include it in the next version of the
plugin.</pre>
    </div><div id="c114" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c114">Comment 114</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kevin Grinberg</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-05-10 20:56:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Something I noticed: in userExists, $wgLDAPBaseDN is defined (global) but never
used... which is good, because unless I'm mistaken, it should be $wgLDAPBaseDNs
(note the &quot;s&quot; at the end...)

Am I missing something, or is this a bug waiting to happen?</pre>
    </div><div id="c115" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c115">Comment 115</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-05-10 21:02:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c114">comment #114</a>)
<span class="quote">&gt; Something I noticed: in userExists, $wgLDAPBaseDN is defined (global) but never
&gt; used... which is good, because unless I'm mistaken, it should be $wgLDAPBaseDNs
&gt; (note the &quot;s&quot; at the end...)
&gt; 
&gt; Am I missing something, or is this a bug waiting to happen?</span >

This must be a variable left in from the pre 1.0 days. I *thought* I cleaned out
all of the unused globals, but it looks like I missed one. I'll check my
functions again and clean out unused variables for next release.</pre>
    </div><div id="c116" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c116">Comment 116</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-07-05 03:51:07 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=2050" name="attach_2050" title="Version 1.0f of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)">attachment 2050</a> <a href="attachment.cgi?id=2050&amp;action=edit" title="Version 1.0f of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)">[details]</a></span>
Version 1.0f of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)

This is a (mostly) bugfix version of the plugin.

Fixed the version number at the top of the file.
Fixed the preferences bug from: Talk:LDAP Authentication#Problem with
preferences from LDAP
Added function in for changing usernames to lowercase to fix:
Talk:LDAP_Authentication#Username_modified_.28capital_letter.29.2C_authentication_fails
(only works in versions 1.6+)
Added debugging code (let me know what extra debugging info you want, or if
some things should be showing at a different debug level)
Cleaned out unused global variables
Added the password switching statement from #111 in this bug (notice I added it
for changing passwords, and for creating users)
Fixed an undeclared global variable $wgLDAPWriteLocation in addUsers
Added the ability to use TLS as well as LDAPS (I'm not 100% sure this is
working, let me know!)

Updated documentation at the normal place will follow soon.</pre>
    </div><div id="c117" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c117">Comment 117</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-12 01:14:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=2218" name="attach_2218" title="Version 1.0g of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)">attachment 2218</a> <a href="attachment.cgi?id=2218&amp;action=edit" title="Version 1.0g of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)">[details]</a></span>
Version 1.0g of the LdapAuthentication.php Plugin (for Mediawiki 1.5-1.7)

This update offers a new group based authentication check and deprecates the
old included one. The new check allows for nested groups, and can search groups
either as a proxyagent, or as the user who is authenticating. Documentation to
follow soon on meta at the normal place.</pre>
    </div><div id="c118" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c118">Comment 118</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Buchan Milne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-16 16:35:03 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I had a problem with the current patch where the filter for checking group
memberships (in the attribute value is username case) was using the uppercased
username, which did not match.

I've hacked it at line 212 to have:


                        if ($wgLDAPRequiredGroups[$_SESSION['wsDomain']]) {
                                $ldapusername = $username;
                                $ldapusername[0] = strtolower($ldapusername[0]);
                                $this-&gt;printDebug(&quot;Checking for (new style)
group membership&quot;,1);

                                if ($wgLDAPGroupUseFullDN[$_SESSION['wsDomain']]) {
                                        $inGroup =
$this-&gt;isMemberOfRequiredLdapGroup($ldapconn, $userdn);
                                } else {
                                        $inGroup =
$this-&gt;isMemberOfRequiredLdapGroup($ldapconn, $ldapusername);
                                }</pre>
    </div><div id="c119" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c119">Comment 119</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Gunter Schmidt</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-22 11:39:09 UTC
        </span>
      </div>



<pre class="bz_comment_text" >We have a similiar case problem with the groups checking.

Using:

$wgLDAPRequiredGroups = array( &quot;REF-EDIR&quot;=&gt;array(&quot;cn=lht-wiki,ou=adg,ou=roles (pw),ou=LH,o=LH-DIR&quot;) );

will not find any groups, giving &quot;Couldn't find the user in any groups (2).&quot;

The LDAP Server returns the groups correctly, but in lower case ... ou=lh, o=lh-dir.

After changing the line to

$wgLDAPRequiredGroups = array( &quot;REF-EDIR&quot;=&gt;array(&quot;cn=lht-wiki,ou=adg,ou=roles (pw),ou=lh,o=lh-dir&quot;) );

all works out fine.

Thanks for implementing the proxy user so fast.</pre>
    </div><div id="c120" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c120">Comment 120</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-22 17:44:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c119">comment #119</a>)
<span class="quote">&gt; We have a similiar case problem with the groups checking.Using:$wgLDAPRequiredGroups = array( &quot;REF-EDIR&quot;=&gt;array</span >
(&quot;cn=lht-wiki,ou=adg,ou=roles (pw),ou=LH,o=LH-DIR&quot;) );will not find any groups, giving &quot;Couldn't find the user in any 
groups (2).&quot;The LDAP Server returns the groups correctly, but in lower case ... ou=lh, o=lh-dir.After changing the 
line to$wgLDAPRequiredGroups = array( &quot;REF-EDIR&quot;=&gt;array(&quot;cn=lht-wiki,ou=adg,ou=roles (pw),ou=lh,o=lh-dir&quot;) );all 
works out fine.Thanks for implementing the proxy user so fast.

This is done on purpose. I do a tolower on the returned groups in the function getGroups. LDAP is case insensitive, 
and PHP is not, it should be impossible to enter both cn=group and cn=Group, so to avoid weird matching problems, I 
make sure everything is lowercase.

I guess I should update my documentation to inform people of this right? ;)

In response to #118. I don't see where I'm matching anywhere for usernames; LDAP is case insensitive on this matter, 
so it shouldn't be an issue for the username to be cased. I'll look a little harder, but I won't make this change 
just yet.
</pre>
    </div><div id="c121" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c121">Comment 121</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Buchan Milne</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-23 07:11:19 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Right, I should have included a bit more information on my group setup, which is using the 
nis.schema/posixAccount/posixGroup-type stuff, so I have:

$wgLDAPRequiredGroups = array( &quot;mycontext&quot;=&gt;array(&quot;cn=build,ou=group,dc=mydomain,dc=com&quot;) );
$wgLDAPGroupUseFullDN = array( &quot;mycontext&quot;=&gt;false );
$wgLDAPGroupObjectclass = array( &quot;mycontext&quot;=&gt;&quot;posixGroup&quot; );
$wgLDAPGroupAttribute = array( &quot;mycontext&quot;=&gt;&quot;memberUid&quot; );
$wgLDAPGroupSearchNestedGroups = array( &quot;mycontext&quot;=&gt;false );

memberUid (according to nis.schema - and rfc2307bis seems to be the same) is:
attributetype ( 1.3.6.1.1.1.1.12 NAME 'memberUid'
        EQUALITY caseExactIA5Match
        SUBSTR caseExactIA5SubstringsMatch
        SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )

So, for the memberUid attribute, case does matter:

[bgmilne&#64;comanche ~]$ ldapsearch -LLL -x &quot;(memberUid=bgmilne)&quot; dn
dn: cn=sysadmins,ou=Group,dc=mydomain,dc=com

dn: cn=build,ou=Group,dc=mydomain,dc=com

[bgmilne&#64;comanche ~]$ ldapsearch -LLL -x &quot;(memberUid=Bgmilne)&quot; cn
[bgmilne&#64;comanche ~]$


&quot;LDAP is case insensitive&quot; is an invalid generalisation, some attributes, such as dn, are case insensitive, but this 
doesn't mean that all attributes are. Eg, the uid attribute is case insentitive, and usually the same string appears 
in the memebrUid attribute, but this attribute is case sensitive.

Since the group membership attribute is configurable, it could be case sensitive, so case should be preserved (at 
least in the $wgLDAPGroupUseFullDN=false case) when doing group membership checks. The question is which case to 
preserve (the one the user entered, or the result of a search), the result of the search would probably be best.

(I should probably consider migrating to rfc2307bis where member attribute is the dn, but ... a lot of people still 
use nis.schema).

I'll look at doing a better fix for this and supplying a patch.</pre>
    </div><div id="c122" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c122">Comment 122</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-23 14:50:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c121">comment #121</a>)
<span class="quote">&gt; &quot;LDAP is case insensitive&quot; is an invalid generalisation, some attributes, such</span >
as dn, are case insensitive, but this 
<span class="quote">&gt; doesn't mean that all attributes are. Eg, the uid attribute is case</span >
insentitive, and usually the same string appears 
<span class="quote">&gt; in the memebrUid attribute, but this attribute is case sensitive.
&gt; </span >

[snip]

<span class="quote">&gt; (I should probably consider migrating to rfc2307bis where member attribute is</span >
the dn, but ... a lot of people still 
<span class="quote">&gt; use nis.schema).
&gt; 
&gt; I'll look at doing a better fix for this and supplying a patch.</span >

Sorry about the generalization. I usually leave out the part about &quot;for specific
attributes&quot;. I thought I had taken into account for nis.schema, but it looks
like Sun's nis schema is different from openldap's nis schema, and I'm using Sun
Directory Server with the nis schema. (Thanks Sun for screwing me again, I
looked at the RFC and it DOES indeed say caseExactIA5Match).

No need to send in a patch. This fix only really has to do with groups, so I'll
add it into &quot;isMemberOfRequiredLdapGroup&quot;. </pre>
    </div><div id="c123" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c123">Comment 123</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Gunter Schmidt</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-23 16:38:17 UTC
        </span>
      </div>



<pre class="bz_comment_text" >moving to our production environment, I have a serious performance problem.

The group check takes about 4 Minutes. I included the debug listing, where I added a time stamp.

Search string: (&amp;(member=cn=X1234,ou=HAM,ou=LHT,ou=LH,o=LH-DIR)(objectclass=groupofnames))Wed, 23 Aug 2006 18:12:48
Binding as the proxyagentDN Wed, 23 Aug 2006 18:12:48 +0200
Binding finished Wed, 23 Aug 2006 18:12:48 +0200
Returned groups:cn=role-hamtisfa,ou=governor,ou=roles (pw),ou=lh,o=lh-dir,cn=wlan,ou=applications,ou=roles 
(pw),ou=lh,o=lh-dir, --- snip --- Wed, 23 Aug 2006 18:17:07 +0200
GroupCount = 14
Found user in a group. Wed, 23 Aug 2006 18:17:07 +0200

Has anybody noticed similar problems or is this a configuration problem of our LDAP-Server?


</pre>
    </div><div id="c124" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c124">Comment 124</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-08-23 18:29:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c123">comment #123</a>)
<span class="quote">&gt; moving to our production environment, I have a serious performance problem.The group check takes about 4 Minutes. I </span >
included the debug listing, where I added a time stamp.Search string: (&amp;(member=cn=X1234,ou=HAM,ou=LHT,ou=LH,o=LH-DIR)
(objectclass=groupofnames))Wed, 23 Aug 2006 18:12:48Binding as the proxyagentDN Wed, 23 Aug 2006 18:12:48 
+0200Binding finished Wed, 23 Aug 2006 18:12:48 +0200Returned groups:cn=role-hamtisfa,ou=governor,ou=roles 
(pw),ou=lh,o=lh-dir,cn=wlan,ou=applications,ou=roles (pw),ou=lh,o=lh-dir, --- snip --- Wed, 23 Aug 2006 18:17:07 
+0200GroupCount = 14Found user in a group. Wed, 23 Aug 2006 18:17:07 +0200Has anybody noticed similar problems or is 
this a configuration problem of our LDAP-Server?

Support requests should be added to the talk page of the meta article. I'll copy and paste it into there with my 
response. This is for bugs and patches only.
</pre>
    </div><div id="c125" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c125">Comment 125</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Douglas Pace</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-09-05 18:04:43 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c70">comment #70</a>)
<span class="quote">&gt; Created an attachment (id=1036) [edit]
&gt; Patch to 1.0.a for require attribute
&gt; 
&gt; This is a restructured version of the first patch submitted to add support for
&gt; requiring a user to have a certain attribute to finish authenticating to the
&gt; wiki. It now properly handles the case where no proxy user is allowed, nor is
&gt; an anonymous search allowed.</span >

First let me say I love this feature but I have a suggestion about it. I
currently have need to use the AuthAttribute to filter based on a protected
attribute in LDAP, specifically class enrollment. 

I have two options. One is a proxy user, which is highly frowned upon because of
security and clear text passwords in world readable files, etc. The second is to
only check the attribute after binding as the user, which seems to be a better
solution anyway. But currently the AuthAttribute is checked twice. Once in
getUserDN as either anonymous or as the proxy user(which is where this breaks in
this situation) and again after the user binds. I understand this first check
does save work on users who don't have the attribute, but it doesn't seem as
robust since the user themselves will almost always have more access than
anonymous and possibly even more than the proxy user?

--- LdapAuthentication-1.0g.php 2006-09-05 11:01:41.665817575 -0700
+++ LdapAuthentication.php      2006-09-05 10:59:04.722809051 -0700
&#64;&#64; -693,18 +693,8 &#64;&#64; class LdapAuthenticationPlugin extends A
                }

                //we need to do a subbase search for the entry
-
-               //Why waste a bind later, if a user is missing an auth attribute
-               //let's catch it here.
-               if ($wgLDAPRequireAuthAttribute) {
-                       $auth_filter = &quot;(&quot; .
$wgLDAPAuthAttribute[$_SESSION['wsDomain']] . &quot;)&quot;;
-                       $srch_filter = &quot;(&quot; .
$wgLDAPSearchAttributes[$_SESSION['wsDomain']] . &quot;=$username)&quot;;
-                       $filter = &quot;(&amp;&quot; . $srch_filter . $auth_filter . &quot;)&quot;;
-                       $this-&gt;printDebug(&quot;Created an auth attribute filter:
$filter&quot;,2);
-               } else {
-                       $filter = &quot;(&quot; .
$wgLDAPSearchAttributes[$_SESSION['wsDomain']] . &quot;=$username)&quot;;
-                       $this-&gt;printDebug(&quot;Created a regular filter: $filter&quot;,2);
-               }
+               $filter = &quot;(&quot; . $wgLDAPSearchAttributes[$_SESSION['wsDomain']] .
&quot;=$username)&quot;;
+               $this-&gt;printDebug(&quot;Created a regular filter: $filter&quot;,2);

                $attributes = array(&quot;dn&quot;);
                 $base = $wgLDAPBaseDNs[$_SESSION['wsDomain']];</pre>
    </div><div id="c126" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c126">Comment 126</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Thomas Clavier</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-10-08 20:41:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >in setPassword function, to not eraze password, we can change :
$pass = $this-&gt;getPasswordHash($pass);
by 
$pass = $this-&gt;getPasswordHash($password);</pre>
    </div><div id="c127" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c127">Comment 127</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-10-10 13:15:56 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c126">comment #126</a>)
<span class="quote">&gt; in setPassword function, to not eraze password, we can change :
&gt; $pass = $this-&gt;getPasswordHash($pass);
&gt; by 
&gt; $pass = $this-&gt;getPasswordHash($password);</span >


Wow, now *there* is a real for deal bug. I don't know how this ever worked (and
I know I tested it at one point). Good catch, this will be fixed next release.</pre>
    </div><div id="c128" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c128">Comment 128</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Hermann Gottschalk</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-10-27 09:18:19 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c122">comment #122</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=814#c121">comment #121</a>)
&gt; &gt; &quot;LDAP is case insensitive&quot; is an invalid generalisation, some attributes, such
&gt; as dn, are case insensitive, but this 
&gt; &gt; doesn't mean that all attributes are. Eg, the uid attribute is case
&gt; insentitive, and usually the same string appears 
&gt; &gt; in the memebrUid attribute, but this attribute is case sensitive.
&gt; &gt; 
&gt; 
&gt; [snip]
&gt; </span >

<span class="quote">&gt; No need to send in a patch. This fix only really has to do with groups, so I'll
&gt; add it into &quot;isMemberOfRequiredLdapGroup&quot;. </span >

When will this adjustment be made? Meanwhile i did a dirty hack, which only
works for our environment...</pre>
    </div><div id="c129" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c129">Comment 129</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-10-28 20:08:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c128">comment #128</a>)
<span class="quote">&gt; When will this adjustment be made? Meanwhile i did a dirty hack, which only
&gt; works for our environment...</span >

Sorry, I've been out of the country, and my laptop was broken, so I haven't had
much of a chance to work on this. Hopefully I'll have a new release soon. I'll
try to have one out in the next couple of weeks.</pre>
    </div><div id="c130" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c130">Comment 130</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Manuel Schneider</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-09 15:47:34 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Little problem:

The first login throws an error &quot;Fatal error: Call to a member function on a
non-object in /srv/www/htdocs/wiki/includes/SpecialUserlogin.php on line 320&quot;.

Later logins work without problems. Is there a possibility to get rid of this
error message?

Concerning versions:
- MediaWiki 1.6.8
- mod_php4
</pre>
    </div><div id="c131" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c131">Comment 131</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-09 15:55:50 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c130">comment #130</a>)
<span class="quote">&gt; Little problem:The first login throws an error &quot;Fatal error: Call to a member function on anon-object </span >
in /srv/www/htdocs/wiki/includes/SpecialUserlogin.php on line 320&quot;.Later logins work without problems. Is there a 
possibility to get rid of thiserror message?Concerning versions:- MediaWiki 1.6.8- mod_php4

I'm using the same setup and not having that problem. I also don't manage SpecialUserlogin.php, you'll need to put a 
new bug report in if you believe there is a bug in that class.

You may just have a configuration error. If you need support, please post your question on the discussion page for 
the plugin's documentation on meta.</pre>
    </div><div id="c132" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c132">Comment 132</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-13 22:54:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=2697" name="attach_2697" title="Version 1.0h of the LdapAuthentication.php Plugin (for Mediawiki 1.5+)">attachment 2697</a> <a href="attachment.cgi?id=2697&amp;action=edit" title="Version 1.0h of the LdapAuthentication.php Plugin (for Mediawiki 1.5+)">[details]</a></span>
Version 1.0h of the LdapAuthentication.php Plugin (for Mediawiki 1.5+)

This is a bugfix version of the plugin. The following fixes have been made:

# <a href="show_bug.cgi?id=814#c118">Comment #118</a> (lowercasing the username in the groups checking)
# <a href="show_bug.cgi?id=814#c125">Comment #125</a> (redundant auth attr check)
# <a href="show_bug.cgi?id=814#c126">Comment #126</a> (setPassword function erasing the user's password in LDAP)

In regards to the fix for <a href="show_bug.cgi?id=814#c125">comment #125</a>: This fix disabled the check, it did not
remove it. If you would like to re-enable it for performance reasons, just
uncomment the section that was commented.

In regards to the fix for <a href="show_bug.cgi?id=814#c118">comment #118</a>: The fix proposed may have caused issues
with other users who need case sensitive searches. I've added the fix as a
boolean option ($wgLDAPGroupLowerCaseUsername).</pre>
    </div><div id="c133" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c133">Comment 133</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Clemens Steinkogler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-16 10:08:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have problems with the group authentication, can anybody please help? My LDAP section looks like this:

&lt;code&gt;
 # LDAP
 require_once( 'LdapAuthentication.php' );
 $wgAuth = new LdapAuthenticationPlugin();
 $wgLDAPDomainNames = array(&quot;olymp&quot;);
 $wgLDAPServerNames = array(&quot;olymp&quot;=&gt;&quot;neptun.xxx.yyy.at&quot;);
 $wgLDAPSearchStrings = array(&quot;olymp&quot;=&gt;&quot;OLYMP\USER-NAME&quot;);
 $wgLDAPSearchAttributes = array(&quot;olymp&quot;=&gt;&quot;sAMAccountName&quot;);
 $wgLDAPUseSSL = false;
 $wgLDAPUseLocal = false;
 $wgMinimalPasswordLength = 1;
 $wgLDAPRetrievePrefs = false;
 
 # GROUP AUTHENICATION
 $wgLDAPRequiredGroups = array( &quot;olymp&quot;=&gt;array(&quot;cn=standby,ou=test,dc=neptun,dc=xxx,dc=yyy,dc=at&quot;) );
 $wgLDAPGroupUseFullDN = array( &quot;olymp&quot;=&gt;true );
 $wgLDAPGroupObjectclass = array( &quot;olymp&quot;=&gt;&quot;group&quot; );
 $wgLDAPGroupAttribute = array( &quot;olymp&quot;=&gt;&quot;member&quot; );
 $wgLDAPGroupSearchNestedGroups = array( &quot;olymp&quot;=&gt;false );
 $wgLDAPBaseDNs = array( &quot;olymp&quot;=&gt;&quot;dc=neptun,dc=xxx,dc=yyy,dc=at&quot; );
 
 $wgGroupPermissions['*']['createaccount'] = false;
 $wgGroupPermissions['*']['edit'] = false;
 $wgWhitelistRead = array(&quot;Hauptseite&quot;,&quot;Spezial:Userlogin&quot;, &quot;-&quot;,&quot;MediaWiki:Monobook.css&quot;);
 $wgGroupPermissions['*']['read'] = false;
 $wgShowIPinHeader = true;
&lt;/code&gt;

Our Windows 2000 Server &quot;neptun&quot; with active directory has an OU &quot;test&quot; with a group &quot;standby&quot;. I'm now member of the 
group &quot;standby&quot;. If I now want to log in to the wiki there appears following error:

&lt;b&gt;Warning&lt;/b&gt;:  ldap_get_entries(): supplied argument is not a valid ldap result resource in 
&lt;b&gt;/var/www/standby/includes/LdapAuthentication.php&lt;/b&gt; on line &lt;b&gt;857&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  array_shift() function.array-shift: The argument should be an array in 
&lt;b&gt;/var/www/standby/includes/LdapAuthentication.php&lt;/b&gt; on line &lt;b&gt;860&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  Invalid argument supplied for foreach() in &lt;b&gt;/var/www/standby/includes/LdapAuthentication.php&lt;/b&gt; 
on line &lt;b&gt;863&lt;/b&gt;&lt;br /&gt;
Password wrong: blabla

So what could be wrong here. I can imagine that it's something small but I'm trying now for days and can't find the 
error. Without groupauthenication it works. Hope that it is allowed to post this here. Thanks for any help.</pre>
    </div><div id="c134" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c134">Comment 134</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-16 14:40:37 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c133">comment #133</a>)
<span class="quote">&gt; I have problems with the group authentication, can anybody please help? My</span >
LDAP section looks like this:

[snip]

I don't know how many times I (and others) have to write this here, but this
bugzilla page is *NOT* a support forum, it is for bugs and release information
only!!

There are at least a couple places you can ask this question. One is on the
discussion page of the LDAP Authentication article on meta, the other is on the
Mediawiki Enterprise list:

<a href="http://mail.wikimedia.org/mailman/listinfo/mediawiki-enterprise">http://mail.wikimedia.org/mailman/listinfo/mediawiki-enterprise</a>

I've even been occasionally known to answer questions on the mediawiki-l list as
well (although I don't like to bug everyone else there with LDAP support issues).

I'll give support on one of those places, but not here. When you post your
question in the correct place, make sure you give debug information as well
using $wgLDAPDebug = 4, making sure to snip out any sensitive information. Also
include the version of mediawiki, and the version of the plugin you are using.
</pre>
    </div><div id="c135" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c135">Comment 135</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alfons Zitterbacke</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-29 15:47:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hi,

this is patch agains 1.0e (LdapPlugin from April 2006).
It adds ldap group support to mediawiki, where a ldap group overrides any
membership setting of a local group.
this is useful for example for restricted namespaces.

sincerly,
mbraun

*** LdapAuthentication.php.bck	Wed Nov 29 12:49:38 2006
--- LdapAuthentication.php	Wed Nov 29 16:25:04 2006
***************
*** 44,50 ****
  require_once( 'AuthPlugin.php' );
  
  class LdapAuthenticationPlugin extends AuthPlugin {
! 	var $email, $lang, $realname, $nickname, $SearchType;
  	/**
  	 * Check whether there exists a user account with the given name.
  	 * The name will be normalized to MediaWiki's requirements, so
--- 44,50 ----
  require_once( 'AuthPlugin.php' );
  
  class LdapAuthenticationPlugin extends AuthPlugin {
! 	var $email, $lang, $realname, $nickname, $SearchType, $groups, $allLdapGroups;
  	/**
  	 * Check whether there exists a user account with the given name.
  	 * The name will be normalized to MediaWiki's requirements, so
***************
*** 155,161 ****
--- 155,165 ----
  		global $wgLDAPProxyAgent;
  		global $wgLDAPGroupDN;
  		global $wgLDAPRequireAuthAttribute, $wgLDAPAuthAttribute;
+ 		global $wgLDAPGrpBase;
  		
+ 		$this-&gt;groups=Array();
+ 		$this-&gt;allLdapGroups=Array();
+ 
  		if ( '' == $password ) {
  			return false;
  		}
***************
*** 183,189 ****
  				if ($info[&quot;count&quot;] &lt; 1) { return false; }
                          }
  			if ($wgLDAPGroupDN) {
! 				return $this-&gt;isMemberOfLdapGroup($ldapconn, $userdn, $wgLDAPGroupDN);
  			}
  			if ($wgLDAPRetrievePrefs) {
  				$entry = &#64;ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
--- 187,194 ----
  				if ($info[&quot;count&quot;] &lt; 1) { return false; }
                          }
  			if ($wgLDAPGroupDN) {
! 				if (! $this-&gt;isMemberOfLdapGroup($ldapconn, $userdn, $wgLDAPGroupDN))
! 					return false;
  			}
  			if ($wgLDAPRetrievePrefs) {
  				$entry = &#64;ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
***************
*** 193,198 ****
--- 198,225 ----
  				$this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
  				$this-&gt;realname = $info[0][&quot;cn&quot;][0];
  			}
+ 
+ 			// get groups
+ 		        $grpRes = ldap_search($ldapconn,
$wgLDAPGrpBase[$_SESSION[wsDomain]],
&quot;memberUid=&quot;.strtolower($username).&quot;&quot;,Array(&quot;cn&quot;));
+ 			for ($entryID=ldap_first_entry($ldapconn,$grpRes);
+ 			      $entryID!=false;
+ 		              $entryID=ldap_next_entry($ldapconn,$entryID))
+ 			      {
+ 			      $cGroup = ldap_get_values($ldapconn,$entryID,'cn');
+ 			      $cGroup=$cGroup[0];
+ 			      $this-&gt;groups[] = $cGroup;
+ 			      }
+ 
+ 			$grpRes = ldap_search($ldapconn, $wgLDAPGrpBase[$_SESSION[wsDomain]],
&quot;objectClass=posixGroup&quot;,Array(&quot;cn&quot;));
+ 			for ($entryID=ldap_first_entry($ldapconn,$grpRes);
+ 				$entryID!=false;
+ 				$entryID=ldap_next_entry($ldapconn,$entryID))
+ 				{
+ 				$cGroup = ldap_get_values($ldapconn,$entryID,'cn');
+ 				$cGroup=$cGroup[0];
+ 				$this-&gt;allLdapGroups[] = $cGroup;
+ 				}
+ 
  			// Lets clean up.
  			&#64;ldap_unbind();
                  } else {
***************
*** 450,457 ****
--- 477,512 ----
  		if ('' != $this-&gt;email) {
                  	$user-&gt;setEmail($this-&gt;email);
  		}
+ 		# add groups permissions
+ 		$localAvailGrps = $user-&gt;getAllGroups();
+ 		$localUserGrps = $user-&gt;getEffectiveGroups();
+ 		# note: $localUserGrps does not need to be updated with $cGroup added,
+ 		#       as $localAvailGrps contains $cGroup only once.
+ 		foreach ($localAvailGrps as $cGroup) {
+ 			# did we once add the user to the group?
+ 			if (in_array($cGroup,$localUserGrps)) { 
+ 			   if ((!$this-&gt;hasLDAPGroup($cGroup)) &amp;&amp; ($this-&gt;isLDAPGroup($cGroup))) {
+ 			      # die LDAP Gruppe überschreibt die lokale Gruppe
+ 			      # d.h. wenn sie existiert, und der user nicht enthlaten ist, dann
muss er auch aus der wiki grp raus
+ 			      $user-&gt;delGroup($cGroup);
+ 			      }
+ 			} else { # no, but maybe the user has just been added to the group
+ 				if ($this-&gt;hasLDAPGroup($cGroup)) {
+ 					# so use the addGroup function
+ 					$user-&gt;addGroup($cGroup);
+ 					# completedfor $cGroup.
+ 				}
+ 			}
+ 		}
          }
  
+ 	function hasLDAPGroup($group) {
+ 		return in_array($group, $this-&gt;groups);
+ 	}
+ 
+ 	function isLDAPGroup($group) {
+ 		return in_array($group, $this-&gt;allLdapGroups);
+ 	}
  	/**
  	 * Return true to prevent logins that don't authenticate here from being
  	 * checked against the local database's password fields.
***************
*** 553,559 ****
  			}
  		}
  		//we need to do a subbase search for the entry
! 		$filter = &quot;(member=&quot;.$userDN.&quot;)&quot;;
  		$info=ldap_get_entries($ldapconn,&#64;ldap_search($ldapconn, $groupDN, $filter));
  		return ($info[&quot;count&quot;]&gt;=1);
  	}
--- 608,614 ----
  			}
  		}
  		//we need to do a subbase search for the entry
! 		$filter = &quot;(memberUid=&quot;.$userDN.&quot;)&quot;;
  		$info=ldap_get_entries($ldapconn,&#64;ldap_search($ldapconn, $groupDN, $filter));
  		return ($info[&quot;count&quot;]&gt;=1);
  	}
</pre>
    </div><div id="c136" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c136">Comment 136</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alfons Zitterbacke</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-29 15:50:09 UTC
        </span>
      </div>



<pre class="bz_comment_text" >My last patch introduces a new configuration option: $wgLDAPGrpBase : Array
(Domain =&gt; Ldap search base for groups).
The names posixGroup, memberUid, cn are currently fixed in code.</pre>
    </div><div id="c137" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c137">Comment 137</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-29 16:00:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c135">comment #135</a>)
<span class="quote">&gt; Hi,
&gt; 
&gt; this is patch agains 1.0e (LdapPlugin from April 2006).
&gt; It adds ldap group support to mediawiki, where a ldap group overrides any
&gt; membership setting of a local group.
&gt; this is useful for example for restricted namespaces.
&gt; 
&gt; sincerly,
&gt; mbraun</span >

Great work! I'm glad you've sent me a patch for this, because this was pretty
low on my hit-list. I'll take a look at the patch and rework it to be a little
more generic. I'll probably add some debugging info, and might change some of
the options to conform to the other options.

Is there any way you can translate the comments? I can't read german (that is
german right?).

I'm about to release a pretty big update to the plugin to add smartcard support,
so it may take me a while to integrate this (especially since this is a patch
against 1.0e...).

V/r,

Ryan Lane</pre>
    </div><div id="c138" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c138">Comment 138</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alfons Zitterbacke</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-30 07:52:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Hi,

okay, here is the patch with the english-only comments.
There are two comments added and the delGroup-function is actually named
removeGroup (bug fix).

sincerly,
 mbraun

*** LdapAuthentication.php.bck	Wed Nov 29 12:49:38 2006
--- LdapAuthentication.php	Thu Nov 30 08:47:58 2006
***************
*** 44,50 ****
  require_once( 'AuthPlugin.php' );
  
  class LdapAuthenticationPlugin extends AuthPlugin {
! 	var $email, $lang, $realname, $nickname, $SearchType;
  	/**
  	 * Check whether there exists a user account with the given name.
  	 * The name will be normalized to MediaWiki's requirements, so
--- 44,50 ----
  require_once( 'AuthPlugin.php' );
  
  class LdapAuthenticationPlugin extends AuthPlugin {
! 	var $email, $lang, $realname, $nickname, $SearchType, $groups, $allLdapGroups;
  	/**
  	 * Check whether there exists a user account with the given name.
  	 * The name will be normalized to MediaWiki's requirements, so
***************
*** 155,161 ****
--- 155,165 ----
  		global $wgLDAPProxyAgent;
  		global $wgLDAPGroupDN;
  		global $wgLDAPRequireAuthAttribute, $wgLDAPAuthAttribute;
+ 		global $wgLDAPGrpBase;
  		
+ 		$this-&gt;groups=Array();
+ 		$this-&gt;allLdapGroups=Array();
+ 
  		if ( '' == $password ) {
  			return false;
  		}
***************
*** 183,189 ****
  				if ($info[&quot;count&quot;] &lt; 1) { return false; }
                          }
  			if ($wgLDAPGroupDN) {
! 				return $this-&gt;isMemberOfLdapGroup($ldapconn, $userdn, $wgLDAPGroupDN);
  			}
  			if ($wgLDAPRetrievePrefs) {
  				$entry = &#64;ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
--- 187,194 ----
  				if ($info[&quot;count&quot;] &lt; 1) { return false; }
                          }
  			if ($wgLDAPGroupDN) {
! 				if (! $this-&gt;isMemberOfLdapGroup($ldapconn, $userdn, $wgLDAPGroupDN))
! 					return false;
  			}
  			if ($wgLDAPRetrievePrefs) {
  				$entry = &#64;ldap_read($ldapconn, $userdn, &quot;objectclass=*&quot;);
***************
*** 193,198 ****
--- 198,225 ----
  				$this-&gt;nickname = $info[0][&quot;displayname&quot;][0];
  				$this-&gt;realname = $info[0][&quot;cn&quot;][0];
  			}
+ 
+ 			// get information on ldap groups and this user group memberships
+ 		        $grpRes = ldap_search($ldapconn,
$wgLDAPGrpBase[$_SESSION[wsDomain]],
&quot;memberUid=&quot;.strtolower($username).&quot;&quot;,Array(&quot;cn&quot;));
+ 			for ($entryID=ldap_first_entry($ldapconn,$grpRes);
+ 			      $entryID!=false;
+ 		              $entryID=ldap_next_entry($ldapconn,$entryID))
+ 			      {
+ 			      $cGroup = ldap_get_values($ldapconn,$entryID,'cn');
+ 			      $cGroup=$cGroup[0];
+ 			      $this-&gt;groups[] = $cGroup;
+ 			      }
+ 
+ 			$grpRes = ldap_search($ldapconn, $wgLDAPGrpBase[$_SESSION[wsDomain]],
&quot;objectClass=posixGroup&quot;,Array(&quot;cn&quot;));
+ 			for ($entryID=ldap_first_entry($ldapconn,$grpRes);
+ 				$entryID!=false;
+ 				$entryID=ldap_next_entry($ldapconn,$entryID))
+ 				{
+ 				$cGroup = ldap_get_values($ldapconn,$entryID,'cn');
+ 				$cGroup=$cGroup[0];
+ 				$this-&gt;allLdapGroups[] = $cGroup;
+ 				}
+ 
  			// Lets clean up.
  			&#64;ldap_unbind();
                  } else {
***************
*** 450,458 ****
--- 477,521 ----
  		if ('' != $this-&gt;email) {
                  	$user-&gt;setEmail($this-&gt;email);
  		}
+ 		# add groups permissions
+ 		$localAvailGrps = $user-&gt;getAllGroups();
+ 		$localUserGrps = $user-&gt;getEffectiveGroups();
+ 		# note: $localUserGrps does not need to be updated with $cGroup added,
+ 		#       as $localAvailGrps contains $cGroup only once.
+ 		foreach ($localAvailGrps as $cGroup) {
+ 			# did we once add the user to the group?
+ 			if (in_array($cGroup,$localUserGrps)) { 
+ 			   if ((!$this-&gt;hasLDAPGroup($cGroup)) &amp;&amp; ($this-&gt;isLDAPGroup($cGroup))) {
+ 			      # the ldap group overrides the local group
+ 			      # so as the user is currently not a member of the ldap group, he
shall be removed from the local group
+ 			      $user-&gt;removeGroup($cGroup);
+ 			      }
+ 			} else { # no, but maybe the user has recently been added to the ldap group?
+ 				if ($this-&gt;hasLDAPGroup($cGroup)) {
+ 					# so use the addGroup function
+ 					$user-&gt;addGroup($cGroup);
+ 					# completedfor $cGroup.
+ 				}
+ 			}
+ 		}
          }
  
  	/**
+ 	 * returns true if the last authenticated user is member of this group, else
false
+ 	 * will always return false if the last user did not authenticate
successfully with ldap
+ 	 */
+ 	function hasLDAPGroup($group) {
+ 		return in_array($group, $this-&gt;groups);
+ 	}
+ 
+ 	/**
+ 	 * returns true if a ldap group with this name exists, else false
+ 	 * will always return false if the last user did not authenticate
successfully with ldap
+ 	 */
+ 	function isLDAPGroup($group) {
+ 		return in_array($group, $this-&gt;allLdapGroups);
+ 	}
+ 	/**
  	 * Return true to prevent logins that don't authenticate here from being
  	 * checked against the local database's password fields.
  	 *
***************
*** 553,559 ****
  			}
  		}
  		//we need to do a subbase search for the entry
! 		$filter = &quot;(member=&quot;.$userDN.&quot;)&quot;;
  		$info=ldap_get_entries($ldapconn,&#64;ldap_search($ldapconn, $groupDN, $filter));
  		return ($info[&quot;count&quot;]&gt;=1);
  	}
--- 616,622 ----
  			}
  		}
  		//we need to do a subbase search for the entry
! 		$filter = &quot;(memberUid=&quot;.$userDN.&quot;)&quot;;
  		$info=ldap_get_entries($ldapconn,&#64;ldap_search($ldapconn, $groupDN, $filter));
  		return ($info[&quot;count&quot;]&gt;=1);
  	}
</pre>
    </div><div id="c139" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c139">Comment 139</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alfons Zitterbacke</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-11-30 07:55:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=2798" name="attach_2798" title="Ldap Group Support against 1.0e">attachment 2798</a> <a href="attachment.cgi?id=2798&amp;action=edit" title="Ldap Group Support against 1.0e">[details]</a></span>
Ldap Group Support against 1.0e

as described yesterday.</pre>
    </div><div id="c140" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c140">Comment 140</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-04 13:21:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Someone have any experiences with Apache 2.2 and the LDAP Patch ?
We have a System where the Patch works fine, but on a new System with the Apache 2.2 nothing works.</pre>
    </div><div id="c141" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c141">Comment 141</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-04 14:18:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c140">comment #140</a>)
<span class="quote">&gt; Someone have any experiences with Apache 2.2 and the LDAP Patch ?
&gt; We have a System where the Patch works fine, but on a new System with the</span >
Apache 2.2 nothing works.

I haven't tried the plugin with Apache 2.2; however, I have no clue why the
plugin wouldn't work with it. The plugin doesn't use anything Apache specific.
Make a section on the discussion page on meta and we'll investigate this further
(you didn't exactly give me much to work with). Since this is only for bugs and
release notices, I'll post the bug/bugfix here whenever we figure out what it is.</pre>
    </div><div id="c142" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c142">Comment 142</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-04 19:15:20 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=2823" name="attach_2823" title="Version 1.1a of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">attachment 2823</a> <a href="attachment.cgi?id=2823&amp;action=edit" title="Version 1.1a of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">[details]</a></span>
Version 1.1a of the LdapAuthentication.php plugin (for Mediawiki 1.6+)

This is a major version update of the plugin. A number of options have changed
syntax, and a new form of authentication, using autoauthenticate, has been
added. Updated documentation should follow shortly; you may not want to use
this version until the documentation is available. The following has changed
with this version:

# Fixed bug in getGroups, searchNestedGroups, and isMemberOfRequiredLdapGroup
where warnings are thrown if no groups are found. This was a symptom of a
problem in <a href="show_bug.cgi?id=814#c133">Comment #133</a> (this would not fix that issue however).
# Fixed bug with pulled preferences not being saved in the local database.
# Options have changed to work for multiple domains. All options that make
sense with multi-domain support can be configured to work for multiple domains.

# Smartcard/CAC support has been added to the plugin using the AutoAuthenticate
hook.
#* Most options supported by password authentication are supported in smartcard
authentication
#* Only a single smartcard domain can be used due to the way AutoAuthenticate
works; however, smartcard authentication and password authentication can be
mixed allowing multiple domains through the use of clever hackery
#* Smartcard authentication does not have to be turned on for the entire
server, but can instead be turned on for certain locations, or even specific
wiki pages

Smartcard authentication requires the getCanonicalName() function which is only
available in MediaWiki 1.6+. Do not use this version of the plugin for
mediawiki 1.5 as it has not been tested and will not be supported; instead,
please use version 1.0h.</pre>
    </div><div id="c143" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c143">Comment 143</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Kirschenbaum</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-06 14:36:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I receive this error the first time someone logs into the wiki.   After a
refresh it is fine. 

Fatal error: Call to a member function on a non-object in
c:\inetpub\wwwroot\wiki\includes\SpecialUserlogin.php on line 321

Which points to SpecialUserlogin.php

line 321--&gt;		if (!$u-&gt;checkPassword( $this-&gt;mPassword )) {
			$this-&gt;mainLoginForm( wfMsg( $this-&gt;mPassword == '' ? 'wrongpasswordempty' :
'wrongpassword' ) );
			return;
		}

Does anyone know a solution?

</pre>
    </div><div id="c144" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c144">Comment 144</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-06 14:44:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c143">comment #143</a>)
<span class="quote">&gt; I receive this error the first time someone logs into the wiki.   After a
&gt; refresh it is fine. </span >

1: Don't change ANY of the information associated with this plugin in the
bugzilla, ever; you don't manage this plugin
2: This bugzilla page is for the LDAP plugin, not SpecialUserlogin
3: You didn't provide any information about your environment (like versions of
stuff)
4: This isn't a support forum; if you can't be bothered to pay attention to the
other comments that chastise people for asking support questions here, why
should I be bothered to pay attention to your problem?

You should probably post this to the mediawiki-l email list, taking into account
#3 in the above list. Unless you have a specific bug with the LdapAuthentication
plugin, don't post here.</pre>
    </div><div id="c145" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c145">Comment 145</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-06 22:14:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=2830" name="attach_2830" title="Version 1.1b of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">attachment 2830</a> <a href="attachment.cgi?id=2830&amp;action=edit" title="Version 1.1b of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">[details]</a></span>
Version 1.1b of the LdapAuthentication.php plugin (for Mediawiki 1.6+)

This is a bugfix update of the LdapAuthentication plugin.

There was an issue with user's preferences being overwritten when
$wgLDAPRetrievePrefs was not set, or was set to false. The issue should only
have affected 1.1a; 1.0h should not be affected.</pre>
    </div><div id="c146" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c146">Comment 146</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alastair Hole</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-13 19:21:17 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=2857" name="attach_2857" title="Patch to 1.1b including hacks to support NTLM">attachment 2857</a> <a href="attachment.cgi?id=2857&amp;action=edit" title="Patch to 1.1b including hacks to support NTLM">[details]</a></span>
Patch to 1.1b including hacks to support NTLM</pre>
    </div><div id="c147" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c147">Comment 147</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alastair Hole</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-13 19:23:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Comment on <span class=""><a href="attachment.cgi?id=2857" name="attach_2857" title="Patch to 1.1b including hacks to support NTLM">attachment 2857</a> <a href="attachment.cgi?id=2857&amp;action=edit" title="Patch to 1.1b including hacks to support NTLM">[details]</a></span>
Patch to 1.1b including hacks to support NTLM

For Ryan's perusal, with a view to possibly include NTLM support</pre>
    </div><div id="c148" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c148">Comment 148</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-12-22 21:49:55 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=2924" name="attach_2924" title="Version 1.1c of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">attachment 2924</a> <a href="attachment.cgi?id=2924&amp;action=edit" title="Version 1.1c of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">[details]</a></span>
Version 1.1c of the LdapAuthentication.php plugin (for Mediawiki 1.6+)

This is a bugfix and update version of the plugin (and an early christmas
present to all the enterprises out there). The following has been
changed/added:

* Added support for Mediawiki security groups based upon LDAP groups
* Added an option to disable auto-creation of accounts
($wgLDAPDisableAutoCreate)
* Fixed TLS/SSL issue discussed in the Suggestions section on the Meta page
** Removed options $wgLDAPUseSSL and $wgLDAPUseTLS; added option
$wgLDAPEncryptionType (a string) with allowed values &quot;ssl&quot;, &quot;tls&quot;, and &quot;clear&quot;
* Moved $wgLDAPLowerCaseUsername a little higher up in the authentication chain

* Added $wgLDAPGroupUseRetrievedUsername so that you can use the exact username
pulled from LDAP to search for groups
* Changed $wgLDAPUseSmartcardAuth to $wgLDAPAutoAuthMethod (a string); this
will allow users to define which type of auto authenticate methods they would
like to use. Smartcard auth will only be available at first, but other methods
will follow.
* Changed $wgLDAPGroupLowerCaseUsername to allow for multiple domains
* Moved authenticate part of smartcard login out of getCanonicalName to the
SSLAuth function (I have no clue what I was thinking before ;) )

Updated documentation to follow at the usual spot. It may be a good idea to
wait until the documentation is updated before using this version. Hopefully
I'll have the documentation updated today.</pre>
    </div><div id="c149" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c149">Comment 149</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Antoine Musso</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-10 10:55:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ryan, can't you get subversion access to commit that in the extension
directory at <a href="http://svn.wikimedia.org/viewvc/mediawiki/trunk/extensions/">http://svn.wikimedia.org/viewvc/mediawiki/trunk/extensions/</a>

That might be easier to get than using a bug report ?</pre>
    </div><div id="c150" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c150">Comment 150</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Hermann Gottschalk</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-11 16:22:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c129">comment #129</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=814#c128">comment #128</a>)
&gt; &gt; When will this adjustment be made? Meanwhile i did a dirty hack, which only
&gt; &gt; works for our environment...
&gt; 
&gt; Sorry, I've been out of the country, and my laptop was broken, so I haven't had
&gt; much of a chance to work on this. Hopefully I'll have a new release soon. I'll
&gt; try to have one out in the next couple of weeks.</span >


What's about this?</pre>
    </div><div id="c151" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c151">Comment 151</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-11 18:45:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c150">comment #150</a>)
<span class="quote">&gt; What's about this?</span >

Huh? If you are asking whether or not this was added... yes it was. Otherwise I
don't know what you mean.</pre>
    </div><div id="c152" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c152">Comment 152</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-11 19:28:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c149">comment #149</a>)
<span class="quote">&gt; Ryan, can't you get subversion access to commit that in the extension
&gt; directory at <a href="http://svn.wikimedia.org/viewvc/mediawiki/trunk/extensions/">http://svn.wikimedia.org/viewvc/mediawiki/trunk/extensions/</a>
&gt; 
&gt; That might be easier to get than using a bug report ?</span >

*shrug*

This has been a pretty easy way to do it so far. I use a subversion server
locally and send ready updates here. This also notified interested parties when
a new version is ready. If the developers would rather me use svn, and close
this ticket, I'm fine with that too. For the time being I'll keep the process
the same as to not confuse people who are used to coming here.</pre>
    </div><div id="c153" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c153">Comment 153</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Russ Lavoie</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-23 19:32:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I am having a problem getting mediawiki 1.9.0 working with this plugin.  I
downloaded the above that Ryan posted and added the below to the
Localsettings.php file:

require_once( 'LdapAuthentication.php' );
$wgAuth = new LdapAuthenticationPlugin();

$wgLDAPDomainNames = array(&quot;domain&quot;);
$wgLDAPServerNames = array(
        &quot;domain&quot;=&gt;&quot;server.domain.com&quot;,&quot;server.domain.com&quot;);
$wgLDAPUseLocal = false;


# LDAP BIND info

$wgLDAPProxyAgent = array(
        &quot;domain&quot;=&gt;&quot;cn=ldapquery,cn=Users,dc=domain,dc=com&quot;);
$wgLDAPProxyAgentPassword = array(
        &quot;domain&quot;=&gt;&quot;passwordgoeshere&quot;);

# LDAP Login Restrictions

$wgLDAPRequiredGroups = array(
        &quot;domain&quot;=&gt;array(&quot;cn=wikigroup,ou=Groups,dc=domain,dc=com&quot;));

$wgLDAPGroupSearchNestedGroups = array(
        &quot;domain&quot;=&gt;true);


I see traffic but no errors on the Windows server... 

Can I get some assistance?</pre>
    </div><div id="c154" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c154">Comment 154</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris Porter</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-23 20:08:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >add $wfLDAPDebug = 3 to your LocalSettings.php file. I suspect it is complaining
about not being able to update user preferences. The way it is designed it wants
to update user preferences and write into the LDAP database. If you create a
&quot;local&quot; user account with the same name and password (to be secure) it should work.</pre>
    </div><div id="c155" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c155">Comment 155</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-01-23 23:15:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c154">comment #154</a>)
<span class="quote">&gt; add $wfLDAPDebug = 3 to your LocalSettings.php file. I suspect it is complaining
&gt; about not being able to update user preferences. The way it is designed it wants
&gt; to update user preferences and write into the LDAP database. If you create a
&gt; &quot;local&quot; user account with the same name and password (to be secure) it should</span >
work.

*Sigh*. Maybe I *should* shut this bug page down and switch to svn... This isn't
the support page...

There is an outstanding bug with MediaWiki 1.9. The SpecialUserlogin.php and
User.php changes with regards to passwords conflict with authentication plugins.

Authentication plugins should return false if users aren't allowed to change
passwords, but the change password function in the plugin shouldn't be called
when users aren't allowed to change passwords. This isn't the case currently. I
need to file a bug report, but without being able to test 1.9 right now I can't
test a fix.

For the time being, please use the following workaround:

<a href="http://meta.wikimedia.org/wiki/Talk:LDAP_Authentication#Authentication_against_AD_does_not_work_using_1.9">http://meta.wikimedia.org/wiki/Talk:LDAP_Authentication#Authentication_against_AD_does_not_work_using_1.9</a>

Notice there is another bug that needs a workaround applied as well:

<a href="http://meta.wikimedia.org/wiki/Talk:LDAP_Authentication#User_creation_errors.2C_user_still_created">http://meta.wikimedia.org/wiki/Talk:LDAP_Authentication#User_creation_errors.2C_user_still_created</a>

I plan on fixing the latter soon.</pre>
    </div><div id="c156" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c156">Comment 156</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-02-02 22:06:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=3173" name="attach_3173" title="Version 1.1d of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">attachment 3173</a> <a href="attachment.cgi?id=3173&amp;action=edit" title="Version 1.1d of the LdapAuthentication.php plugin (for Mediawiki 1.6+)">[details]</a></span>
Version 1.1d of the LdapAuthentication.php plugin (for Mediawiki 1.6+)

This is a bugfix version of the plugin. The following has changed:

* Get the user's DN if straight binds are used with AD style binds
(DOMAIN\\USER-NAME, USER-NAME&#64;DOMAIN) to allow for group checking, group
pulling, retrieving preferences, etc. 
* Fix the problem with group based restrictions causing failures even when they
aren't being used.
* Allow $wgLDAPRequiredGroups to have uppercase letters, and automatically
convert to lowercase for comparison to search results. 
* Fix part of the compability issues with MediaWiki 1.9 
* Fix Talk:LDAP_Authentication#Bug_in_hasLDAPGroup.28.29_and_isLDAPGroup.28.29 


If you want the plugin to pull the userdn when using AD style straight binds,
you'll need to set $wgLDAPBaseDNs, and $wgLDAPSearchAttributes for the domain.</pre>
    </div><div id="c157" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c157">Comment 157</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Walter Padron</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-02-12 17:32:15 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ryan, on Windows Server 2003 SP1, IIS 6, mediawiki 1.10, PHP 5.2.0,
LDAPAuthentication 1.1d

Problem: The getAllGroups function is not returning empty AD groups resulting in
incorrect user access permissions.

IMHO, must work this way, if a user has a wikimedia effective group 'nsGroup'
and the AD group 'nsGroup' has no members, the nsGroup must be removed from
user's effective groups because the user don't belongs to the AD group.

* As a workaround i make a sysop a member of all AD groups used for sync.</pre>
    </div><div id="c158" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c158">Comment 158</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Garen</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-02-19 23:42:21 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Using MediaWiki 1.9.x, LdapAuthentication.php version 1.1d, and the the patch
listed here:

<a href="http://bugzilla.wikipedia.org/show_bug.cgi?id=8815">http://bugzilla.wikipedia.org/show_bug.cgi?id=8815</a>

I can now successfully login against LDAP/AD!  I do however see these two
warnings after login:

Notice: Undefined variable: updateLDAP in
/var/www/swtools/mediawiki-1.9.0/extensions/LdapAuthentication.php on line 596
Notice: Undefined variable: mailPassword in
/var/www/swtools/mediawiki-1.9.0/extensions/LdapAuthentication.php on line 596

It looks like those two variables aren't defined.  If I add a simple &quot;global
$updateLDAP, $mailPassword;&quot; at the top of the function, the warnings go away.</pre>
    </div><div id="c159" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c159">Comment 159</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-02-21 15:40:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c158">comment #158</a>)
<span class="quote">&gt; Using MediaWiki 1.9.x, LdapAuthentication.php version 1.1d, and the the patchlisted </span >
here:<a href="http://bugzilla.wikipedia.org/show_bug.cgi?id=8815I">http://bugzilla.wikipedia.org/show_bug.cgi?id=8815I</a> can now successfully login against LDAP/AD! I do however see 
these twowarnings after login:Notice: Undefined variable: updateLDAP in/var/www/swtools/mediawiki-
1.9.0/extensions/LdapAuthentication.php on line 596Notice: Undefined variable: mailPassword 
in/var/www/swtools/mediawiki-1.9.0/extensions/LdapAuthentication.php on line 596It looks like those two variables 
aren't defined. If I add a simple &quot;global$updateLDAP, $mailPassword;&quot; at the top of the function, the warnings go 
away.

Ah. Yeah, I see that. Neither of the variables are ever getting initialized. The fix is to add:

                $updateLDAP = false;
                $mailPassword = false;

before the if statements, so that the defaults get set (and the variables get initialized). This will be fixed next 
release.</pre>
    </div><div id="c160" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c160">Comment 160</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Christian Neubauer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-02-23 16:42:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ryan,

I'm using your extension with our PKI infrastructure (via the smartcard code)
and everything works fine.  But for MediaWiki 1.9.1, I had to modify the
function SSLAuth() to make a new user before User::LoadFromSession is called
since this function is not ... whats the term... a static function?  It makes
references to $this now.  So anyway, I changed SSLAuth() to make an anonymous
user $tmpuser = new User(); and then called $tmpuser-&gt;LoadFromSession() in the
if statement below where $tmpuser-&gt;isLoggedIn() was being called
(LoadFromSession returns true if the user is logged in.)</pre>
    </div><div id="c161" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c161">Comment 161</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason Adolf</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-02-26 04:49:19 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ryan,

I left you a PM on mwusers.com.  Here is the problem we are experiencing with the current plugin.

<a href="http://www.mwusers.com/forums/showthread.php?t=2812">http://www.mwusers.com/forums/showthread.php?t=2812</a>

many thanks,

jA</pre>
    </div><div id="c162" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c162">Comment 162</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Christian Neubauer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-03-02 14:06:53 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Another bug with 1.9.1 and 1.1d using PKI authentication (smartcard auth).  When
a user attempts to log in and exists in the LDAP but not in the local database,
I get an infinite unstub loop (see the header of includes/StubObject.php for
more info).  It's caused by SSLAuth creating a new LoginForm (~line 1551).  If
the function gets to that point, it realizes the user is in the LDAP but not in
the local database and it tries to setup a new LoginForm to init the user. 
However, something in the LoginForm chain fires the AutoAuthenticate hook again
which calls SSLAuth again hence the loop.  I worked around this by adding a flag
to wgAuth called isBusy which gets set at the start of SSLAuth() and cleared
before that function returns.  Then at the start of the function I check to see
if its set and if so return.  This ensures that SSLAuth is never called twice in
one request.</pre>
    </div><div id="c163" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c163">Comment 163</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-03-02 14:25:24 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c162">comment #162</a>)
<span class="quote">&gt; Another bug with 1.9.1 and 1.1d using PKI authentication (smartcard auth). Whena user attempts to log in and exists </span >
in the LDAP but not in the local database,I get an infinite unstub loop (see the header of includes/StubObject.php 
formore info). It's caused by SSLAuth creating a new LoginForm (~line 1551). Ifthe function gets to that point, it 
realizes the user is in the LDAP but not inthe local database and it tries to setup a new LoginForm to init the user. 
However, something in the LoginForm chain fires the AutoAuthenticate hook againwhich calls SSLAuth again hence the 
loop. I worked around this by adding a flagto wgAuth called isBusy which gets set at the start of SSLAuth() and 
clearedbefore that function returns. Then at the start of the function I check to seeif its set and if so return. 
This ensures that SSLAuth is never called twice inone request.

Thanks for the info on SSLAuth and 1.9.1. I'm not able to move to php5 yet, so I can't test anything above MediaWiki 
1.6.x right now. Hopefully in a couple months I'll be able to start testing higher versions of MediaWiki, and these 
problems will go away. Unfortunately, I won't be able to add your changes in until I've been able to test them.

I'll add these to the list of things I need to fix.

</pre>
    </div><div id="c164" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c164">Comment 164</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-03-04 06:55:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The plugin will no longer be released on this bugzilla page. Instead, the
software will be hosted in MediaWiki's svn, new version releases will be
announced on mediawiki-l, support will be given at:
<a href="http://meta.wikimedia.org/wiki/Talk:LDAP_Authentication">http://meta.wikimedia.org/wiki/Talk:LDAP_Authentication</a> and plugin information
(including links to downloads) will be maintained at:
<a href="http://meta.wikimedia.org/wiki/LDAP_Authentication">http://meta.wikimedia.org/wiki/LDAP_Authentication</a></pre>
    </div><div id="c165" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c165">Comment 165</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Newton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-03-12 22:42:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Since I can't update the article at MW, I'll add this here.  Trying to apply
group requirements to users, I was unable to find certain users in any groups
(in getGroups() function.)  It turns out that if a DN has any special characters
in it, they need to be escaped.  I made this change from 1.1d, and have had
success authenticating some users who had parentheses in their names:

&#64;&#64; -1214,7 +1214,8 &#64;&#64;
                $nameattribute = $wgLDAPGroupNameAttribute[$_SESSION['wsDomain']];

                //Search for the groups this user is in
-               $filter = &quot;(&amp;($attribute=$dn)(objectclass=$objectclass))&quot;;
+               $filterdn = ($dn == '*') ? '*' : $filterdn =
preg_replace('/([\\*\\(\\)\\\])/', '\\\\$1', $dn);
+               $filter = &quot;(&amp;($attribute=$filterdn)(objectclass=$objectclass))&quot;;

                $this-&gt;printDebug(&quot;Search string: $filter&quot;,2);

The ldap_search() function on line 1229 is what was failing; it would be nice if
that were checked for a non-boolean false value before proceeding with the search.</pre>
    </div><div id="c166" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=814#c166">Comment 166</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ryan Lane</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-03-13 13:10:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=814#c165">comment #165</a>)
<span class="quote">&gt; Since I can't update the article at MW, I'll add this here.  Trying to apply
&gt; group requirements to users, I was unable to find certain users in any groups
&gt; (in getGroups() function.)  It turns out that if a DN has any special characters
&gt; in it, they need to be escaped.  I made this change from 1.1d, and have had
&gt; success authenticating some users who had parentheses in their names:
&gt; 
&gt; &#64;&#64; -1214,7 +1214,8 &#64;&#64;
&gt;                 $nameattribute = $wgLDAPGroupNameAttribute[$_SESSION['wsDomain']];
&gt; 
&gt;                 //Search for the groups this user is in
&gt; -               $filter = &quot;(&amp;($attribute=$dn)(objectclass=$objectclass))&quot;;
&gt; +               $filterdn = ($dn == '*') ? '*' : $filterdn =
&gt; preg_replace('/([\\*\\(\\)\\\])/', '\\\\$1', $dn);
&gt; +               $filter = &quot;(&amp;($attribute=$filterdn)(objectclass=$objectclass))&quot;;
&gt; 
&gt;                 $this-&gt;printDebug(&quot;Search string: $filter&quot;,2);
&gt; 
&gt; The ldap_search() function on line 1229 is what was failing; it would be nice if
&gt; that were checked for a non-boolean false value before proceeding with the search.</span >

You can't update a page that is writable by anyone in the world? Did you even
bother to read any of the documentation? This is something that is going to be
fixed next release; if you read the roadmap you'd have noticed this, or if you
took at look at the talk page, you'd also have noticed that many people have
sent in fixes for this (and I mentioned specifically that I'd be using one of
the fixes).

Do *not* comment on this closed bug, it is closed for a reason.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

    <hr><div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=814&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=814">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=814">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=814">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
<div class="visualClear"></div>
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="head" class="noprint">
			<!-- /search -->
			<div id="p-search">
				<h5><label for="searchInput">Search</label></h5>
				<form id="searchform" action="buglist.cgi" method="get"
				 onsubmit="if (this.quicksearch.value == '')
				 { alert('Please enter one or more search terms first.');
				 return false; } return true;">
					<input type='hidden' name="title" value="Special:Search"/>
					<div id="simpleSearch">
						<input id="searchInput" name="quicksearch" type="text" title="Search Bugzilla [alt-f]" accesskey="f" value="" />
						<button id="searchButton" type='submit' name='button' title="Search Bugzilla for this text">&nbsp;</button>
					</div>
				</form>
			</div>
			<!-- /search -->
			<!-- personal -->
			<div id="p-personal" class="">
				<h5>Personal tools</h5>
				<ul >
							<li id="new_account_container">
								<a href="createaccount.cgi">New&nbsp;Account</a>
							</li>
						<li id="mini_login_container">
  <span class="separator">| </span>
  <a id="login_link" href="show_bug.cgi?id=814&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('')">Log In</a>

  
  <form action="show_bug.cgi?id=814" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login"
        onsubmit="return check_mini_login_fields( '' );"
  >
    <input id="Bugzilla_login" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('')"
    >
    <input class="bz_password" 
           id="Bugzilla_password" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy" value="password"
           title="Password"
           onfocus="mini_login_on_focus('')"
    >
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "email address",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('')">[x]</a>
  </form>
</li>
<li id="forgot_container">
  <span class="separator">| </span>
  <a id="forgot_link" href="show_bug.cgi?id=814&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form"
        class="mini_forgot bz_default_hidden">
    <label for="login">Login:</label>
    <input type="text" name="loginname" size="20" id="login">
    <input id="forgot_button" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token" name="token" value="1419357894--RsMH_4CAUIT9ZOGwTHXB4C0UAZr2T3D_AqdanrxgAw">
    <a href="#" onclick="return hide_forgot_form('')">[x]</a>
  </form>
</li>

				</ul>
			</div>
			<!-- /personal -->
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="panel" class="noprint">
				<!-- logo -->
				<div id="p-logo"><a style="background-image: url(skins/contrib/Wikimedia/images/bugzilla-logo.png);" href="./"  title="Visit the main page"></a></div>
				<!-- /logo -->
				<!-- navigation -->
				<div class="portal">
					<h5>Navigation</h5>
					<div class="body">
						<ul><li><a href="query.cgi?format=specific">Search bugs</a></li>
			<li><a href="query.cgi?format=advanced">Advanced search</a></li>
			<li><a href="describecomponents.cgi">Browse projects</a></li>
			<li><a href="enter_bug.cgi">Enter a new bug</a></li>
                        <li>
                                <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
                        </li>	
						</ul>
					</div>
				</div>
				<!-- /navigation -->
				<!-- interaction -->
				<!-- /interaction -->
				<!-- toolbox -->
				<div class="portal">
					<h5>Links</h5>
					<div class="body">
						<ul><li><a href="report.cgi">Reports</a></li>
			<li><a href="weekly-bug-summary.cgi?tops=10&days=7">Weekly Summary</a></li>
				<li>
						<a href="request.cgi">Requests</a>
				</li>
						</ul>
					</div>
				</div>
				<!-- /toolbox -->
			</div>
		<!-- /panel -->		

		<!-- footer -->
		<div id="footer" >
			<ul id="footer-info">
				<li>Bugzilla version 4.4.5</li>
			</ul>

			<ul id="footer-places">
				<li><a href="https://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Bug_management/Bugzilla_etiquette" title="Bug management/Bugzilla etiquette">Bugzilla etiquette</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:About" title="Project:About">About MediaWiki.org</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:General_disclaimer" title="Project:General disclaimer">Disclaimers</a></li>
			</ul>
			<ul id="footer-icons" class="noprint">
				<li id="footer-icon-poweredby"><a href="http://www.bugzilla.org/"><img src="skins/contrib/Wikimedia/images/bugzilla-badge.png" height="31" width="88" alt="Powered by Bugzilla" /></a></li>
			</ul>
			<div style="clear:both"></div>
		<div class="outro"></div>
		</div>
		<!-- /footer -->
	</body>
</html>