<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 898 &ndash; Allow uploading (almost) any type of file by recognizing &quot;nasty&quot; files automatically</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://old-bugzilla.wikimedia.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=898&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=898">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=898">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=898">



    
    <link href="skins/standard/global.css?1389015166"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/global.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="skins/standard/show_bug.css?1389015166" rel="stylesheet"
        type="text/css" ><link href="extensions/Voting/web/style.css?1389015166" rel="stylesheet"
        type="text/css" ><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css?1389015166" rel="stylesheet"
        type="text/css" >
<![endif]-->

    <link href="skins/contrib/Wikimedia/global.css?1402013050" rel="stylesheet"
        type="text/css" title="Wikimedia"><link href="skins/contrib/Wikimedia/show_bug.css?1402441020" rel="stylesheet"
        type="text/css" title="Wikimedia">

      <link rel="stylesheet" href="skins/contrib/Wikimedia/vector.css?1403109885" media="screen"
            title="Wikimedia" />


    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1389015166"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1389015166"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1389015166"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1389015166"></script><script type="text/javascript" src="js/yui/json/json-min.js?1389015166"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1389015166"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1389015166"></script><script type="text/javascript" src="js/global.js?1389015166"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 15
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 898 – Allow uploading (almost) any type of file by recognizing \"nasty\" files automatically",  
                             "show_bug.cgi?id=898" );
        document.title = "Bug 898 – Allow uploading (almost) any type of file by recognizing \"nasty\" files automatically";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 898 – Allow uploading (almost) any type of file by recognizing \"nasty\" files automatically", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1389015166"></script><script type="text/javascript" src="js/field.js?1389015166"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="old-bugzilla-wikimedia-org bz_bug bz_status_RESOLVED bz_product_MediaWiki bz_component_Uploading bz_bug_898 yui-skin-sam">



<!-- If custom Wikimedia skin -->
   <div id="page-base" class="noprint"></div>
                <div id="head-base" class="noprint"></div>
                <!-- content -->
                <div id="content-container" >
                        <a id="top"></a>
                        <!-- bodyContent -->
                        <div id="bodyContent">
      <p class="header_addl_info">Last modified: 2012-02-19 07:31:43 UTC</p>

 <!-- If custom Wikimedia skin -->
<h1>Wikimedia Bugzilla is closed!</h1><div id="message" style="text-align: center; color: black">Wikimedia has <a href="https://www.mediawiki.org/wiki/Phabricator/versus_Bugzilla">migrated from Bugzilla to Phabricator</a>. Bug reports should be created and updated in <a href="https://phabricator.wikimedia.org">Wikimedia Phabricator</a> instead. Please <a href="https://www.mediawiki.org/wiki/Phabricator/Help#Creating_your_account">create an account in Phabricator and add your Bugzilla email address</a> to it.<br>Wikimedia Bugzilla is read-only. If you try to edit or create any bug report in Bugzilla you will be shown an intentional error message.<br>In order to access the Phabricator task corresponding to a Bugzilla report, just remove "static-" from its URL.<br>You could still run searches in Bugzilla or access your <a href="https://old-bugzilla.wikimedia.org/page.cgi?id=voting%2Fuser.html">list of votes</a> but bug reports will obviously not be up-to-date in Bugzilla.</div>

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2012-02-19 07:31:43">
  <input type="hidden" name="longdesclength" value="41">
  <input type="hidden" name="id" value="898">
  <input type="hidden" name="token" value="1419358025-tg8vylWFCDy6mqMu5TAOKKe3ZnFUcpg8_7hkun8XHdc">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=898"><b>Bug&nbsp;898</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Allow uploading (almost) any type of file by recognizing &quot;nasty&quot; files automatically</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td><span title="Allow uploading (almost) any type of file by recognizing &quot;nasty&quot; files automatically">Allow uploading (almost) any type of file by recognizing &quot;nasty&quot; files automa...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('Allow uploading (almost) any type of file by recognizing \"nasty\" files automatically', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >MediaWiki</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr>
    
    <td class="field_label">
      <label for="component">
        <a href="describecomponents.cgi?product=MediaWiki">
        Component:</a>
      </label>
    </td>
    
    <td>Uploading
    
    (<a href="buglist.cgi?component=Uploading&product=MediaWiki&resolution=---"
      target="new_window">Other open bugs</a>)
    
    </td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>
</label>
</th>
        <td>1.5.x
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">All
       All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Normal
       enhancement<span id="votes_container">
      with
      <a href="page.cgi?id=voting/bug.html&amp;bug_id=898">3 
            votes</a>
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=898#vote_898">vote</a>)
  </span>
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=fields.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Nobody - You can work on this!</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'wikibugs-l\x40lists.wikimedia.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
          <a href="http://area23.brightbyte.de/checkfile-test.php"><span title="http://area23.brightbyte.de/checkfile-test.php">http://area23.brightbyte.de/checkfile...
        </span></a>
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">patch, patch-reviewed
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    <a class="bz_bug_link 
          bz_status_NEW "
   title="NEW - JavaScript (tracking)"
   href="show_bug.cgi?id=2114">javascript</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED WONTFIX - Whitelist .ai (Adobe Illustrator) on WMF wikis"
   href="show_bug.cgi?id=667">667</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - Allow .XCF uploads on Wikimedia web sites"
   href="show_bug.cgi?id=1410">1410</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - Allow SVG uploads on Commons"
   href="show_bug.cgi?id=1683">1683</a> 
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=898&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=898">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2004-11-16 20:37 UTC by <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2012-02-19 07:31 UTC 
      (<a href="show_activity.cgi?id=898">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>5 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="avarab">avarab</option>
                <option value="captainblood">captainblood</option>
                <option value="CloudSurfer">CloudSurfer</option>
                <option value="david">david</option>
                <option value="silsor">silsor</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_browser">


  <a 
      title="Please set this if the described problem seems to happen only in a specific web browser."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_browser"
  >Web browser:</a>

</th>
  <td class="field_value "
      id="field_container_cf_browser"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_platform">


  <a 
      title="The Mobile Platform the described problem was experienced on."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_platform"
  >Mobile Platform:</a>

</th>
  <td class="field_value "
      id="field_container_cf_platform"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_hugglebeta">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_hugglebeta"
  >Assignee Huggle Beta Tester:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_hugglebeta"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=497"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">proof-of-concept patch implementing my suggestions. Please read the comment</span></b></a>

          <span class="bz_attach_extra_info">
              (32.18 KB,
                patch)

            <br>
            <a href="#attach_497"
               title="Go to the comment associated with the attachment">2005-05-04 13:01 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=497&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=511"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Full patch for this bug. Needs additional files and a database change, files follow.</span></b></a>

          <span class="bz_attach_extra_info">
              (57.00 KB,
                patch)

            <br>
            <a href="#attach_511"
               title="Go to the comment associated with the attachment">2005-05-10 20:46 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=511&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=512"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">database patch for inserting new columns into the image table (path: maintenance/archives/patch-img_media_type.sql)</span></b></a>

          <span class="bz_attach_extra_info">
              (1.25 KB,
                text/plain)

            <br>
            <a href="#attach_512"
               title="Go to the comment associated with the attachment">2005-05-10 20:47 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=512&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a4" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=513"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">mime type detection module</span></b></a>

          <span class="bz_attach_extra_info">
              (15.64 KB,
                text/plain)

            <br>
            <a href="#attach_513"
               title="Go to the comment associated with the attachment">2005-05-10 20:48 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=513&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a5" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=514"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">standard mime.types file (mapping mime types to file extensions), used by MimeMagic.php (path: includes/mime.types)</span></b></a>

          <span class="bz_attach_extra_info">
              (2.66 KB,
                text/plain)

            <br>
            <a href="#attach_514"
               title="Go to the comment associated with the attachment">2005-05-10 20:49 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=514&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a6" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=515"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">mime.info file defining mime type aliases and media types, used by MimeMeagic.php (path: includes/mime.info)</span></b></a>

          <span class="bz_attach_extra_info">
              (1.97 KB,
                text/plain)

            <br>
            <a href="#attach_515"
               title="Go to the comment associated with the attachment">2005-05-10 20:49 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=515&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a7" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=516"
               title="View the content of the attachment">
          <b>Danish translations for the new strings introduced by this patch</b></a>

          <span class="bz_attach_extra_info">
              (1.55 KB,
                patch)

            <br>
            <a href="#attach_516"
               title="Go to the comment associated with the attachment">2005-05-10 21:02 UTC</a>,

            <span class="vcard"><span class="fn">Anders Wegge Jakobsen</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=516&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a8" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=525"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">new version of MimeMagic.php, code is now wrapped in a class; this version matches the patch that follows. (path: includes/MimeMagic.php)</span></b></a>

          <span class="bz_attach_extra_info">
              (16.33 KB,
                text/plain)

            <br>
            <a href="#attach_525"
               title="Go to the comment associated with the attachment">2005-05-12 01:29 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=525&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a9" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=526"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">new patch, using the new, OO version of MimeMagic.php</span></b></a>

          <span class="bz_attach_extra_info">
              (59.06 KB,
                patch)

            <br>
            <a href="#attach_526"
               title="Go to the comment associated with the attachment">2005-05-12 01:33 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=526&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a10" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=527"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">&quot;upgrade&quot; patch in case you already applied the first full patch (from 2005-05-10 20:46 UTC)</span></b></a>

          <span class="bz_attach_extra_info">
              (36.36 KB,
                patch)

            <br>
            <a href="#attach_527"
               title="Go to the comment associated with the attachment">2005-05-12 01:40 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=527&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a11" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=542"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.</span></b></a>

          <span class="bz_attach_extra_info">
              (66.13 KB,
                patch)

            <br>
            <a href="#attach_542"
               title="Go to the comment associated with the attachment">2005-05-15 19:31 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=542&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a12" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=543"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">MIME detection module, new version (includes/MimeMagic.php)</span></b></a>

          <span class="bz_attach_extra_info">
              (18.94 KB,
                text/plain)

            <br>
            <a href="#attach_543"
               title="Go to the comment associated with the attachment">2005-05-15 19:32 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=543&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a13" class="bz_contenttype_text_plain">
        <td valign="top">
            <a href="attachment.cgi?id=544"
               title="View the content of the attachment">
          <b>updated mime info (includes/mime.info)</b></a>

          <span class="bz_attach_extra_info">
              (2.17 KB,
                text/plain)

            <br>
            <a href="#attach_544"
               title="Go to the comment associated with the attachment">2005-05-15 19:33 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=544&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a14" class="bz_contenttype_text_plain">
        <td valign="top">
            <a href="attachment.cgi?id=545"
               title="View the content of the attachment">
          <b>updated mime types (includes/mime.types)</b></a>

          <span class="bz_attach_extra_info">
              (2.84 KB,
                text/plain)

            <br>
            <a href="#attach_545"
               title="Go to the comment associated with the attachment">2005-05-15 19:34 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=545&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a15" class="bz_contenttype_text_plain">
        <td valign="top">
            <a href="attachment.cgi?id=546"
               title="View the content of the attachment">
          <b>updated database patch, now also removed the obsolete img_type column. (maintenance/archives/patch-img_media_type.sql) </b></a>

          <span class="bz_attach_extra_info">
              (983 bytes,
                text/plain)

            <br>
            <a href="#attach_546"
               title="Go to the comment associated with the attachment">2005-05-15 19:35 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=546&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a16" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=547"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">MIME detection module, new version (includes/MimeMagic.php)</span></b></a>

          <span class="bz_attach_extra_info">
              (18.95 KB,
                text/plain)

            <br>
            <a href="#attach_547"
               title="Go to the comment associated with the attachment">2005-05-15 20:07 UTC</a>,

            <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=547&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a17" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=548"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">MIME detection module, new version (includes/MimeMagic.php)</span></b></a>

          <span class="bz_attach_extra_info">
              (18.95 KB,
                text/plain)

            <br>
            <a href="#attach_548"
               title="Go to the comment associated with the attachment">2005-05-15 20:12 UTC</a>,

            <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=548&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a18" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=549"
               title="View the content of the attachment">
          <b>Changes to Language.php, should be applied to a clean tree (not directly after attachment 542)</b></a>

          <span class="bz_attach_extra_info">
              (1.16 KB,
                patch)

            <br>
            <a href="#attach_549"
               title="Go to the comment associated with the attachment">2005-05-15 21:19 UTC</a>,

            <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=549&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a19" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=550"
               title="View the content of the attachment">
          <b>Changes to ImagePage.php, should be applied to a clean tree (not directly after attachment 542)</b></a>

          <span class="bz_attach_extra_info">
              (3.56 KB,
                patch)

            <br>
            <a href="#attach_550"
               title="Go to the comment associated with the attachment">2005-05-15 21:20 UTC</a>,

            <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=550&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a20" class="bz_contenttype_text_plain">
        <td valign="top">
            <a href="attachment.cgi?id=554"
               title="View the content of the attachment">
          <b>MIME detection module (includes/MimeMagic.php), fixing bugs mentioned in #32, #33, #34</b></a>

          <span class="bz_attach_extra_info">
              (19.00 KB,
                text/plain)

            <br>
            <a href="#attach_554"
               title="Go to the comment associated with the attachment">2005-05-16 19:28 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=554&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a21" class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a href="attachment.cgi?id=555"
               title="View the content of the attachment">
          <b>new version of the FULL PATCH, fixing bugs mentioned in #32, #33, #34</b></a>

          <span class="bz_attach_extra_info">
              (64.17 KB,
                patch)

            <br>
            <a href="#attach_555"
               title="Go to the comment associated with the attachment">2005-05-16 19:31 UTC</a>,

            <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=555&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (13)
        </span>
        <a href="attachment.cgi?bugid=898&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1389015166" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-16 20:37:12 UTC
        </span>
      </div>



<pre class="bz_comment_text" >As of now, most file types are disallowed for uploads to the wikipedia. As i
understand, this is due to the fact that MSIE can be tricked into executing
potentially harmful javascript-code in any file, regardles of mime-type or file
extension. This is the case because MSIE will interpret all files that &quot;somehow
look like&quot; HTML as such. In the following i would like to propose a solution to
this problem.

It would be good to be again able to upload files in formats like MIDI and SVG -
SVG ist especially tricky, as it allows JavaSCript by specification. This types
of files would be hande so the data can be easily edited and re-used by others,
an especially because the GFDL calls for the &quot;transparent source&quot; of a document,
which is at the moment impossible to provide via Wikipedia.

But it is also sad but true that javascript is in general not very secure, be it
in HTML or in SVG. Thus, i would suggest doing the following:

a) detect and reject all files that &quot;somehow look like&quot; HTML, emulating MSIEs
guess - as i hear there is already experimental code for this in the CVS. I
re-wrote a trivial version of this guess for the code presented at the URL given
below.
b) detect and reject all files containg javascript code. This will probably
produce some false positives, but that is better than rejecting all but a few
formats alltogether. The dection function in the URL below is rather crude, but
should work most of the time.
c) scan for viruses on upload, using an external virus scanner. The wrapper
function i wrote is generic and can deal with any scanner that can be invoked
from the command line. The example uses clamav.

A prototype, proof-of-concept implementation can be viewed and tested here:

   <a href="http://area23.brightbyte.de/checkfile-test.php">http://area23.brightbyte.de/checkfile-test.php</a>

The source is available there, but would need some modifications to be
integrated into mediawiki (i guess - i have never looked into the MW-source, and
i don't  plan to). For more information and suggestions, please go to

   <a href="http://de.wikipedia.org/w/wiki/Benutzer:Duesentrieb/checkfile">http://de.wikipedia.org/w/wiki/Benutzer:Duesentrieb/checkfile</a>

I hope you like it and it's not to hard to put it in. It would be extremely
helpful if we could again upload &quot;obscure&quot; things like MIDI and SVG to the
Wikipedia.

PS: <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED WONTFIX - Whitelist .ai (Adobe Illustrator) on WMF wikis"
   href="show_bug.cgi?id=667">Bug #667</a> relates to the same problem, but is very specific in that it justs
requests a single format to be alowed. It also does not propose a solution.</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2004-11-24 13:23:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I would like to add another suggestion: Show an extra warning on the
description-page of media in a potentially dangerous format (or rather for any
non-image, non-sound format). The message could read something like this:

 &quot;This file may contain executable code that might damage your system.
 If you download this file and open it on your computer, potentially
 harmfult contents may be run. Please make sure you know what you
 are doing. The Wikimedia Foundation does not take any resposibility for
 the contents of this file or any harm it may do to your system.&quot;

This is not only aimed at macro-viruses hidden in doc-fiels etc (which the virus
scanner will hopefully find on upload), but maily at &quot;trivial trojans&quot; like
batch files containing a &quot;format C:&quot; or some such.

In that context, it meight also be good to block all files with the extensions
.exe, .bat, .cmd, .reg, .js as well as any files starting with a she-bang (#!),
regardles of the guessed mime-type. That is, there should be a list of forbidden
extensions in addition to a list of forbidden mime-types (or does that already
exist?), and an additional check for the she-bang. If you like, i could add that
to the sample code, but it's trivial. 


When discussing this on wikitech-l, Rowan Collins suggested the following:

That leads to an interesting thought: presumably, non-image files are
already blocked from being included &quot;inline&quot;; but what about the magic
[[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=Media%3A...">Media:...</a>]] links? I know it's pretty dumb to open a file that you
don't know what it is, but some people genuinely are, and it would be
nice to do everything we can to help them.  In other words, perhaps
it would make sense to have *three* whitelists:

1) Images: can be uploaded, linked to direct, and included inline
2) Other trusted files (e.g. sounds, videos): can be uploaded, linked
to directly with [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=Media%3A">Media:</a>]], but not included inline with [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=Image%3A">Image:</a>]]
3) Potentially harmful files (e.g. .zip, .doc): can be uploaded (if
they pass a virus scan), but not linked to directly; users are always
directed to the description page, where they are presented with a
warning message.

</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Jason Drake</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-01 09:51:36 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The Wikimedia Foundation's site (<a href="http://wikimediafoundation.org/">http://wikimediafoundation.org/</a>) 
should allow uploading of any file immediately, since only trusted 
users can access it.

I can see three problems with virus scanning at this time:
* we like free software...but can we get a free virus scanner with 
decent definition updates?
* some people may mistakenly think that it's foolproof
* it will take a lot of processor time (expensive)

The second problem can be resolved with decent warnings, I suppose. 
If we are relying on external hosting then we don't want to waste 
processor time.

I don't like virus scanning...some are bound to slip through the net.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Jason Drake</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-01 09:52:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Be careful with that warning! Some old MS-DOS manuals contain some 
rubbish about users not being able to harm their computers whatever 
they did - people may not take that warning seriously, particularly 
in places where computers are just being introduced.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-01 17:49:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=898#c2">comment #2</a>)
<span class="quote">&gt; The Wikimedia Foundation's site (<a href="http://wikimediafoundation.org/">http://wikimediafoundation.org/</a>) 
&gt; should allow uploading of any file immediately, since only trusted 
&gt; users can access it.</span >

Maybe, maybe not. Trusted users can have conterminated files on their box too.

<span class="quote">&gt; * we like free software...but can we get a free virus scanner with 
&gt; decent definition updates?</span >

Yes, camav. Also, the code I designed is very felxible, it can easily interface
to any scanner that can be run from the command line.

<span class="quote">&gt; * some people may mistakenly think that it's foolproof</span >

Not more so than before - there is no reason to put up a sign &quot;all files are
scanned for viruses&quot;. The user will not notice the scanning unless a virus is found.

<span class="quote">&gt; * it will take a lot of processor time (expensive)</span >

Not really. We see about one image per minute uploaded to the commons. Scanning
a big jpg (1.8 MB) on my box (1.9 GHz P4) takes about 1 sec of CPU time.

<span class="quote">&gt; I don't like virus scanning...some are bound to slip through the net.</span >

Yes. But our alternatives are 1) to ave no net at all and b) to limit allowed
formats to a minimum. Note that there are virusses that can infeect JPGs, too
(they use a bug in the windows image rendering libs and effect all browsers).
Those are not detected right now.


I belive may suggestion should be implemented as soon as possible, maybe even
for 1.5; I already supplied code the implements the functionality, it should not
be too hard to integrate it into mediawiki. Maybe I'll try to do it mayself, but
i'm not sure when I get around to it.

The disability to supply sources for graphics is frustrating to many users who
would like to contribute SVG (we even have a renderer for that!), MIDI and
similar formats that can easily be edited by others, unlike bitmap images.</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-01 17:53:50 UTC
        </span>
      </div>



<pre class="bz_comment_text" >oops, sorry, that should be ClamAV - see <a href="http://www.clamav.net/">http://www.clamav.net/</a></pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-04 13:01:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=497" name="attach_497" title="proof-of-concept patch implementing my suggestions. Please read the comment">attachment 497</a> <a href="attachment.cgi?id=497&amp;action=edit" title="proof-of-concept patch implementing my suggestions. Please read the comment">[details]</a></span>
proof-of-concept patch implementing my suggestions. Please read the comment

Created a proof of concept patch. This is just for reference - it uses an ugly
bitfield logic, which has the advantage of being compatible iwth the current
1.5 DB schema. The Real Thing should however be based on three separate fields
in the database, for media class (image, drawing, audio, video, etc) and major
and minor mime type, as suggested by brion and tim.

This patch consists of three parts (which should probably go into separate
patches eventually): 

1) Changes to the verification code in SpecialUpload.php:
* improved mime detection / verification
* detection of javascript
* virus scanning

2) Changes to Image.php that allow to determine if a medium is fit to be shown
inline, to be linked to directly, or is non-trusted formats that could contain
malicious code (i.e. anything else).

3) Changes to ImagePage.php and Linker.php
* put a warning on the description page of non-trusted files
* disallow direct [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=media%3A...">media:...</a>]] links to non-trusted files

The patch also contains changes to DefaultSettings, Defines and Languages to
support the above.

Please have a look at the patch and comment, so I can implement changes when I
adopt this to the new and beter database schema.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 20:46:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=511" name="attach_511" title="Full patch for this bug. Needs additional files and a database change, files follow.">attachment 511</a> <a href="attachment.cgi?id=511&amp;action=edit" title="Full patch for this bug. Needs additional files and a database change, files follow.">[details]</a></span>
Full patch for this bug. Needs additional files and a database change, files follow.</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 20:47:31 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=512" name="attach_512" title="database patch for inserting new columns into the image table (path: maintenance/archives/patch-img_media_type.sql)">attachment 512</a> <a href="attachment.cgi?id=512&amp;action=edit" title="database patch for inserting new columns into the image table (path: maintenance/archives/patch-img_media_type.sql)">[details]</a></span>
database patch for inserting new columns into the image table (path: maintenance/archives/patch-img_media_type.sql)</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 20:48:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=513" name="attach_513" title="mime type detection module">attachment 513</a> <a href="attachment.cgi?id=513&amp;action=edit" title="mime type detection module">[details]</a></span>
mime type detection module</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 20:49:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=514" name="attach_514" title="standard mime.types file (mapping mime types to file extensions), used by MimeMagic.php (path: includes/mime.types)">attachment 514</a> <a href="attachment.cgi?id=514&amp;action=edit" title="standard mime.types file (mapping mime types to file extensions), used by MimeMagic.php (path: includes/mime.types)">[details]</a></span>
standard mime.types file (mapping mime types to file extensions), used by MimeMagic.php (path: includes/mime.types)</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 20:49:53 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=515" name="attach_515" title="mime.info file defining mime type aliases and media types, used by MimeMeagic.php (path: includes/mime.info)">attachment 515</a> <a href="attachment.cgi?id=515&amp;action=edit" title="mime.info file defining mime type aliases and media types, used by MimeMeagic.php (path: includes/mime.info)">[details]</a></span>
mime.info file defining mime type aliases and media types, used by MimeMeagic.php (path: includes/mime.info)</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 20:56:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The attachments I just mad ned to be applied together. Note that this patch
changes the columns in the image table (this is done by the
patch-img_media_type.sql database patch): img_type is obsolete and replaced by
img_media_type, img_major_mime and img_minor_mime.

updater.inc was adjusted to apply this database patch, but it has not been tested.

Note that the patch introduces several new setup variables into
DefaultSettings.php. To take full advantage of the new upload behaviour, set the
following in LocalSettings.php:

$wgStrictFileExtensions = false;
$wgVerifyMimeType= true;
$wgAntivirus= &quot;clamav&quot;;  #or &quot;f-prot&quot;
$wgMimeDetectorCommand= &quot;file -bi&quot;; #on linux

Note that if $wgMimeDetectorCommand is net set, the new code tries to use
mime_content_type or finfo to detect the mime type, if either is available.
Those extensions need to be compiled into PHP, their use has not been tested yet.

This patch has been installed and tested successfully on Wegge's test wiki
&lt;<a href="http://playwiki.wegge.dk/">http://playwiki.wegge.dk/</a>&gt;, you can try it out there. I hope it can be applied
to the 1.5 branch soon.
</pre>
    </div><div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Anders Wegge Jakobsen</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 21:02:43 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=516" name="attach_516" title="Danish translations for the new strings introduced by this patch">attachment 516</a> <a href="attachment.cgi?id=516&amp;action=edit" title="Danish translations for the new strings introduced by this patch">[details]</a></span>
Danish translations for the new strings introduced by this patch

Besides submitting the LanguageDa.php diff, I can tell that so far the test has
given no warnings or errors from the MediaWiki installation, except for those
introduced by my forgetfullness in the patching phase. If anybody experiences
problems on <a href="http://playwiki.wegge.dk">http://playwiki.wegge.dk</a> I'll be happy to investigate, given an
approximate time.</pre>
    </div><div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 22:41:20 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Here's where the new files go (sorry, I should have put that into the
description of each attachment). The patches are obviously applied as patches.
The other files are, in order:

* database patch: maintenance/archives/patch-img_media_type.sql
* mime type module: includes/MimeMagic.php
* mime type file: includes/mime.types
* mime info file: includes/mime.info

that should be it :)</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-10 23:27:11 UTC
        </span>
      </div>



<pre class="bz_comment_text" >There are some things you change that aren't directly related to this
feature/functionality:

This should probably be enabled at some point, but isn't related to this feature:
&quot;&quot;&quot;&quot;
-$wgFileExtensions = array( 'png', 'gif', 'jpg', 'jpeg' );
+$wgFileExtensions = array( 'png', 'gif', 'jpg', 'jpeg', 'ogg' );
&quot;&quot;&quot;&quot;

Changing the Exif read/get functions doesn't have much to do with this:
&quot;&quot;&quot;&quot;
&#64;&#64; -1146,7 +1289,10 &#64;&#64;
         * &#64;return array
         */
        function retrieveExifData () {
-               if ( $this-&gt;type !== '2' ) return array ();
+               global $wgShowEXIF ;
+               if ( !$wgShowEXIF or !$this-&gt;fileExists) return array ();
+               
+               if ( $this-&gt;getMimeType() !== &quot;image/jpeg&quot; ) return array ();

                $exif = exif_read_data( $this-&gt;imagePath );
                foreach($exif as $k =&gt; $v) {
&#64;&#64; -1162,11 +1308,14 &#64;&#64;
                                unset($exif[$k]);
                        }
                }
+               
                return $exif;
        }

        function getExifData () {
-               global $wgRequest;
+               global $wgRequest, $wgShowEXIF;
+               
+               if (!$wgShowEXIF or !isset($this-&gt;exif)) return array();

                $purge = $wgRequest-&gt;getVal( 'action' ) == 'purge';
                $ret = unserialize ( $this-&gt;metadata );
&#64;&#64; -1416,7 +1565,7 &#64;&#64;
&quot;&quot;&quot;&quot;

Thera are also some stray whitespace changes:
&quot;&quot;&quot;&quot;
&#64;&#64; -881,6 +1026,7 &#64;&#64;
                        }
                        wfPurgeSquidServers( $urls );
                }
+               
        }
 
        /**
&#64;&#64; -924,16 +1070,6 
&quot;&quot;&quot;&quot;

&quot;&quot;&quot;&quot;
                        );
-
+                       
                        # Update the current image row
&quot;&quot;&quot;&quot;

&quot;&quot;&quot;&quot;
&#64;&#64; -1162,11 +1308,14 &#64;&#64;
                                unset($exif[$k]);
                        }
                }
+               
                return $exif;
        }
&quot;&quot;&quot;&quot;

&quot;&quot;&quot;&quot;
&#64;&#64; -1443,7 +1592,6 &#64;&#64;

        return array_key_exists( $name, $titleList );
 }
-       
&quot;&quot;&quot;&quot;

&quot;&quot;&quot;&quot;
                }
+               
                chmod( $this-&gt;mSavedFile, 0644 );
                return true;
        }
&#64;&#64; -640,153 +677,207 &#64;&#64;
&quot;&quot;&quot;&quot;

&quot;&quot;&quot;&quot;
+       
 }
 ?&gt;
&quot;&quot;&quot;&quot;

&quot;&quot;&quot;&quot;
        }
+       
        readfile( $fname );
 }
&quot;&quot;&quot;&quot;

And regarding this:

&quot;&quot;&quot;&quot;
&#64;&#64; -1,17 +1,20 &#64;&#64;
 -- Extra image metadata, added for 1.5

+-- NOTE: as by patch-img_media_type.sql, the img_type
+-- column is no longer used and has therefore be removed from this patch
+
 ALTER TABLE /*$wgDBprefix*/image ADD (
   img_width int(5) NOT NULL default 0,
   img_height int(5) NOT NULL default 0,
   img_bits int(5) NOT NULL default 0,
-  img_type int(5) NOT NULL default -1
+  -- img_type int(5) NOT NULL default -1
 );

 ALTER TABLE /*$wgDBprefix*/oldimage ADD (
   oi_width int(5) NOT NULL default 0,
   oi_height int(5) NOT NULL default 0,
   oi_bits int(3) NOT NULL default 0,
-  oi_type int(3) NOT NULL default 0
+  -- oi_type int(3) NOT NULL default 0
 );
&quot;&quot;&quot;&quot;
if img_type and oi_type aren't used anymore please add a DELETE statement to
patch-img_media_type.sql that removes them, and change
maintenance/parserTests.php so that it doesn't create this obsolete table.

Otherwise it looks pretty solid, I haven't really tested it on a wide range of
input files yet, which I might just do;)</pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-11 05:47:11 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Some further comments after looking at it a bit more closely:

* The whole MimeMagic.php file is just a row of functions most of which have to
be parsed on each invocation, it should be a class that's loded on demand.

* The whole wfInitMimeMaps() function just serves to make arrays like:

Array
(
    [application/ogg] =&gt; ogg ogg
    [application/pdf] =&gt; pdf pdf
    [application/x-javascript] =&gt; js js
    [application/x-shockwave-flash] =&gt; swf swf
    [audio/midi] =&gt; mid midi kar mid midi kar
    [audio/mpeg] =&gt; mpga mpa mp2 mp3 mpga mp2 mp3
    &lt;snip&gt;

Array
(
    [OFFICE] =&gt; Array
        (
            [0] =&gt; application/pdf
            [1] =&gt; application/pdf
            [2] =&gt; application/acrobat
     &lt;snip&gt;

Array
(
    [] =&gt; text/rtf
    [application/x-javascript] =&gt; text/javascript
    [audio/mpeg] =&gt; audio/mp3
    [application/ogg] =&gt; audio/ogg
    &lt;snip&gt;

This could be simplified with something like:

$mime = array(
        'ogg' =&gt; array (
                'type' =&gt; AUDIO,
                'mime' =&gt; array(
                        'audio/ogg',
                        'application/x-ogg',
                        'application/ogg',
                        'audio/x-ogg'
                )
        )
);

Which would then be a native php datastructure, it would load alot faster and be
a bit more understandable, the former will not really be a problem if it's
rewritten as a class and invoced only when needed, but currently the whole thing
is being parsed in full and arrays generated even when they're not needed such
as on pages that don't have images, since Image.php is loaded even then.

* There's some usage of &#64; to hide errors, this is generally a bad thing™ and
should indicate that things aren't being done like they should.</pre>
    </div><div id="c17" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-11 12:12:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=898#c16">comment #16</a>)

I'd like to point out a few things about avar's comments. In general, he has
some valid points, but with others I disagree. It would be good to have some
more input on this.

<span class="quote">&gt; * The whole MimeMagic.php file is just a row of functions most of which have to
&gt; be parsed on each invocation, it should be a class that's loaded on demand.</span >

It should indeed be loaded on demand, but being a class does not help with that
(a class needs to be parsed in full, too, even if it's never instantiated). That
is, the MimeMagic.php file should only be *included* on demand (ther's even a
note about this in Image.php where it's included). This would require the
include statement to be inside a function - I know this is possible, but brings
with it other problems, like global variables defined in MimeMagic to be
declared global explicitely (otherwise they would end up in the scope of the
calling function). This is rather obscure, but could be done. I did not do that
because I expected this to raise objections (as I belive doing includes inside
functions is obscure and should be avoided).

<span class="quote">&gt; * The whole wfInitMimeMaps() function just serves to make arrays like:</span >
...
<span class="quote">&gt; This could be simplified with something like:
&gt; 
&gt; $mime = array(
&gt;         'ogg' =&gt; array (
&gt;                 'type' =&gt; AUDIO,
&gt;                 'mime' =&gt; array(
&gt;                         'audio/ogg',
&gt;                         'application/x-ogg',
&gt;                         'application/ogg',
&gt;                         'audio/x-ogg'
&gt;                 )
&gt;         )
&gt; );
&gt; 
&gt; Which would then be a native php datastructure, it would load alot faster and be
&gt; a bit more understandable, </span >

I disagree:

* Complex nested array structures are less readable and harder to maintain (I
tried it, it was like that initially). 

* the map above would have to be process to build the reverse mappings (mime to
ext, mime to mime aliases, etc). Maintaining the reverse mappings by hand
seperately is redundant and error prone. Building several maps from a file has
the advantag of reducing redundancy and easing maintanance.

* Also, mime.type files are a standard structure on *nix systems and it should
be possible to use the systems standard mime map (/etc/mime.types) instead of
the on provided with mediawiki.

* The structure of mime.types and mime.info is much easier to understand and
maintain by non-programmers, and they are also more robust against syntax errors.

It is true however that native php structures would load faster. Even faster
would be serialized php structures, but they are not really maintainable by
hand. I belive this to be a non-issue, because those files are never parsed in
normal &quot;viewing&quot; operation, but only under three conditions:

* a new file is uploaded
* an old version of a file is restored
* the entry in the image table is upgraded from 1.4 format

<span class="quote">&gt; the former will not really be a problem if it's
&gt; rewritten as a class and invoced only when needed, but currently the whole thing
&gt; is being parsed in full and arrays generated even when they're not needed such
&gt; as on pages that don't have images, since Image.php is loaded even then.</span >

That is not true: the reason the arrays are build inside a function is precisely
to only do that on demand. The MimeMagic.php is included but non of the detector
functions is ever called, the arrays are not initialized. Including them in the
files as native structures would, among other things, cause them to always be
parsed. Also, as I said before, if the function is wrapped in a class or not is
irrelevant to the fact that it is always parsed in full.

<span class="quote">&gt; * There's some usage of &#64; to hide errors, this is generally a bad thing™ and
&gt; should indicate that things aren't being done like they should.</span >

The &#64; to hide errors is used *only* for lookups in arrays when it is not known
in advance if ther's a value for that key. The same could be done with
isdefined, if that is preferred. Supressing errors is necessary in some
situation and done throughout the code.

please comment, so I can fix issues. I'm currently inclined to do the
conditional include in Image.php, but i'll wait for more input for now. </pre>
    </div><div id="c18" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-12 01:29:39 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=525" name="attach_525" title="new version of MimeMagic.php, code is now wrapped in a class; this version matches the patch that follows. (path: includes/MimeMagic.php)">attachment 525</a> <a href="attachment.cgi?id=525&amp;action=edit" title="new version of MimeMagic.php, code is now wrapped in a class; this version matches the patch that follows. (path: includes/MimeMagic.php)">[details]</a></span>
new version of MimeMagic.php, code is now wrapped in a class; this version matches the patch that follows. (path: includes/MimeMagic.php)</pre>
    </div><div id="c19" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-12 01:33:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=526" name="attach_526" title="new patch, using the new, OO version of MimeMagic.php">attachment 526</a> <a href="attachment.cgi?id=526&amp;action=edit" title="new patch, using the new, OO version of MimeMagic.php">[details]</a></span>
new patch, using the new, OO version of MimeMagic.php

New patch that hopefully takes care of avar's concerns. Main changes are

* MimeMagic code is now wrapped in a class. One one global instance is needed
* To get an instance of MimeMagic, use wfGetMimeMagic(). This function also
includes the code file if neccessary.
* I also adjusted ParserTest.php to use the new structure of the image table.

enjoy!</pre>
    </div><div id="c20" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-12 01:40:17 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=527" name="attach_527" title="&quot;upgrade&quot; patch in case you already applied the first full patch (from 2005-05-10 20:46 UTC)">attachment 527</a> <a href="attachment.cgi?id=527&amp;action=edit" title="&quot;upgrade&quot; patch in case you already applied the first full patch (from 2005-05-10 20:46 UTC)">[details]</a></span>
&quot;upgrade&quot; patch in case you already applied the first full patch (from 2005-05-10 20:46 UTC)</pre>
    </div><div id="c21" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brion Vibber</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-12 07:26:42 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=898#c15">comment #15</a>)
<span class="quote">&gt; This should probably be enabled at some point, but isn't related to this feature:
&gt; &quot;&quot;&quot;&quot;
&gt; -$wgFileExtensions = array( 'png', 'gif', 'jpg', 'jpeg' );
&gt; +$wgFileExtensions = array( 'png', 'gif', 'jpg', 'jpeg', 'ogg' );</span >

I removed ogg from the default whitelist because many web servers do not have a MIME 
type set for the .ogg extension. This makes such files more susceptible to various 
attacks: client-side type autodetection bugs are more easily triggered on text/plain 
or application/octet-stream, and server-side type detection bugs like interpreting 
files as executable scripts is easier to trigger when there's not a default file type 
for it to match.

While the various other precautions make these less likely (checking for multiple 
extensions and blacklisting known bad ones, checking for known client-side script 
triggers, etc), I prefer a 'secure by default' philosophy. Admins can explicitly add 
it to the whitelist (as we have) if it's known to be safe in the environment they've 
created.</pre>
    </div><div id="c22" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-13 14:47:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; New patch that hopefully takes care of avar's concerns. Main changes are</span >

It still changes $wgFileExtensions, the exif handling, whitespace and now has
$wgUploadDescriptionPattern (although unused) in DefaultSettings.php, please
make sure that the patches you send in only change things directly related to
this particular feature, having other changes in there makes it harder to review.</pre>
    </div><div id="c23" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-13 15:25:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED WONTFIX - Whitelist .ai (Adobe Illustrator) on WMF wikis"
   href="show_bug.cgi?id=667">Bug 667</a> has been marked as a duplicate of this bug. ***</pre>
    </div><div id="c24" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-14 17:04:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - Allow SVG uploads on Commons"
   href="show_bug.cgi?id=1683">Bug 1683</a> has been marked as a duplicate of this bug. ***</pre>
    </div><div id="c25" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-14 17:12:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >*** <a class="bz_bug_link 
          bz_status_REOPENED "
   title="REOPENED - Allow uploading of 3D files to Wikimedia Commons"
   href="show_bug.cgi?id=1790">Bug 1790</a> has been marked as a duplicate of this bug. ***</pre>
    </div><div id="c26" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 19:31:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=542" name="attach_542" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">attachment 542</a> <a href="attachment.cgi?id=542&amp;action=edit" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">[details]</a></span>
updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.</pre>
    </div><div id="c27" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 19:32:56 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=543" name="attach_543" title="MIME detection module, new version (includes/MimeMagic.php)">attachment 543</a> <a href="attachment.cgi?id=543&amp;action=edit" title="MIME detection module, new version (includes/MimeMagic.php)">[details]</a></span>
MIME detection module, new version (includes/MimeMagic.php)</pre>
    </div><div id="c28" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 19:33:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=544" name="attach_544" title="updated mime info (includes/mime.info)">attachment 544</a> <a href="attachment.cgi?id=544&amp;action=edit" title="updated mime info (includes/mime.info)">[details]</a></span>
updated mime info (includes/mime.info)</pre>
    </div><div id="c29" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 19:34:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=545" name="attach_545" title="updated mime types (includes/mime.types)">attachment 545</a> <a href="attachment.cgi?id=545&amp;action=edit" title="updated mime types (includes/mime.types)">[details]</a></span>
updated mime types (includes/mime.types)</pre>
    </div><div id="c30" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 19:35:51 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=546" name="attach_546" title="updated database patch, now also removed the obsolete img_type column. (maintenance/archives/patch-img_media_type.sql)">attachment 546</a> <a href="attachment.cgi?id=546&amp;action=edit" title="updated database patch, now also removed the obsolete img_type column. (maintenance/archives/patch-img_media_type.sql)">[details]</a></span>
updated database patch, now also removed the obsolete img_type column. (maintenance/archives/patch-img_media_type.sql)</pre>
    </div><div id="c31" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c31">Comment 31</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 19:40:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I just uploded a new version of my patch. I hope I have implemented everything
brion and avar suggested.

Major changes are:

* Databse consistence: 
-- automatically rebuild memcached image info
-- give a descriptive error if the database schema was not updated
-- delete obsolete column in the database patch
* removed the code for disabling [[<a href="https://en.wikipedia.org/w/index.php?title=Special:Search&go=Go&search=media%3A...">media:...</a>]] links
* Cleaned up changes to whitespace and code style. At least I tried.
* Some changes to ImagePage.php - more info about non-image files, links to
source of pre-rendered images, etc.
* Tweaked the code to also render TIFF, BMP etc if ImageMagic is available.
* PHP code is now detected an rejected
* cleaned up mustRender/canRender/allowInlienDisplay

Ther has been some more cleanup and minor fixed. Please have a look.</pre>
    </div><div id="c32" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c32">Comment 32</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 20:07:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=547" name="attach_547" title="MIME detection module, new version (includes/MimeMagic.php)">attachment 547</a> <a href="attachment.cgi?id=547&amp;action=edit" title="MIME detection module, new version (includes/MimeMagic.php)">[details]</a></span>
MIME detection module, new version (includes/MimeMagic.php)

The version by Daniel Kinzler had an undefined variable ($e) in
guessTypesForExtension()</pre>
    </div><div id="c33" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c33">Comment 33</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 20:12:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=548" name="attach_548" title="MIME detection module, new version (includes/MimeMagic.php)">attachment 548</a> <a href="attachment.cgi?id=548&amp;action=edit" title="MIME detection module, new version (includes/MimeMagic.php)">[details]</a></span>
MIME detection module, new version (includes/MimeMagic.php)

Fixes a typo in guessTypesForExtension() (pregt_replace =&gt; preg_replace)</pre>
    </div><div id="c34" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c34">Comment 34</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 21:14:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" ><span class="bz_obsolete"><a href="attachment.cgi?id=542" name="attach_542" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">attachment 542</a> <a href="attachment.cgi?id=542&amp;action=edit" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">[details]</a></span> contains alot of changes to the enotif code that tim cleaned
up/removed recently, please go over the patch manually to make sure it doesn't
revert any recent changes.

And there's a syntax error on line 258 of MimeMagic.php, you need to add slashes
around that regular expression.</pre>
    </div><div id="c35" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 21:19:16 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=549" name="attach_549" title="Changes to Language.php, should be applied to a clean tree (not directly after attachment 542)">attachment 549</a> <a href="attachment.cgi?id=549&amp;action=edit" title="Changes to Language.php, should be applied to a clean tree (not directly after attachment 542)">[details]</a></span>
Changes to Language.php, should be applied to a clean tree (not directly after <span class="bz_obsolete"><a href="attachment.cgi?id=542" name="attach_542" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">attachment 542</a> <a href="attachment.cgi?id=542&amp;action=edit" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">[details]</a></span>)

replaces the includes/Language.php part of <span class="bz_obsolete"><a href="attachment.cgi?id=542" name="attach_542" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">attachment 542</a> <a href="attachment.cgi?id=542&amp;action=edit" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">[details]</a></span>, tones down the
warning a little and removes the link to Wikipedia.</pre>
    </div><div id="c36" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c36">Comment 36</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-15 21:20:53 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=550" name="attach_550" title="Changes to ImagePage.php, should be applied to a clean tree (not directly after attachment 542)">attachment 550</a> <a href="attachment.cgi?id=550&amp;action=edit" title="Changes to ImagePage.php, should be applied to a clean tree (not directly after attachment 542)">[details]</a></span>
Changes to ImagePage.php, should be applied to a clean tree (not directly after <span class="bz_obsolete"><a href="attachment.cgi?id=542" name="attach_542" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">attachment 542</a> <a href="attachment.cgi?id=542&amp;action=edit" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">[details]</a></span>)

replaces the includes/ImagePage.php part of <span class="bz_obsolete"><a href="attachment.cgi?id=542" name="attach_542" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">attachment 542</a> <a href="attachment.cgi?id=542&amp;action=edit" title="updated patch, implementing most of brions suggestions. Requires the new version of the other files, see below.">[details]</a></span>, moves the links
around so that the direct link to the file is always immitiately after the TOC
(as it was previously).</pre>
    </div><div id="c37" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c37">Comment 37</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-16 19:28:40 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=554" name="attach_554" title="MIME detection module (includes/MimeMagic.php), fixing bugs mentioned in #32, #33, #34">attachment 554</a> <a href="attachment.cgi?id=554&amp;action=edit" title="MIME detection module (includes/MimeMagic.php), fixing bugs mentioned in #32, #33, #34">[details]</a></span>
MIME detection module (includes/MimeMagic.php), fixing bugs mentioned in #32, #33, #34</pre>
    </div><div id="c38" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c38">Comment 38</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Daniel Kinzler</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-16 19:31:09 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="attachment.cgi?id=555" name="attach_555" title="new version of the FULL PATCH, fixing bugs mentioned in #32, #33, #34">attachment 555</a> <a href="attachment.cgi?id=555&amp;action=edit" title="new version of the FULL PATCH, fixing bugs mentioned in #32, #33, #34">[details]</a></span>
new version of the FULL PATCH, fixing bugs mentioned in #32, #33, #34

Ok, I hope that's all. 

FYI: this patch includes things mentioned in #32, #33, #34, but not the changes
by <span class=""><a href="attachment.cgi?id=549" name="attach_549" title="Changes to Language.php, should be applied to a clean tree (not directly after attachment 542)">attachment 549</a> <a href="attachment.cgi?id=549&amp;action=edit" title="Changes to Language.php, should be applied to a clean tree (not directly after attachment 542)">[details]</a></span> and <span class=""><a href="attachment.cgi?id=550" name="attach_550" title="Changes to ImagePage.php, should be applied to a clean tree (not directly after attachment 542)">attachment 550</a> <a href="attachment.cgi?id=550&amp;action=edit" title="Changes to ImagePage.php, should be applied to a clean tree (not directly after attachment 542)">[details]</a></span>.</pre>
    </div><div id="c39" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c39">Comment 39</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-05-21 07:52:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Commited to HEAD, marking this as FIXED.</pre>
    </div><div id="c40" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=898#c40">Comment 40</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ævar Arnfjörð Bjarmason</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-06-14 15:49:48 UTC
        </span>
      </div>



<pre class="bz_comment_text" >*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - Allow .XCF uploads on Wikimedia web sites"
   href="show_bug.cgi?id=1410">Bug 1410</a> has been marked as a duplicate of this bug. ***</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

    <hr><div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=898&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=898">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=898">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=898">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
<div class="visualClear"></div>
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="head" class="noprint">
			<!-- /search -->
			<div id="p-search">
				<h5><label for="searchInput">Search</label></h5>
				<form id="searchform" action="buglist.cgi" method="get"
				 onsubmit="if (this.quicksearch.value == '')
				 { alert('Please enter one or more search terms first.');
				 return false; } return true;">
					<input type='hidden' name="title" value="Special:Search"/>
					<div id="simpleSearch">
						<input id="searchInput" name="quicksearch" type="text" title="Search Bugzilla [alt-f]" accesskey="f" value="" />
						<button id="searchButton" type='submit' name='button' title="Search Bugzilla for this text">&nbsp;</button>
					</div>
				</form>
			</div>
			<!-- /search -->
			<!-- personal -->
			<div id="p-personal" class="">
				<h5>Personal tools</h5>
				<ul >
							<li id="new_account_container">
								<a href="createaccount.cgi">New&nbsp;Account</a>
							</li>
						<li id="mini_login_container">
  <span class="separator">| </span>
  <a id="login_link" href="show_bug.cgi?id=898&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('')">Log In</a>

  
  <form action="show_bug.cgi?id=898" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login"
        onsubmit="return check_mini_login_fields( '' );"
  >
    <input id="Bugzilla_login" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('')"
    >
    <input class="bz_password" 
           id="Bugzilla_password" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy" value="password"
           title="Password"
           onfocus="mini_login_on_focus('')"
    >
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "email address",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('')">[x]</a>
  </form>
</li>
<li id="forgot_container">
  <span class="separator">| </span>
  <a id="forgot_link" href="show_bug.cgi?id=898&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form"
        class="mini_forgot bz_default_hidden">
    <label for="login">Login:</label>
    <input type="text" name="loginname" size="20" id="login">
    <input id="forgot_button" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token" name="token" value="1419358025-Iw964nqC_woCXZvNp7HlZHhGWdm0pgcfDNE3VW6BrIg">
    <a href="#" onclick="return hide_forgot_form('')">[x]</a>
  </form>
</li>

				</ul>
			</div>
			<!-- /personal -->
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="panel" class="noprint">
				<!-- logo -->
				<div id="p-logo"><a style="background-image: url(skins/contrib/Wikimedia/images/bugzilla-logo.png);" href="./"  title="Visit the main page"></a></div>
				<!-- /logo -->
				<!-- navigation -->
				<div class="portal">
					<h5>Navigation</h5>
					<div class="body">
						<ul><li><a href="query.cgi?format=specific">Search bugs</a></li>
			<li><a href="query.cgi?format=advanced">Advanced search</a></li>
			<li><a href="describecomponents.cgi">Browse projects</a></li>
			<li><a href="enter_bug.cgi">Enter a new bug</a></li>
                        <li>
                                <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
                        </li>	
						</ul>
					</div>
				</div>
				<!-- /navigation -->
				<!-- interaction -->
				<!-- /interaction -->
				<!-- toolbox -->
				<div class="portal">
					<h5>Links</h5>
					<div class="body">
						<ul><li><a href="report.cgi">Reports</a></li>
			<li><a href="weekly-bug-summary.cgi?tops=10&days=7">Weekly Summary</a></li>
				<li>
						<a href="request.cgi">Requests</a>
				</li>
						</ul>
					</div>
				</div>
				<!-- /toolbox -->
			</div>
		<!-- /panel -->		

		<!-- footer -->
		<div id="footer" >
			<ul id="footer-info">
				<li>Bugzilla version 4.4.5</li>
			</ul>

			<ul id="footer-places">
				<li><a href="https://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Bug_management/Bugzilla_etiquette" title="Bug management/Bugzilla etiquette">Bugzilla etiquette</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:About" title="Project:About">About MediaWiki.org</a></li>
				<li><a href="https://www.mediawiki.org/wiki/Project:General_disclaimer" title="Project:General disclaimer">Disclaimers</a></li>
			</ul>
			<ul id="footer-icons" class="noprint">
				<li id="footer-icon-poweredby"><a href="http://www.bugzilla.org/"><img src="skins/contrib/Wikimedia/images/bugzilla-badge.png" height="31" width="88" alt="Powered by Bugzilla" /></a></li>
			</ul>
			<div style="clear:both"></div>
		<div class="outro"></div>
		</div>
		<!-- /footer -->
	</body>
</html>